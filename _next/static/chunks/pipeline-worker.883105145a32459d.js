!function(){var e,t,s,n,i,r,a,o,l={3614:function(){},4454:function(){},5506:function(){},2085:function(){},1587:function(){},9823:function(){},3438:function(){},7353:function(e,t,s){"use strict";let n,i,r,a;function o(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}let l=class{_call(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];throw Error("Must implement _call method in subclass")}constructor(){let e=function(){for(var t=arguments.length,s=Array(t),n=0;n<t;n++)s[n]=arguments[n];return e._call(...s)};return Object.setPrototypeOf(e,new.target.prototype)}};function c(e){return Number.isInteger(e)||"bigint"==typeof e}function d(e){let t=[],s=e;for(;Array.isArray(s);)t.push(s.length),s=s[0];return t}function h(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=e[t];if(void 0!==n)return delete e[t],n;if(void 0===s)throw Error("Key ".concat(t," does not exist in object."));return s}function u(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return Array.prototype.concat.apply([],t)}function _(e,t){return Math.abs((e+t)%(2*t)-t)}var p,f=s(4454),m=s(5506),g=s(1587),w=s(9823),y=s(3438),v=s(1333),x=s(3614),k=s.t(x,2),b=s(6192),M=s.t(b,2),A=s(8927);let S=["wasm"];void 0!==A&&(null==A?void 0:null===(p=A.release)||void 0===p?void 0:p.name)==="node"?(n=null!=x?x:k,S.unshift("cpu")):(n=null!=b?b:M,"undefined"!=typeof navigator&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(n.env.wasm.simd=!1));let{env:z}=n,E="2.16.0",C="undefined"!=typeof self&&"caches"in self,F=!N(w),T=!N(y),P=F&&T,L=P?y.dirname(y.dirname(v.fileURLToPath("file:///Users/ozzyonfire/Development/projects/open-source/transformers.js/src/env.js"))):"./",O=P?y.join(L,"/.cache/"):null,I="/models/",B=P?y.join(L,I):I;(null==z?void 0:z.wasm)&&(z.wasm.wasmPaths=P?y.join(L,"/dist/"):"https://cdn.jsdelivr.net/npm/@xenova/transformers@".concat(E,"/dist/"));let j={version:E,allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!0,localModelPath:B,useFS:F,useBrowserCache:C,useFSCache:F,cacheDir:O,useCustomCache:!1,customCache:null};function N(e){return 0===Object.keys(e).length}var q=s(8927),D=s(1315).lW;globalThis.ReadableStream||(globalThis.ReadableStream=g.ReadableStream);class R{updateContentType(){var e;let t=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",null!==(e=this._CONTENT_TYPE_MAP[t])&&void 0!==e?e:"application/octet-stream")}clone(){let e=new R(this.filePath);return e.exists=this.exists,e.status=this.status,e.statusText=this.statusText,e.headers=new Headers(this.headers),e}async arrayBuffer(){return(await f.promises.readFile(this.filePath)).buffer}async blob(){let e=await f.promises.readFile(this.filePath);return new Blob([e],{type:this.headers.get("content-type")})}async text(){return await f.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}constructor(e){if(this._CONTENT_TYPE_MAP={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"},this.filePath=e,this.headers=new Headers,this.exists=f.existsSync(e),this.exists){this.status=200,this.statusText="OK";let t=f.statSync(e);this.headers.set("content-length",t.size.toString()),this.updateContentType();let s=this;this.body=new ReadableStream({start(e){s.arrayBuffer().then(t=>{e.enqueue(new Uint8Array(t)),e.close()})}})}else this.status=404,this.statusText="Not Found",this.body=null}}function U(e){let t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{t=new URL(e)}catch(e){return!1}return(!s||!!s.includes(t.hostname))&&("http:"===t.protocol||"https:"===t.protocol)}async function G(e){var t,s,n,i,r;if(j.useFS&&!U(e))return new R(e);if(void 0===q||(null==q?void 0:null===(t=q.release)||void 0===t?void 0:t.name)!=="node")return fetch(e);{let t=!!(null===(s=q.env)||void 0===s?void 0:s.TESTING_REMOTELY),a=j.version,o=new Headers;if(o.set("User-Agent","transformers.js/".concat(a,"; is_ci/").concat(t,";")),U(e,["huggingface.co","hf.co"])){let e=null!==(r=null===(n=q.env)||void 0===n?void 0:n.HF_TOKEN)&&void 0!==r?r:null===(i=q.env)||void 0===i?void 0:i.HF_ACCESS_TOKEN;e&&o.set("Authorization","Bearer ".concat(e))}return fetch(e,{headers:o})}}let W={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};class V{async match(e){let t=new R(m.join(this.path,e));return t.exists?t:void 0}async put(e,t){let s=D.from(await t.arrayBuffer()),n=m.join(this.path,e);try{await f.promises.mkdir(m.dirname(n),{recursive:!0}),await f.promises.writeFile(n,s)}catch(e){console.warn("An error occurred while writing the file to cache:",e)}}constructor(e){this.path=e}}async function X(e){for(var t=arguments.length,s=Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];for(let t of s)try{let s=await e.match(t);if(s)return s}catch(e){continue}}async function K(e,t){var s,n,i,r,a,o,l;let c,d,h,u,_=!(arguments.length>2)||void 0===arguments[2]||arguments[2],p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!j.allowLocalModels){if(p.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!j.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}if((i=p.progress_callback)&&i({status:"initiate",name:e,file:t}),!c&&j.useBrowserCache){if("undefined"==typeof caches)throw Error("Browser cache is not available in this environment.");try{c=await caches.open("transformers-cache")}catch(e){console.warn("An error occurred while opening the browser cache:",e)}}if(!c&&j.useFSCache&&(c=new V(null!==(s=p.cache_dir)&&void 0!==s?s:j.cacheDir)),!c&&j.useCustomCache){if(!j.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!j.customCache.match||!j.customCache.put)throw Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");c=j.customCache}let f=null!==(n=p.revision)&&void 0!==n?n:"main",m=Y(e,t),g=Y(j.localModelPath,m),w=Y(j.remoteHost,j.remotePathTemplate.replaceAll("{model}",e).replaceAll("{revision}",encodeURIComponent(f)),t),y="main"===f?m:Y(e,f,t),v=c instanceof V?y:w,x=!1;c&&(h=await X(c,g,v));let k=void 0!==h;if(void 0===h){if(j.allowLocalModels){if(U(m)){if(p.local_files_only)throw Error("`local_files_only=true`, but attempted to load a remote file from: ".concat(m,"."));if(!j.allowRemoteModels)throw Error("`env.allowRemoteModels=false`, but attempted to load a remote file from: ".concat(m,"."))}else try{h=await G(g),d=g}catch(e){console.warn('Unable to load from local path "'.concat(g,'": "').concat(e,'"'))}}if(void 0===h||404===h.status){if(p.local_files_only||!j.allowRemoteModels){if(!_)return null;throw Error('`local_files_only=true` or `env.allowRemoteModels=false` and file was not found locally at "'.concat(g,'".'))}if(200!==(h=await G(w)).status)return function(e,t,s){var n;if(!s)return null;let i=null!==(n=W[e])&&void 0!==n?n:"Error (".concat(e,") occurred while trying to load file");throw Error("".concat(i,': "').concat(t,'".'))}(h.status,w,_);d=v}x=c&&"undefined"!=typeof Response&&h instanceof Response&&200===h.status}(r=p.progress_callback)&&r({status:"download",name:e,file:t});let b={status:"progress",name:e,file:t};return p.progress_callback?k&&"undefined"!=typeof navigator&&/firefox/i.test(navigator.userAgent)?(u=new Uint8Array(await h.arrayBuffer()),a=p.progress_callback,o={...b,progress:100,loaded:u.length,total:u.length},a&&a(o)):u=await Q(h,e=>{var t,s;t=p.progress_callback,s={...b,...e},t&&t(s)}):u=new Uint8Array(await h.arrayBuffer()),x&&d&&await c.match(d)===void 0&&await c.put(d,new Response(u,{headers:h.headers})).catch(e=>{console.warn("Unable to add response to browser cache: ".concat(e,"."))}),(l=p.progress_callback)&&l({status:"done",name:e,file:t}),u}async function H(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=await K(e,t,s,n);return null===i?{}:JSON.parse(new TextDecoder("utf-8").decode(i))}async function Q(e,t){let s=e.headers.get("Content-Length");null===s&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let n=parseInt(null!=s?s:"0"),i=new Uint8Array(n),r=0,a=e.body.getReader();async function o(){let{done:e,value:s}=await a.read();if(e)return;let l=r+s.length;if(l>n){n=l;let e=new Uint8Array(n);e.set(i),i=e}return i.set(s,r),t({progress:(r=l)/n*100,loaded:r,total:n}),o()}return await o(),i}function Y(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(t=t.map((e,s)=>(s&&(e=e.replace(RegExp("^/"),"")),s!==t.length-1&&(e=e.replace(RegExp("/$"),"")),e))).join("/")}function $(e){let t=ee(e)[0],s=e.map(e=>Math.exp(e-t)),n=s.reduce((e,t)=>e+t,0);return s.map(e=>e/n)}function J(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e=Array.from(e).map((e,t)=>[t,e]).sort((e,t)=>t[1]-e[1]),null!==t&&t>0&&(e=e.slice(0,t)),e}function Z(e){if(0===e.length)throw Error("Array must not be empty");let t=e[0],s=0;for(let n=1;n<e.length;++n)e[n]<t&&(t=e[n],s=n);return[t,s]}function ee(e){if(0===e.length)throw Error("Array must not be empty");let t=e[0],s=0;for(let n=1;n<e.length;++n)e[n]>t&&(t=e[n],s=n);return[Number(t),s]}function et(e){return e>0&&(e&e-1)==0}class es{createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(e,t){let s=t||Array(e.length>>>1);for(let t=0;t<e.length;t+=2)s[t>>>1]=e[t];return s}toComplexArray(e,t){let s=t||this.createComplexArray();for(let t=0;t<s.length;t+=2)s[t]=e[t>>>1],s[t+1]=0;return s}completeSpectrum(e){let t=this._csize,s=t>>>1;for(let n=2;n<s;n+=2)e[t-n]=e[n],e[t-n+1]=-e[n+1]}transform(e,t){if(e===t)throw Error("Input and output buffers must be different");this._transform4(e,t,1)}realTransform(e,t){if(e===t)throw Error("Input and output buffers must be different");this._realTransform4(e,t,1)}inverseTransform(e,t){if(e===t)throw Error("Input and output buffers must be different");this._transform4(e,t,-1);for(let t=0;t<e.length;++t)e[t]/=this.size}_transform4(e,t,s){let n,i;let r=this._csize,a=1<<this._width,o=r/a<<1,l=this._bitrev;if(4===o)for(n=0,i=0;n<r;n+=o,++i){let s=l[i];this._singleTransform2(t,e,n,s,a)}else for(n=0,i=0;n<r;n+=o,++i){let r=l[i];this._singleTransform4(t,e,n,r,a,s)}for(a>>=2;a>=2;a>>=2){let t=(o=r/a<<1)>>>2;for(n=0;n<r;n+=o){let i=n+t-1;for(let r=n,o=0;r<i;r+=2,o+=a){let n=r,i=n+t,a=i+t,l=a+t,c=e[n],d=e[n+1],h=e[i],u=e[i+1],_=e[a],p=e[a+1],f=e[l],m=e[l+1],g=this.table[o],w=s*this.table[o+1],y=h*g-u*w,v=h*w+u*g,x=this.table[2*o],k=s*this.table[2*o+1],b=_*x-p*k,M=_*k+p*x,A=this.table[3*o],S=s*this.table[3*o+1],z=f*A-m*S,E=f*S+m*A,C=c+b,F=d+M,T=c-b,P=d-M,L=y+z,O=v+E,I=s*(y-z),B=s*(v-E);e[n]=C+L,e[n+1]=F+O,e[i]=T+B,e[i+1]=P-I,e[a]=C-L,e[a+1]=F-O,e[l]=T-B,e[l+1]=P+I}}}}_singleTransform2(e,t,s,n,i){let r=e[n],a=e[n+1],o=e[n+i],l=e[n+i+1];t[s]=r+o,t[s+1]=a+l,t[s+2]=r-o,t[s+3]=a-l}_singleTransform4(e,t,s,n,i,r){let a=2*i,o=3*i,l=e[n],c=e[n+1],d=e[n+i],h=e[n+i+1],u=e[n+a],_=e[n+a+1],p=e[n+o],f=e[n+o+1],m=l+u,g=c+_,w=l-u,y=c-_,v=d+p,x=h+f,k=r*(d-p),b=r*(h-f);t[s]=m+v,t[s+1]=g+x,t[s+2]=w+b,t[s+3]=y-k,t[s+4]=m-v,t[s+5]=g-x,t[s+6]=w-b,t[s+7]=y+k}_realTransform4(e,t,s){let n,i;let r=this._csize,a=1<<this._width,o=r/a<<1,l=this._bitrev;if(4===o)for(n=0,i=0;n<r;n+=o,++i){let s=l[i];this._singleRealTransform2(t,e,n,s>>>1,a>>>1)}else for(n=0,i=0;n<r;n+=o,++i){let r=l[i];this._singleRealTransform4(t,e,n,r>>>1,a>>>1,s)}for(a>>=2;a>=2;a>>=2){let t=(o=r/a<<1)>>>2;for(n=0;n<r;n+=o){let i=n+t-1;for(let r=n,o=0;r<i;r+=2,o+=a){let n=r,i=n+t,a=i+t,l=a+t,c=e[n],d=e[n+1],h=e[i],u=e[i+1],_=e[a],p=e[a+1],f=e[l],m=e[l+1],g=this.table[o],w=s*this.table[o+1],y=h*g-u*w,v=h*w+u*g,x=this.table[2*o],k=s*this.table[2*o+1],b=_*x-p*k,M=_*k+p*x,A=this.table[3*o],S=s*this.table[3*o+1],z=f*A-m*S,E=f*S+m*A,C=c+b,F=d+M,T=c-b,P=d-M,L=y+z,O=v+E,I=s*(y-z),B=s*(v-E);e[n]=C+L,e[n+1]=F+O,e[i]=T+B,e[i+1]=P-I,e[a]=C-L,e[a+1]=F-O,e[l]=T-B,e[l+1]=P+I}}}}_singleRealTransform2(e,t,s,n,i){let r=e[n],a=e[n+i];t[s]=r+a,t[s+1]=0,t[s+2]=r-a,t[s+3]=0}_singleRealTransform4(e,t,s,n,i,r){let a=e[n],o=e[n+i],l=e[n+2*i],c=e[n+3*i],d=a+l,h=a-l,u=o+c,_=r*(o-c);t[s]=d+u,t[s+1]=0,t[s+2]=h,t[s+3]=-_,t[s+4]=d-u,t[s+5]=0,t[s+6]=h,t[s+7]=_}constructor(e){if(this.size=0|e,this.size<=1||!et(this.size))throw Error("FFT size must be a power of two larger than 1");this._csize=e<<1,this.table=new Float64Array(2*this.size);for(let e=0;e<this.table.length;e+=2){let t=Math.PI*e/this.size;this.table[e]=Math.cos(t),this.table[e+1]=-Math.sin(t)}let t=0;for(let e=1;this.size>e;e<<=1)++t;this._width=t%2==0?t-1:t,this._bitrev=new Int32Array(1<<this._width);for(let e=0;e<this._bitrev.length;++e){this._bitrev[e]=0;for(let t=0;t<this._width;t+=2){let s=this._width-t-2;this._bitrev[e]|=(e>>>t&3)<<s}}}}class en{_transform(e,t,s){let n=this._buffer1,i=this._buffer2,r=this._outBuffer1,a=this._outBuffer2,o=this._chirpBuffer,l=this._slicedChirpBuffer,c=this._a;if(s)for(let e=0;e<l.length;e+=2){let s=e+1,i=t[e>>1];n[e]=i*l[e],n[s]=i*l[s]}else for(let e=0;e<l.length;e+=2){let s=e+1;n[e]=t[e]*l[e]-t[s]*l[s],n[s]=t[e]*l[s]+t[s]*l[e]}this._f.transform(r,n);for(let e=0;e<o.length;e+=2){let t=e+1;i[e]=r[e]*o[e]-r[t]*o[t],i[t]=r[e]*o[t]+r[t]*o[e]}this._f.inverseTransform(a,i);for(let t=0;t<a.length;t+=2){let s=a[t+c],n=a[t+c+1],i=l[t],r=l[t+1];e[t]=s*i-n*r,e[t+1]=s*r+n*i}}transform(e,t){this._transform(e,t,!1)}realTransform(e,t){this._transform(e,t,!0)}constructor(e){let t=2*(e-1),s=2*(2*e-1),n=2**Math.ceil(Math.log2(s));this.bufferSize=n,this._a=t;let i=new Float64Array(s),r=new Float64Array(n);this._chirpBuffer=new Float64Array(n),this._buffer1=new Float64Array(n),this._buffer2=new Float64Array(n),this._outBuffer1=new Float64Array(n),this._outBuffer2=new Float64Array(n);let a=-2*Math.PI/e,o=Math.cos(a),l=Math.sin(a);for(let t=0;t<s>>1;++t){let s=(t+1-e)**2/2,n=Math.sqrt(o**2+l**2)**s,a=s*Math.atan2(l,o),c=2*t;i[c]=n*Math.cos(a),i[c+1]=n*Math.sin(a),r[c]=i[c],r[c+1]=-i[c+1]}this._slicedChirpBuffer=i.subarray(t,s),this._f=new es(n>>1),this._f.transform(this._chirpBuffer,r)}}class ei{realTransform(e,t){this.fft.realTransform(e,t)}transform(e,t){this.fft.transform(e,t)}constructor(e){this.fft_length=e,this.isPowerOfTwo=et(e),this.isPowerOfTwo?(this.fft=new es(e),this.outputBufferSize=2*e):(this.fft=new en(e),this.outputBufferSize=this.fft.bufferSize)}}function er(e,t){let s=Math.pow(10,t);return Math.round(e*s)/s}let ea=Object.freeze({float32:Float32Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array}),eo=n.Tensor;class el{*[Symbol.iterator](){let[e,...t]=this.dims;if(t.length>0){let s=t.reduce((e,t)=>e*t);for(let n=0;n<e;++n)yield this._subarray(n,s,t)}else yield*this.data}_getitem(e){let[t,...s]=this.dims;if(e=e_(e,t),!(s.length>0))return new el(this.type,[this.data[e]],s);{let t=s.reduce((e,t)=>e*t);return this._subarray(e,t,s)}}indexOf(e){for(let t=0;t<this.data.length;++t)if(this.data[t]==e)return t;return -1}_subarray(e,t,s){let n=e*t,i=(e+1)*t,r="subarray"in this.data?this.data.subarray(n,i):this.data.slice(n,i);return new el(this.type,r,s)}item(){if(1!==this.data.length)throw Error("a Tensor with ".concat(this.data.length," elements cannot be converted to Scalar"));return this.data[0]}tolist(){return function(e,t){let s=e.length;if(s!==t.reduce((e,t)=>e*t))throw Error("cannot reshape array of size ".concat(s," into shape (").concat(t,")"));let n=e;for(let e=t.length-1;e>=0;e--)n=n.reduce((s,n)=>{let i=s[s.length-1];return i.length<t[e]?i.push(n):s.push([n]),s},[[]]);return n[0]}(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){for(let e=0;e<this.data.length;++e)this.data[e]=1/(1+Math.exp(-this.data[e]));return this}mul(e){return this.clone().mul_(e)}mul_(e){for(let t=0;t<this.data.length;++t)this.data[t]*=e;return this}add(e){return this.clone().add_(e)}add_(e){for(let t=0;t<this.data.length;++t)this.data[t]+=e;return this}clone(){return new el(this.type,this.data.slice(),this.dims.slice())}slice(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];let n=[],i=[];for(let e=0;e<this.dims.length;++e){let s=t[e];if(null==s)i.push([0,this.dims[e]]),n.push(this.dims[e]);else if("number"==typeof s)s=e_(s,this.dims[e],e),i.push([s,s+1]);else if(Array.isArray(s)&&2===s.length){if(s[0]>s[1])throw Error("Invalid slice: ".concat(s));let t=[Math.max(s[0],0),Math.min(s[1],this.dims[e])];i.push(t),n.push(t[1]-t[0])}else throw Error("Invalid slice: ".concat(s))}let r=i.map(e=>{let[t,s]=e;return s-t}),a=r.reduce((e,t)=>e*t),o=new this.data.constructor(a),l=this.stride();for(let e=0;e<a;++e){let t=0;for(let s=r.length-1,n=e;s>=0;--s){let e=r[s];t+=(n%e+i[s][0])*l[s],n=Math.floor(n/e)}o[e]=this.data[t]}return new el(this.type,o,n)}transpose(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return ec(this,t)}sum(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.norm(1,e,t)}norm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fro",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("fro"===e)e=2;else if("string"==typeof e)throw Error("Unsupported norm: ".concat(e));if(null===t){let t=this.data.reduce((t,s)=>t+s**e,0)**(1/e);return new el(this.type,[t],[])}t=e_(t,this.dims.length);let n=this.dims.slice();n[t]=1;let i=new this.data.constructor(this.data.length/this.dims[t]);for(let s=0;s<this.data.length;++s){let r=0;for(let e=this.dims.length-1,i=s,a=1;e>=0;--e){let s=this.dims[e];e!==t&&(r+=i%s*a,a*=n[e]),i=Math.floor(i/s)}i[r]+=this.data[s]**e}if(1!==e)for(let t=0;t<i.length;++t)i[t]=i[t]**(1/e);return s||n.splice(t,1),new el(this.type,i,n)}normalize_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t=e_(t,this.dims.length);let s=this.norm(e,t,!0);for(let e=0;e<this.data.length;++e){let n=0;for(let s=this.dims.length-1,i=e,r=1;s>=0;--s){let e=this.dims[s];s!==t&&(n+=i%e*r,r*=this.dims[s]),i=Math.floor(i/e)}this.data[e]/=s.data[n]}return this}normalize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.clone().normalize_(e,t)}stride(){return function(e){let t=Array(e.length);for(let s=e.length-1,n=1;s>=0;--s)t[s]=n,n*=e[s];return t}(this.dims)}squeeze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new el(this.type,this.data,eh(this.dims,e))}squeeze_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.dims=eh(this.dims,e),this}unsqueeze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new el(this.type,this.data,eu(this.dims,e))}unsqueeze_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.dims=eu(this.dims,e),this}flatten_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;t=(t+this.dims.length)%this.dims.length;let s=this.dims.slice(0,e),n=this.dims.slice(e,t+1),i=this.dims.slice(t+1);return this.dims=[...s,n.reduce((e,t)=>e*t,1),...i],this}flatten(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return this.clone().flatten_(e,t)}view(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];let n=-1;for(let e=0;e<t.length;++e)if(-1===t[e]){if(-1!==n)throw Error("Only one dimension can be inferred");n=e}if(-1!==n){let e=t.reduce((e,t,s)=>s!==n?e*t:e,1);t[n]=this.data.length/e}return new el(this.type,this.data,t)}neg_(){for(let e=0;e<this.data.length;++e)this.data[e]=-this.data[e];return this}neg(){return this.clone().neg_()}clamp_(e,t){for(let s=0;s<this.data.length;++s)this.data[s]=Math.min(Math.max(this.data[s],e),t);return this}clamp(e,t){return this.clone().clamp_(e,t)}round_(){for(let e=0;e<this.data.length;++e)this.data[e]=Math.round(this.data[e]);return this}round(){return this.clone().round_()}to(e){if(this.type===e)return this;if(!ea.hasOwnProperty(e))throw Error("Unsupported type: ".concat(e));return new el(e,ea[e].from(this.data),this.dims)}constructor(...e){return e[0]instanceof eo?Object.assign(this,e[0]):Object.assign(this,new eo(e[0],e[1],e[2])),new Proxy(this,{get:(e,t)=>{if("string"==typeof t){let s=Number(t);if(Number.isInteger(s))return e._getitem(s)}return e[t]},set:(e,t,s)=>e[t]=s})}}function ec(e,t){let[s,n]=function(e,t,s){let n=Array(s.length),i=Array(s.length);for(let e=s.length-1,r=1;e>=0;--e)i[e]=r,n[e]=t[s[e]],r*=n[e];let r=s.map((e,t)=>i[s.indexOf(t)]),a=new e.constructor(e.length);for(let s=0;s<e.length;++s){let n=0;for(let e=t.length-1,i=s;e>=0;--e)n+=i%t[e]*r[e],i=Math.floor(i/t[e]);a[n]=e[s]}return[a,n]}(e.data,e.dims,t);return new el(e.type,s,n)}function ed(e,t){var s;let[n,i]=t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"bilinear",a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=null!==(s=e.dims.at(-3))&&void 0!==s?s:1,l=e.dims.at(-2),c=e.dims.at(-1),d=function(e,t,s){let[n,i,r]=t,[a,o]=s;arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4];let l=o/r,c=a/i,d=new e.constructor(a*o*n),h=i*r,u=a*o;for(let t=0;t<a;++t)for(let s=0;s<o;++s){let a=t*o+s,_=(s+.5)/l-.5,p=(t+.5)/c-.5,f=Math.floor(_),m=Math.floor(p),g=Math.min(f+1,r-1),w=Math.min(m+1,i-1),y=_-(f=Math.max(f,0)),v=p-(m=Math.max(m,0)),x=(1-y)*(1-v),k=y*(1-v),b=(1-y)*v,M=y*v,A=m*r,S=w*r,z=A+f,E=A+g,C=S+f,F=S+g;for(let t=0;t<n;++t){let s=t*h;d[t*u+a]=x*e[s+z]+k*e[s+E]+b*e[s+C]+M*e[s+F]}}return d}(e.data,[o,l,c],[n,i],r,a);return new el(e.type,d,[o,n,i])}function eh(e,t){return e=e.slice(),null===t?e=e.filter(e=>1!==e):"number"==typeof t?1===e[t]&&e.splice(t,1):Array.isArray(t)&&(e=e.filter((e,s)=>1!==e||!t.includes(s))),e}function eu(e,t){return t=e_(t,e.length+1),(e=e.slice()).splice(t,0,1),e}function e_(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e<-t||e>=t)throw Error("IndexError: index ".concat(e," is out of bounds for dimension").concat(null===s?"":" "+s," with size ").concat(t));return e<0&&(e=(e%t+t)%t),e}function ep(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=e_(t,e[0].dims.length);let s=e[0].dims.slice();s[t]=e.reduce((e,s)=>e+s.dims[t],0);let n=s.reduce((e,t)=>e*t,1),i=new e[0].data.constructor(n),r=e[0].type;if(0===t){let t=0;for(let s of e)i.set(s.data,t),t+=s.data.length}else{let n=0;for(let r=0;r<e.length;++r){let a=e[r];for(let e=0;e<a.data.length;++e){let r=0;for(let i=a.dims.length-1,o=e,l=1;i>=0;--i){let e=a.dims[i],c=o%e;i===t&&(c+=n),r+=c*l,l*=s[i],o=Math.floor(o/e)}i[r]=a.data[e]}n+=a.dims[t]}}return new el(r,i,s)}function ef(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return ep(e.map(e=>e.unsqueeze(t)),t)}function em(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null===t){let t=e.data.reduce((e,t)=>e+t,0);return new el(e.type,[t/e.data.length],[])}t=e_(t,e.dims.length);let n=e.dims.slice();n[t]=1;let i=new e.data.constructor(e.data.length/e.dims[t]);for(let s=0;s<e.data.length;++s){let r=0;for(let i=e.dims.length-1,a=s,o=1;i>=0;--i){let s=e.dims[i];i!==t&&(r+=a%s*o,o*=n[i]),a=Math.floor(a/s)}i[r]+=e.data[s]}if(1!==e.dims[t])for(let s=0;s<i.length;++s)i[s]=i[s]/e.dims[t];return s||n.splice(t,1),new el(e.type,i,n)}class eg{get size(){return this._heap.length}isEmpty(){return 0===this.size}peek(){return this._heap[0]}push(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.extend(t)}extend(e){for(let t of e)this._heap.push(t),this._siftUp();return this.size}pop(){let e=this.peek(),t=this.size-1;return t>0&&this._swap(0,t),this._heap.pop(),this._siftDown(),e}replace(e){let t=this.peek();return this._heap[0]=e,this._siftDown(),t}_parent(e){return(e+1>>>1)-1}_left(e){return(e<<1)+1}_right(e){return e+1<<1}_greater(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){let s=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=s}_siftUp(){let e=this.size-1;for(;e>0&&this._greater(e,this._parent(e));)this._swap(e,this._parent(e)),e=this._parent(e)}_siftDown(){let e=0;for(;this._left(e)<this.size&&this._greater(this._left(e),e)||this._right(e)<this.size&&this._greater(this._right(e),e);){let t=this._right(e)<this.size&&this._greater(this._right(e),this._left(e))?this._right(e):this._left(e);this._swap(e,t),e=t}}constructor(e=(e,t)=>e>t){this._heap=[],this._comparator=e}}class ew{extend(e){for(let t of e)this.push(t)}push(e){let t=this.root;for(let s of e){let e=t.children.get(s);void 0===e&&(e=ey.default(),t.children.set(s,e)),t=e}t.isLeaf=!0}*commonPrefixSearch(e){let t=this.root,s="";for(let n=0;n<e.length&&void 0!==t;++n){let i=e[n];s+=i,void 0!==(t=t.children.get(i))&&t.isLeaf&&(yield s)}}constructor(){this.root=ey.default()}}class ey{static default(){return new ey(!1,new Map)}constructor(e,t){this.isLeaf=e,this.children=t}}class ev{insert(e,t,s,n){let i=new ex(n,this.nodes.length,e,t,s);this.beginNodes[e].push(i),this.endNodes[e+t].push(i),this.nodes.push(i)}viterbi(){let e=this.len,t=0;for(;t<=e;){if(0==this.beginNodes[t].length)return[];for(let e of this.beginNodes[t]){e.prev=null;let s=0,n=null;for(let i of this.endNodes[t]){let t=i.backtraceScore+e.score;(null===n||t>s)&&(n=i.clone(),s=t)}if(null===n)return[];e.prev=n,e.backtraceScore=s}++t}let s=[],n=this.beginNodes[e][0].prev;if(null===n)return[];let i=n.clone();for(;null!==i.prev;)s.push(i.clone()),i=i.clone().prev.clone();return s.reverse(),s}piece(e){return this.sentence.slice(e.pos,e.pos+e.length)}tokens(){return this.viterbi().map(e=>this.piece(e))}tokenIds(){return this.viterbi().map(e=>e.tokenId)}constructor(e,t,s){this.sentence=e,this.len=e.length,this.bosTokenId=t,this.eosTokenId=s,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);let n=new ex(this.bosTokenId,0,0,0,0),i=new ex(this.eosTokenId,1,this.len,0,0);this.nodes.push(n.clone()),this.nodes.push(i.clone()),this.beginNodes[this.len].push(i),this.endNodes[0].push(n)}}class ex{clone(){let e=new ex(this.tokenId,this.nodeId,this.pos,this.length,this.score);return e.prev=this.prev,e.backtraceScore=this.backtraceScore,e}constructor(e,t,s,n,i){this.tokenId=e,this.nodeId=t,this.pos=s,this.length=n,this.score=i,this.prev=null,this.backtraceScore=0}}var ek=s(9992);async function eb(e,t){let s=await Promise.all([H(e,"tokenizer.json",!0,t),H(e,"tokenizer_config.json",!0,t)]);return null!==t.legacy&&(s[1].legacy=t.legacy),s}function eM(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(void 0!==e.Regex){let t=e.Regex.replace(/\\([#&~])/g,"$1");for(let[e,s]of eF)t=t.replaceAll(e,s);return RegExp(t,"gu")}if(void 0===e.String)return console.warn("Unknown pattern type:",e),null;{let s=o(e.String);return RegExp(t?s:"(".concat(s,")"),"gu")}}function eA(e){return new Map(Object.entries(e))}function eS(e){let t=e.dims;switch(t.length){case 1:return e.tolist();case 2:if(1!==t[0])throw Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return e.tolist()[0];default:throw Error("Expected tensor to have 1-2 dimensions, got ".concat(t.length,"."))}}function ez(e){return e.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function eE(e){return e.replace(/[\u0300-\u036f]/g,"")}let eC="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",eF=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"]]);class eT{constructor(e){var t,s,n,i,r;this.content=e.content,this.id=e.id,this.single_word=null!==(t=e.single_word)&&void 0!==t&&t,this.lstrip=null!==(s=e.lstrip)&&void 0!==s&&s,this.rstrip=null!==(n=e.rstrip)&&void 0!==n&&n,this.special=null!==(i=e.special)&&void 0!==i&&i,this.normalized=null!==(r=e.normalized)&&void 0!==r?r:null}}class eP extends l{static fromConfig(e){for(var t=arguments.length,s=Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];switch(e.type){case"WordPiece":return new eL(e);case"Unigram":return new eO(e,...s);case"BPE":return new ej(e);default:if(e.vocab)return new eN(e,...s);throw Error("Unknown TokenizerModel type: ".concat(e.type))}}_call(e){let t=this.encode(e);return this.fuse_unk&&(t=function(e,t,s){let n=[],i=0;for(;i<e.length;){var r,a;if(n.push(e[i]),(null!==(r=s.get(e[i]))&&void 0!==r?r:t)!==t){++i;continue}for(;i<e.length&&(null!==(a=s.get(e[i]))&&void 0!==a?a:t)===t;)++i}return n}(t,this.unk_token_id,this.tokens_to_ids)),t}encode(e){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(e){return e.map(e=>{var t;return null!==(t=this.tokens_to_ids.get(e))&&void 0!==t?t:this.unk_token_id})}convert_ids_to_tokens(e){return e.map(e=>{var t;return null!==(t=this.vocab[e])&&void 0!==t?t:this.unk_token})}constructor(e){var t;super(),this.config=e,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=null!==(t=this.config.fuse_unk)&&void 0!==t&&t}}class eL extends eP{encode(e){let t=[];for(let s of e){let e=[...s];if(e.length>this.max_input_chars_per_word){t.push(this.unk_token);continue}let n=!1,i=0,r=[];for(;i<e.length;){let t=e.length,s=null;for(;i<t;){let n=e.slice(i,t).join("");if(i>0&&(n=this.config.continuing_subword_prefix+n),this.tokens_to_ids.has(n)){s=n;break}--t}if(null===s){n=!0;break}r.push(s),i=t}n?t.push(this.unk_token):t.push(...r)}return t}constructor(e){var t;for(let[s,n]of(super(e),this.tokens_to_ids=eA(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.max_input_chars_per_word=null!==(t=e.max_input_chars_per_word)&&void 0!==t?t:100,this.vocab=Array(this.tokens_to_ids.size),this.tokens_to_ids))this.vocab[n]=s}}class eO extends eP{populateNodes(e){let t=e.sentence,s=t.length,n=0;for(;n<s;){let s=!1,i=[];for(let r of this.trie.commonPrefixSearch(t.slice(n))){i.push(r);let t=this.tokens_to_ids.get(r),a=this.scores[t],o=r.length;e.insert(n,o,a,t),s||1!==o||(s=!0)}s||e.insert(n,1,this.unkScore,this.unk_token_id),n+=1}}tokenize(e){let t=new ev(e,this.bosTokenId,this.eosTokenId);return this.populateNodes(t),t.tokens()}encode(e){let t=[];for(let s of e){let e=this.tokenize(s);t.push(...e)}return t}constructor(e,t){super(e);let s=e.vocab.length;this.vocab=Array(s),this.scores=Array(s);for(let t=0;t<s;++t){let s=e.vocab[t];this.vocab[t]=s[0],this.scores[t]=s[1]}this.unk_token_id=e.unk_id,this.unk_token=this.vocab[e.unk_id],this.tokens_to_ids=new Map(this.vocab.map((e,t)=>[e,t])),this.bosToken=" ",this.bosTokenId=this.tokens_to_ids.get(this.bosToken),this.eosToken=t.eos_token,this.eosTokenId=this.tokens_to_ids.get(this.eosToken),this.unkToken=this.vocab[this.unk_token_id],this.minScore=Z(this.scores)[0],this.unkScore=this.minScore-10,this.scores[this.unk_token_id]=this.unkScore,this.trie=new ew,this.trie.extend(this.vocab),this.fuse_unk=!0}}let eI=(()=>{let e=[...Array.from({length:94},(e,t)=>t+33),...Array.from({length:12},(e,t)=>t+161),...Array.from({length:82},(e,t)=>t+174)],t=e.slice(),s=0;for(let n=0;n<256;++n)e.includes(n)||(e.push(n),t.push(256+s),s+=1);let n=t.map(e=>String.fromCharCode(e));return Object.fromEntries(e.map((e,t)=>[e,n[t]]))})(),eB=Object.fromEntries(Object.entries(eI).map(e=>{let[t,s]=e;return[s,t]}));class ej extends eP{bpe(e){if(0===e.length)return[];let t=this.cache.get(e);if(void 0!==t)return t;let s=Array.from(e);this.end_of_word_suffix&&(s[s.length-1]+=this.end_of_word_suffix);let n=[];if(s.length>1){let e=new eg((e,t)=>e.score<t.score),t={token:s[0],bias:0,prev:null,next:null},i=t;for(let t=1;t<s.length;++t){let n={bias:t/s.length,token:s[t],prev:i,next:null};i.next=n,this._add_node(e,i),i=n}for(;!e.isEmpty();){let s=e.pop();if(s.deleted||!s.next||s.next.deleted)continue;if(s.deleted=!0,s.next.deleted=!0,s.prev){let e={...s.prev};s.prev.deleted=!0,s.prev=e,e.prev?e.prev.next=e:t=e}let n={token:s.token+s.next.token,bias:s.bias,prev:s.prev,next:s.next.next};n.prev?(n.prev.next=n,this._add_node(e,n.prev)):t=n,n.next&&(n.next.prev=n,this._add_node(e,n))}for(let e=t;null!==e;e=e.next)n.push(e.token)}else n=s;if(this.continuing_subword_suffix)for(let e=0;e<n.length-1;++e)n[e]+=this.continuing_subword_suffix;return this.cache.set(e,n),n}_add_node(e,t){let s=this.bpe_ranks.get(t.token+this.BPE_SPLIT_TOKEN+t.next.token);void 0!==s&&(t.score=s+t.bias,e.push(t))}encode(e){let t=[];for(let s of e)for(let e of this.bpe(s))this.tokens_to_ids.has(e)?t.push(e):this.byte_fallback?t.push(...Array.from(this.text_encoder.encode(e)).map(e=>"<0x".concat(e.toString(16).toUpperCase().padStart(2,"0"),">"))):t.push(this.unk_token);return t}constructor(e){var t,s;for(let[t,s]of(super(e),this.BPE_SPLIT_TOKEN=" ",this.tokens_to_ids=eA(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.vocab=Array(this.tokens_to_ids.size),this.tokens_to_ids))this.vocab[s]=t;this.bpe_ranks=new Map(e.merges.map((e,t)=>[e,t])),this.merges=e.merges.map(e=>e.split(this.BPE_SPLIT_TOKEN)),this.end_of_word_suffix=e.end_of_word_suffix,this.continuing_subword_suffix=null!==(t=e.continuing_subword_suffix)&&void 0!==t?t:null,this.byte_fallback=null!==(s=this.config.byte_fallback)&&void 0!==s&&s,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.cache=new Map}}class eN extends eP{encode(e){return e}constructor(e,t){for(let[s,n]of(super(e),this.tokens_to_ids=eA(t.target_lang?e.vocab[t.target_lang]:e.vocab),this.bos_token=t.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=t.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=t.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=t.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=Array(this.tokens_to_ids.size),this.tokens_to_ids))this.vocab[n]=s}}class eq extends l{static fromConfig(e){if(null===e)return null;switch(e.type){case"BertNormalizer":return new eQ(e);case"Precompiled":return new td(e);case"Sequence":return new eH(e);case"Replace":return new eD(e);case"NFC":return new eR(e);case"NFKC":return new eU(e);case"NFKD":return new eG(e);case"Strip":return new eW(e);case"StripAccents":return new eV(e);case"Lowercase":return new eX(e);case"Prepend":return new eK(e);default:throw Error("Unknown Normalizer type: ".concat(e.type))}}normalize(e){throw Error("normalize should be implemented in subclass.")}_call(e){return this.normalize(e)}constructor(e){super(),this.config=e}}class eD extends eq{normalize(e){let t=eM(this.config.pattern);return null===t?e:e.replaceAll(t,this.config.content)}}class eR extends eq{normalize(e){return e=e.normalize("NFC")}}class eU extends eq{normalize(e){return e=e.normalize("NFKC")}}class eG extends eq{normalize(e){return e=e.normalize("NFKD")}}class eW extends eq{normalize(e){return this.config.strip_left&&this.config.strip_right?e=e.trim():(this.config.strip_left&&(e=e.trimStart()),this.config.strip_right&&(e=e.trimEnd())),e}}class eV extends eq{normalize(e){return e=eE(e)}}class eX extends eq{normalize(e){return e=e.toLowerCase()}}class eK extends eq{normalize(e){return e=this.config.prepend+e}}class eH extends eq{normalize(e){return this.normalizers.reduce((e,t)=>t.normalize(e),e)}constructor(e){super(e),this.normalizers=e.normalizers.map(e=>eq.fromConfig(e))}}class eQ extends eq{_tokenize_chinese_chars(e){let t=[];for(let s=0;s<e.length;++s){let n=e[s],i=n.charCodeAt(0);this._is_chinese_char(i)?(t.push(" "),t.push(n),t.push(" ")):t.push(n)}return t.join("")}_is_chinese_char(e){return e>=19968&&e<=40959||e>=13312&&e<=19903||e>=131072&&e<=173791||e>=173824&&e<=177983||e>=177984&&e<=178207||e>=178208&&e<=183983||e>=63744&&e<=64255||e>=194560&&e<=195103}stripAccents(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}_is_control(e){switch(e){case"	":case"\n":case"\r":return!1;default:return RegExp("^\\p{Cc}|\\p{Cf}|\\p{Co}|\\p{Cs}$","u").test(e)}}_clean_text(e){let t=[];for(let s of e){let e=s.charCodeAt(0);0===e||65533===e||this._is_control(s)||(/^\s$/.test(s)?t.push(" "):t.push(s))}return t.join("")}normalize(e){return this.config.clean_text&&(e=this._clean_text(e)),this.config.handle_chinese_chars&&(e=this._tokenize_chinese_chars(e)),this.config.lowercase?(e=e.toLowerCase(),!1!==this.config.strip_accents&&(e=this.stripAccents(e))):this.config.strip_accents&&(e=this.stripAccents(e)),e}}class eY extends l{static fromConfig(e){if(null===e)return null;switch(e.type){case"BertPreTokenizer":return new e$(e);case"Sequence":return new th(e);case"Whitespace":return new tu(e);case"WhitespaceSplit":return new t_(e);case"Metaspace":return new tl(e);case"ByteLevel":return new eJ(e);case"Split":return new eZ(e);case"Punctuation":return new e0(e);case"Digits":return new e1(e);case"Replace":return new tp(e);default:throw Error("Unknown PreTokenizer type: ".concat(e.type))}}pre_tokenize_text(e,t){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(e,t){return(Array.isArray(e)?e.map(e=>this.pre_tokenize_text(e,t)):this.pre_tokenize_text(e,t)).flat()}_call(e,t){return this.pre_tokenize(e,t)}}class e$ extends eY{pre_tokenize_text(e,t){return e.trim().match(this.pattern)||[]}constructor(e){super(),this.pattern=RegExp("[^\\s".concat(eC,"]+|[").concat(eC,"]"),"gu")}}class eJ extends eY{pre_tokenize_text(e,t){return this.add_prefix_space&&!e.startsWith(" ")&&(e=" "+e),(this.use_regex?e.match(this.pattern)||[]:[e]).map(e=>Array.from(this.text_encoder.encode(e),e=>this.byte_encoder[e]).join(""))}constructor(e){var t;super(),this.config=e,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=null===(t=this.config.use_regex)||void 0===t||t,this.pattern=RegExp("'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+","gu"),this.byte_encoder=eI,this.text_encoder=new TextEncoder}}class eZ extends eY{pre_tokenize_text(e,t){return null===this.pattern?[]:this.config.invert?e.match(this.pattern)||[]:function(e,t){let s=[],n=0;for(let i of e.matchAll(t)){let t=i[0];n<i.index&&s.push(e.slice(n,i.index)),t.length>0&&s.push(t),n=i.index+t.length}return n<e.length&&s.push(e.slice(n)),s}(e,this.pattern)}constructor(e){super(),this.config=e,this.pattern=eM(this.config.pattern,this.config.invert)}}class e0 extends eY{pre_tokenize_text(e,t){return e.match(this.pattern)||[]}constructor(e){super(),this.config=e,this.pattern=RegExp("[^".concat(eC,"]+|[").concat(eC,"]+"),"gu")}}class e1 extends eY{pre_tokenize_text(e,t){return e.match(this.pattern)||[]}constructor(e){super(),this.config=e;let t="[^\\d]+|\\d".concat(this.config.individual_digits?"":"+");this.pattern=RegExp(t,"gu")}}class e2 extends l{static fromConfig(e){if(null===e)return null;switch(e.type){case"TemplateProcessing":return new e5(e);case"ByteLevel":return new e6(e);case"RobertaProcessing":return new e4(e);case"BertProcessing":return new e3(e);default:throw Error("Unknown PostProcessor type: ".concat(e.type))}}post_process(e){for(var t=arguments.length,s=Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];throw Error("post_process should be implemented in subclass.")}_call(e){for(var t=arguments.length,s=Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];return this.post_process(e,...s)}constructor(e){super(),this.config=e}}class e3 extends e2{post_process(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{add_special_tokens:s=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s&&(e=u([this.cls],e,[this.sep]));let n=Array(e.length).fill(0);if(null!==t){let i=s&&this instanceof e4?[this.sep]:[],r=s?[this.sep]:[];e=u(e,i,t,r),n=u(n,Array(t.length+i.length+r.length).fill(1))}return{tokens:e,token_type_ids:n}}constructor(e){super(e),this.cls=e.cls[0],this.sep=e.sep[0]}}class e4 extends e3{}class e5 extends e2{post_process(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{add_special_tokens:s=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=null===t?this.single:this.pair,i=[],r=[];for(let a of n)"SpecialToken"in a?s&&(i.push(a.SpecialToken.id),r.push(a.SpecialToken.type_id)):"Sequence"in a&&("A"===a.Sequence.id?(i=u(i,e),r=u(r,Array(e.length).fill(a.Sequence.type_id))):"B"===a.Sequence.id&&(i=u(i,t),r=u(r,Array(t.length).fill(a.Sequence.type_id))));return{tokens:i,token_type_ids:r}}constructor(e){super(e),this.single=e.single,this.pair=e.pair}}class e6 extends e2{post_process(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t&&(e=u(e,t)),{tokens:e}}}class e8 extends l{static fromConfig(e){if(null===e)return null;switch(e.type){case"WordPiece":return new ts(e);case"Metaspace":return new tc(e);case"ByteLevel":return new tn(e);case"Replace":return new e7(e);case"ByteFallback":return new e9(e);case"Fuse":return new te(e);case"Strip":return new tt(e);case"Sequence":return new tr(e);case"CTC":return new ti(e);case"BPEDecoder":return new ta(e);default:throw Error("Unknown Decoder type: ".concat(e.type))}}_call(e){return this.decode(e)}decode(e){return this.decode_chain(e).join("")}decode_chain(e){throw Error("`decode_chain` should be implemented in subclass.")}constructor(e){super(),this.config=e,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=e.trim_offsets}}class e7 extends e8{decode_chain(e){let t=eM(this.config.pattern);return null===t?e:e.map(e=>e.replaceAll(t,this.config.content))}}class e9 extends e8{decode_chain(e){let t=[],s=[];for(let n of e){let e=null;if(6===n.length&&n.startsWith("<0x")&&n.endsWith(">")){let t=parseInt(n.slice(3,5),16);isNaN(t)||(e=t)}if(null!==e)s.push(e);else{if(s.length>0){let e=this.text_decoder.decode(Uint8Array.from(s));t.push(e),s=[]}t.push(n)}}if(s.length>0){let e=this.text_decoder.decode(Uint8Array.from(s));t.push(e),s=[]}return t}constructor(e){super(e),this.text_decoder=new TextDecoder}}class te extends e8{decode_chain(e){return[e.join("")]}}class tt extends e8{decode_chain(e){return e.map(e=>{let t=0;for(let s=0;s<this.start;++s){if(e[s]===this.content){t=s+1;continue}break}let s=e.length;for(let t=0;t<this.stop;++t){let n=e.length-t-1;if(e[n]===this.content){s=n;continue}break}return e.slice(t,s)})}constructor(e){super(e),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}}class ts extends e8{decode_chain(e){return e.map((e,t)=>(0!==t&&(e=e.startsWith(this.config.prefix)?e.replace(this.config.prefix,""):" "+e),this.cleanup&&(e=ez(e)),e))}constructor(e){super(e),this.cleanup=e.cleanup}}class tn extends e8{convert_tokens_to_string(e){let t=e.join(""),s=new Uint8Array([...t].map(e=>this.byte_decoder[e]));return this.text_decoder.decode(s)}decode_chain(e){let t=[],s=[];for(let n of e)void 0!==this.added_tokens.find(e=>e.content===n)?(s.length>0&&(t.push(this.convert_tokens_to_string(s)),s=[]),t.push(n)):s.push(n);return s.length>0&&t.push(this.convert_tokens_to_string(s)),t}constructor(e){super(e),this.byte_decoder=eB,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}}class ti extends e8{convert_tokens_to_string(e){if(0===e.length)return"";let t=[e[0]];for(let s=1;s<e.length;++s)e[s]!==t.at(-1)&&t.push(e[s]);let s=t.filter(e=>e!==this.pad_token).join("");return this.cleanup&&(s=ez(s).replaceAll(this.word_delimiter_token," ").trim()),s}decode_chain(e){return[this.convert_tokens_to_string(e)]}constructor(e){super(e),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}}class tr extends e8{decode_chain(e){return this.decoders.reduce((e,t)=>t.decode_chain(e),e)}constructor(e){super(e),this.decoders=e.decoders.map(e=>e8.fromConfig(e))}}class ta extends e8{decode_chain(e){return e.map((t,s)=>t.replaceAll(this.suffix,s===e.length-1?"":" "))}constructor(e){super(e),this.suffix=this.config.suffix}}class to extends e8{decode_chain(e){let t="";for(let s=1;s<e.length;s+=2)t+=e[s];return[t]}}class tl extends eY{pre_tokenize_text(e){let{section_index:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!s.startsWith(this.replacement)&&("always"===this.prepend_scheme||"first"===this.prepend_scheme&&0===t)&&(s=this.strRep+s),[s]}constructor(e){var t;super(),this.addPrefixSpace=e.add_prefix_space,this.replacement=e.replacement,this.strRep=e.str_rep||this.replacement,this.prepend_scheme=null!==(t=e.prepend_scheme)&&void 0!==t?t:"always"}}class tc extends e8{decode_chain(e){let t=[];for(let s=0;s<e.length;++s){let n=e[s].replaceAll(this.replacement," ");this.addPrefixSpace&&0==s&&n.startsWith(" ")&&(n=n.substring(1)),t.push(n)}return t}constructor(e){super(e),this.addPrefixSpace=e.add_prefix_space,this.replacement=e.replacement}}class td extends eq{normalize(e){return e=(e=(e=e.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,"")).replace(/[\u0009\u000A\u000C\u000D\u1680\u200B\u200C\u200E\u200F\u2028\u2029\u2581\uFEFF\uFFFD]/gm," ")).includes("～")?e.split("～").map(e=>e.normalize("NFKC")).join("～"):e.normalize("NFKC")}constructor(e){super(e),this.charsmap=e.precompiled_charsmap}}class th extends eY{pre_tokenize_text(e,t){return this.tokenizers.reduce((e,s)=>s.pre_tokenize(e,t),[e])}constructor(e){super(),this.tokenizers=e.pretokenizers.map(e=>eY.fromConfig(e))}}class tu extends eY{pre_tokenize_text(e,t){return e.match(/\w+|[^\w\s]+/g)||[]}constructor(e){super()}}class t_ extends eY{pre_tokenize_text(e,t){return e.match(/\S+/g)||[]}constructor(e){super()}}class tp extends eY{pre_tokenize_text(e,t){return null===this.pattern?[e]:[e.replaceAll(this.pattern,this.config.content)]}constructor(e){super(),this.config=e,this.pattern=eM(this.config.pattern),this.content=this.config.content}}let tf=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];class tm extends l{getToken(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];for(let e of t){let t=this._tokenizer_config[e];if(t){if("object"!=typeof t)return t;if("AddedToken"===t.__type)return t.content;throw Error("Unknown token: ".concat(t))}}return null}static async from_pretrained(e){let{progress_callback:t=null,config:s=null,cache_dir:n=null,local_files_only:i=!1,revision:r="main",legacy:a=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new this(...await eb(e,{progress_callback:t,config:s,cache_dir:n,local_files_only:i,revision:r,legacy:a}))}_call(e){let t,{text_pair:s=null,add_special_tokens:n=!0,padding:i=!1,truncation:r=null,max_length:a=null,return_tensor:o=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=Array.isArray(e);if(l){if(0===e.length)throw Error("text array must be non-empty");if(null!==s){if(Array.isArray(s)){if(e.length!==s.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");t=e.map((e,t)=>this._encode_plus(e,s[t],{add_special_tokens:n}))}else t=e.map(e=>this._encode_plus(e,null,{add_special_tokens:n}))}else{if(null===e)throw Error("text may not be null");if(Array.isArray(s))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");t=[this._encode_plus(e,s,{add_special_tokens:n})]}if(null===a?a="max_length"===i?this.model_max_length:ee(t.map(e=>e.input_ids.length))[0]:r||console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation=true` to explicitly truncate examples to max length."),a=Math.min(a,this.model_max_length),i||r)for(let e=0;e<t.length;++e)t[e].input_ids.length!==a&&(t[e].input_ids.length>a?r&&function(e,t){for(let s of Object.keys(e))e[s].length=t}(t[e],a):i&&function(e,t,s,n){for(let i of Object.keys(e)){let r=t-e[i].length,a=s(i),o=Array(r).fill(a);e[i]="right"===n?u(e[i],o):u(o,e[i])}}(t[e],a,e=>"input_ids"===e?this.pad_token_id:0,this.padding_side));let c={};if(o){if(!(i&&r)&&t.some(e=>{for(let n of Object.keys(e)){var s;if(e[n].length!==(null===(s=t[0][n])||void 0===s?void 0:s.length))return!0}return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");let e=[t.length,t[0].input_ids.length];for(let s of Object.keys(t[0]))c[s]=new el("int64",BigInt64Array.from(t.flatMap(e=>e[s]).map(BigInt)),e)}else{for(let e of Object.keys(t[0]))c[e]=t.map(t=>t[e]);if(!l)for(let e of Object.keys(c))c[e]=c[e][0]}return c}_encode_text(e){return null===e?null:(this.added_tokens_regex?e.split(this.added_tokens_regex).filter(e=>e):[e]).map((e,t)=>{if(void 0!==this.added_tokens.find(t=>t.content===e))return e;{if(!0===this.remove_space&&(e=e.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(e=eE(e.toLowerCase())),null!==this.normalizer&&(e=this.normalizer(e)),0===e.length)return[];let s=null!==this.pre_tokenizer?this.pre_tokenizer(e,{section_index:t}):[e];return this.model(s)}}).flat()}_encode_plus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{add_special_tokens:s=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this._encode_text(e),i=this._encode_text(t),r=this.post_processor?this.post_processor(n,i,{add_special_tokens:s}):{tokens:u(null!=n?n:[],null!=i?i:[])},a=this.model.convert_tokens_to_ids(r.tokens),o={input_ids:a,attention_mask:Array(a.length).fill(1)};return this.return_token_type_ids&&r.token_type_ids&&(o.token_type_ids=r.token_type_ids),o}encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{add_special_tokens:s=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{input_ids:n}=this._encode_plus(e,t,{add_special_tokens:s});return n}batch_decode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof el&&(e=e.tolist()),e.map(e=>this.decode(e,t))}decode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e instanceof el&&(e=eS(e)),!Array.isArray(e)||0===e.length||!c(e[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(e,t)}decode_single(e,t){let{skip_special_tokens:s=!1,clean_up_tokenization_spaces:n=null}=t,i=this.model.convert_ids_to_tokens(e);s&&(i=i.filter(e=>!this.special_tokens.includes(e)));let r=this.decoder?this.decoder(i):i.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(r=r.replaceAll(this.decoder.end_of_word_suffix," "),s&&(r=r.trim())),(null!=n?n:this.clean_up_tokenization_spaces)&&(r=ez(r)),r}get default_chat_template(){return this._warned_about_chat_template||(console.warn("No chat template is defined for this tokenizer - using a default chat template that implements the ChatML format. If the default is not appropriate for your model, please set `tokenizer.chat_template` to an appropriate template. See https://huggingface.co/docs/transformers/main/chat_templating for more information."),this._warned_about_chat_template=!0),this._default_chat_template}apply_chat_template(e){var t;let{chat_template:s=null,add_generation_prompt:n=!1,tokenize:i=!0,padding:r=!1,truncation:a=!1,max_length:o=null,return_tensor:l=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!=s||(s=null!==(t=this.chat_template)&&void 0!==t?t:this.default_chat_template);let c=this._compiled_template_cache.get(s);void 0===c&&(c=new ek.YS(s),this._compiled_template_cache.set(s,c));let d=Object.create(null);for(let e of tf){let t=this.getToken(e);t&&(d[e]=t)}let h=c.render({messages:e,add_generation_prompt:n,...d});return i?this._call(h,{add_special_tokens:!1,padding:r,truncation:a,max_length:o,return_tensor:l}).input_ids:h}constructor(e,t){var s,n,i,r;for(let s of(super(),this.return_token_type_ids=!1,this._default_chat_template="{% for message in messages %}{{'<|im_start|>' + message['role'] + '\n' + message['content'] + '<|im_end|>' + '\n'}}{% endfor %}{% if add_generation_prompt %}{{ '<|im_start|>assistant\n' }}{% endif %}",this._tokenizer_config=t,this.normalizer=eq.fromConfig(e.normalizer),this.pre_tokenizer=eY.fromConfig(e.pre_tokenizer),this.model=eP.fromConfig(e.model,t),this.post_processor=e2.fromConfig(e.post_processor),this.decoder=e8.fromConfig(e.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[],e.added_tokens)){let e=new eT(s);this.added_tokens.push(e),this.model.tokens_to_ids.set(e.content,e.id),this.model.vocab[e.id]=e.content,e.special&&(this.special_tokens.push(e.content),this.all_special_ids.push(e.id))}this.additional_special_tokens=null!==(s=t.additional_special_tokens)&&void 0!==s?s:[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_regex=this.added_tokens.length>0?new RegExp(this.added_tokens.map(e=>"".concat(e.lstrip?"\\s*":"","(").concat(o(e.content),")").concat(e.rstrip?"\\s*":"")).join("|")):null,this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.model_max_length=t.model_max_length,this.remove_space=t.remove_space,this.clean_up_tokenization_spaces=null===(n=t.clean_up_tokenization_spaces)||void 0===n||n,this.do_lowercase_and_remove_accent=null!==(i=t.do_lowercase_and_remove_accent)&&void 0!==i&&i,this.padding_side="right",this.legacy=!1,this.chat_template=null!==(r=t.chat_template)&&void 0!==r?r:null,this._compiled_template_cache=new Map}}class tg extends tm{constructor(...e){super(...e),this.return_token_type_ids=!0}}class tw extends tm{constructor(...e){super(...e),this.return_token_type_ids=!0}}class ty extends tm{constructor(...e){super(...e),this.return_token_type_ids=!0}}class tv extends tm{constructor(...e){super(...e),this.return_token_type_ids=!0}}class tx extends tm{constructor(...e){super(...e),this.return_token_type_ids=!0}}class tk extends tm{constructor(...e){super(...e),this.return_token_type_ids=!0}}class tb extends tm{constructor(...e){super(...e),this.return_token_type_ids=!0}}class tM extends tm{constructor(...e){super(...e),this.return_token_type_ids=!0}}class tA extends tm{constructor(...e){super(...e),this.return_token_type_ids=!0}}class tS extends tm{}class tz extends tm{}class tE extends tm{constructor(e,t){super(e,t),this.return_token_type_ids=!0,console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class tC extends tm{constructor(...e){super(...e),this.return_token_type_ids=!0}}class tF extends tm{}class tT extends tm{constructor(...e){super(...e),this._default_chat_template='{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}'}}class tP extends tm{}class tL extends tm{_build_translation_inputs(e,t,s){return tX(this,e,t,s)}constructor(e,t){super(e,t),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(e=>this.languageRegex.test(e)),this.lang_to_token=e=>e}}class tO extends tL{}class tI extends tm{}class tB extends tT{constructor(e,t){var s,n;let i=".,!?…。，、।۔،",r=null===(n=e.pre_tokenizer)||void 0===n?void 0:null===(s=n.pretokenizers[0])||void 0===s?void 0:s.pattern;r&&r.Regex===" ?[^(\\s|[".concat(i,"])]+")&&(r.Regex=" ?[^\\s".concat(i,"]+")),super(e,t)}}class tj extends tm{_encode_text(e){if(null===e)return null;if(this.legacy||0===e.length)return super._encode_text(e);let t=super._encode_text("▁"+e.replaceAll("▁"," "));return t.length>1&&"▁"===t[0]&&this.special_tokens.includes(t[1])&&(t=t.slice(1)),t}get default_chat_template(){return super.default_chat_template.replaceAll("USE_DEFAULT_PROMPT",this.use_default_system_prompt?"true":"false").replaceAll("DEFAULT_SYSTEM_MESSAGE",this.DEFAULT_SYSTEM_PROMPT.replaceAll("\n","\\n").replaceAll("'","\\'"))}constructor(e,t){var s,n;super(e,t),this._default_chat_template="{% if messages[0]['role'] == 'system' %}{% set loop_messages = messages[1:] %}{% set system_message = messages[0]['content'] %}{% elif USE_DEFAULT_PROMPT == true and not '<<SYS>>' in messages[0]['content'] %}{% set loop_messages = messages %}{% set system_message = 'DEFAULT_SYSTEM_MESSAGE' %}{% else %}{% set loop_messages = messages %}{% set system_message = false %}{% endif %}{% for message in loop_messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if loop.index0 == 0 and system_message != false %}{% set content = '<<SYS>>\n' + system_message + '\n<</SYS>>\n\n' + message['content'] %}{% else %}{% set content = message['content'] %}{% endif %}{% if message['role'] == 'user' %}{{ bos_token + '[INST] ' + content.strip() + ' [/INST]' }}{% elif message['role'] == 'system' %}{{ '<<SYS>>\n' + content.strip() + '\n<</SYS>>\n\n' }}{% elif message['role'] == 'assistant' %}{{ ' '  + content.strip() + ' ' + eos_token }}{% endif %}{% endfor %}",this.DEFAULT_SYSTEM_PROMPT="You are a helpful, respectful and honest assistant. Always answer as helpfully as possible, while being safe. Your answers should not include any harmful, unethical, racist, sexist, toxic, dangerous, or illegal content. Please ensure that your responses are socially unbiased and positive in nature.\n\nIf a question does not make any sense, or is not factually coherent, explain why instead of answering something not correct. If you don't know the answer to a question, please don't share false information.",this.use_default_system_prompt=null!==(s=t.use_default_system_prompt)&&void 0!==s&&s,this.legacy=null===(n=t.legacy)||void 0===n||n,this.legacy||(this.normalizer=null,this.pre_tokenizer=new tl({replacement:"▁",add_prefix_space:!0,prepend_scheme:"first"}))}}class tN extends tj{}class tq extends tm{}class tD extends tm{}class tR extends tm{}class tU extends tm{}class tG extends tm{}class tW extends tm{}class tV extends tm{constructor(...e){super(...e),this._default_chat_template="{% if messages[0]['role'] == 'system' %}{{ raise_exception('System role not supported') }}{% endif %}{% for message in messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if (message['role'] == 'assistant') %}{% set role = 'model' %}{% else %}{% set role = message['role'] %}{% endif %}{{ '<start_of_turn>' + role + '\n' + message['content'] | trim + '<end_of_turn>\n' }}{% endfor %}{% if add_generation_prompt %}{{'<start_of_turn>model\n'}}{% endif %}"}}function tX(e,t,s,n){if(!("language_codes"in e)||!Array.isArray(e.language_codes))throw Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in e)||!(e.languageRegex instanceof RegExp))throw Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in e)||"function"!=typeof e.lang_to_token)throw Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");let i=n.src_lang,r=n.tgt_lang;if(!e.language_codes.includes(r))throw Error('Target language code "'.concat(r,'" is not valid. Must be one of: {').concat(e.language_codes.join(", "),"}"));if(void 0!==i){if(!e.language_codes.includes(i))throw Error('Source language code "'.concat(i,'" is not valid. Must be one of: {').concat(e.language_codes.join(", "),"}"));for(let t of e.post_processor.config.single)if("SpecialToken"in t&&e.languageRegex.test(t.SpecialToken.id)){t.SpecialToken.id=e.lang_to_token(i);break}}return n.forced_bos_token_id=e.model.convert_tokens_to_ids([e.lang_to_token(r)])[0],e._call(t,s)}class tK extends tm{_build_translation_inputs(e,t,s){return tX(this,e,t,s)}constructor(e,t){super(e,t),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(e=>this.languageRegex.test(e)),this.lang_to_token=e=>e}}class tH extends tm{_build_translation_inputs(e,t,s){return tX(this,e,t,s)}constructor(e,t){super(e,t),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(e=>this.languageRegex.test(e)).map(e=>e.slice(2,-2)),this.lang_to_token=e=>"__".concat(e,"__")}}let tQ=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],tY=new Map(tQ),t$=new Map([...tQ.map(e=>{let[t,s]=e;return[s,t]}),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);class tJ extends tm{_decode_asr(e){let{return_timestamps:t=!1,return_language:s=!1,time_precision:n=null,force_full_sequences:i=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===n)throw Error("Must specify time_precision");let r=null,a="word"===t;function o(){return{language:r,timestamp:[null,null],text:""}}let l=[],c=o(),d=0,h=this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1,u=[],_=[],p=!1,f=null,m=new Set(this.all_special_ids);for(let s of e){let e=s.tokens,i=a?s.token_timestamps:null,g=null,w=h;if("stride"in s){let[t,i,r]=s.stride;if(d-=i,f=t-r,i&&(w=i/n+h),r)for(let t=e.length-1;t>=0;--t){let s=e[t];if(s>=h){if(null!==g&&(s-h)*n<f)break;g=s}}}let y=[],v=[];for(let s=0;s<e.length;++s){let f=e[s];if(m.has(f)){let e=this.decode([f]),s=tY.get(e.slice(2,-2));if(void 0!==s){if(null!==r&&s!==r&&!t){u.push(y);let e=this.findLongestCommonSequence(u)[0],t=this.decode(e);c.text=t,l.push(c),u=[],y=[],c=o()}r=c.language=s}}else if(f>=h){let e=er((f-h)*n+d,2);if(null!==g&&f>=g)p=!0;else if(p||u.length>0&&f<w)p=!1;else if(null===c.timestamp[0])c.timestamp[0]=e;else if(e===c.timestamp[0]);else{c.timestamp[1]=e,u.push(y),a&&_.push(v);let[t,s]=this.findLongestCommonSequence(u,_),n=this.decode(t);c.text=n,a&&(c.words=this.collateWordTimestamps(t,s,r)),l.push(c),u=[],y=[],_=[],v=[],c=o()}}else if(y.push(f),a){let e,t=er(i[s]+d,2);e=s+1<i.length?er(i[s+1]+d,2):null,v.push([t,e])}}if("stride"in s){let[e,t,n]=s.stride;d+=e-n}y.length>0?(u.push(y),a&&_.push(v)):u.every(e=>0===e.length)&&(c=o(),u=[],y=[],_=[],v=[])}if(u.length>0){if(i&&t)throw Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");let[e,s]=this.findLongestCommonSequence(u,_),n=this.decode(e);c.text=n,a&&(c.words=this.collateWordTimestamps(e,s,r)),l.push(c)}let g=Object.create(null),w=l.map(e=>e.text).join("");if(t||s){for(let e=0;e<l.length;++e){let n=l[e];t||delete n.timestamp,s||delete n.language}if(a){let e=[];for(let t of l)for(let s of t.words)e.push(s);g={chunks:e}}else g={chunks:l}}return[w,g]}findLongestCommonSequence(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=e[0],n=s.length,i=[],r=Array.isArray(t)&&t.length>0,a=r?[]:null,o=r?t[0]:null;for(let l=1;l<e.length;++l){let c=e[l],d=0,h=[n,n,0,0],u=c.length;for(let e=1;e<n+u;++e){let t=e/1e4,i=Math.max(0,n-e),r=Math.min(n,n+u-e),a=s.slice(i,r),o=Math.max(0,e-n),l=Math.min(u,e),_=c.slice(o,l);if(a.length!==_.length)throw Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let p=a.filter((e,t)=>e===_[t]).length,f=p/e+t;p>1&&f>d&&(d=f,h=[i,r,o,l])}let[_,p,f,m]=h,g=Math.floor((p+_)/2),w=Math.floor((m+f)/2);i.push(...s.slice(0,g)),n=(s=c.slice(w)).length,r&&(a.push(...o.slice(0,g)),o=t[l].slice(w))}return(i.push(...s),r)?(a.push(...o),[i,a]):[i,[]]}collateWordTimestamps(e,t,s){let[n,i,r]=this.combineTokensIntoWords(e,s),a=[];for(let e=0;e<n.length;++e){let s=r[e];a.push({text:n[e],timestamp:[t[s.at(0)][0],t[s.at(-1)][1]]})}return a}combineTokensIntoWords(e,t){let s,n,i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\"'“\xa1\xbf([{-",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"\"'.。,，!！?？:：”)]}、";return["chinese","japanese","thai","lao","myanmar"].includes(t=null!=t?t:"english")?[s,n,i]=this.splitTokensOnUnicode(e):[s,n,i]=this.splitTokensOnSpaces(e),this.mergePunctuations(s,n,i,r,a)}decode(e,t){let s;return t&&t.decode_with_timestamps?(e instanceof el&&(e=eS(e)),s=this.decodeWithTimestamps(e,t)):s=super.decode(e,t),s}decodeWithTimestamps(e,t){var s;let n=null!==(s=null==t?void 0:t.time_precision)&&void 0!==s?s:.02,i=Array.from(this.all_special_ids).at(-1)+1,r=[[]];for(let t of e)if(t>=i){let e=er((t-i)*n,2);r.push("<|".concat(e,"|>")),r.push([])}else r[r.length-1].push(t);return(r=r.map(e=>"string"==typeof e?e:super.decode(e,t))).join("")}splitTokensOnUnicode(e){let t=this.decode(e,{decode_with_timestamps:!0}),s=[],n=[],i=[],r=[],a=[],o=0;for(let l=0;l<e.length;++l){let c=e[l];r.push(c),a.push(l);let d=this.decode(r,{decode_with_timestamps:!0});d.includes("�")&&"�"!==t[o+d.indexOf("�")]||(s.push(d),n.push(r),i.push(a),r=[],a=[],o+=d.length)}return[s,n,i]}splitTokensOnSpaces(e){let[t,s,n]=this.splitTokensOnUnicode(e),i=[],r=[],a=[],o=RegExp("^[".concat(eC,"]$"),"gu");for(let e=0;e<t.length;++e){let l=t[e],c=s[e],d=n[e],h=c[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),u=l.startsWith(" "),_=l.trim(),p=o.test(_);if(h||u||p||0===i.length)i.push(l),r.push(c),a.push(d);else{let e=i.length-1;i[e]+=l,r[e].push(...c),a[e].push(...d)}}return[i,r,a]}mergePunctuations(e,t,s,n,i){let r=structuredClone(e),a=structuredClone(t),o=structuredClone(s),l=r.length-2,c=r.length-1;for(;l>=0;)r[l].startsWith(" ")&&n.includes(r[l].trim())?(r[c]=r[l]+r[c],a[c]=u(a[l],a[c]),o[c]=u(o[l],o[c]),r[l]="",a[l]=[],o[l]=[]):c=l,--l;for(l=0,c=1;c<r.length;)!r[l].endsWith(" ")&&i.includes(r[c])?(r[l]+=r[c],a[l]=u(a[l],a[c]),o[l]=u(o[l],o[c]),r[c]="",a[c]=[],o[c]=[]):l=c,++c;return[r.filter(e=>e),a.filter(e=>e.length>0),o.filter(e=>e.length>0)]}get_decoder_prompt_ids(){let{language:e=null,task:t=null,no_timestamps:s=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=[];if(e){e=e.toLowerCase();let t=t$.get(e);if(void 0===t){if(tY.has(e))t=e;else{let t=2===e.length?tY.keys():tY.values();throw Error('Language "'.concat(e,'" is not supported. Must be one of: ').concat(JSON.stringify(t)))}}let s=this.model.tokens_to_ids.get("<|".concat(t,"|>"));if(void 0===s)throw Error('Unable to find language "'.concat(t,'" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.'));n.push(s)}else n.push(null);if(t){if("transcribe"!==(t=t.toLowerCase())&&"translate"!==t)throw Error('Task "'.concat(t,'" is not supported. Must be one of: ["transcribe", "translate"]'));let e=this.model.tokens_to_ids.get("<|".concat(t,"|>"));if(void 0===e)throw Error('Unable to find task "'.concat(t,'" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.'));n.push(e)}else n.push(null);if(s){let e=this.model.tokens_to_ids.get("<|notimestamps|>");if(void 0===e)throw Error('Unable to find "<|notimestamps|>" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.');n.push(e)}return n.map((e,t)=>[t+1,e]).filter(e=>null!==e[1])}constructor(...e){super(...e),this._default_chat_template='{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}'}}class tZ extends tm{}class t0 extends tm{}class t1 extends tm{}class t2 extends tm{_encode_text(e){if(null===e)return null;let[t,...s]=e.trim().split(this.languageRegex);if(0===s.length)return super._encode_text(t);if(2===s.length){let[e,t]=s;return this.supported_language_codes.includes(e)||console.warn('Unsupported language code "'.concat(e,'" detected, which may lead to unexpected behavior. Should be one of: ').concat(JSON.stringify(this.supported_language_codes))),u([e],super._encode_text(t))}}constructor(e,t){super(e,t),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(e=>this.languageRegex.test(e)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class t3 extends tm{}class t4 extends tm{constructor(...e){super(...e),this._default_chat_template="{% for message in messages %}{% if message['role'] == 'user' %}{{ ' ' }}{% endif %}{{ message['content'] }}{% if not loop.last %}{{ '  ' }}{% endif %}{% endfor %}{{ eos_token }}"}}class t5 extends t4{}class t6 extends tm{}class t8 extends tm{}class t7 extends tm{constructor(e,t){super(e,t),this.decoder=new to({})}}class t9{static async from_pretrained(e){var t,s;let{quantized:n=!0,progress_callback:i=null,config:r=null,cache_dir:a=null,local_files_only:o=!1,revision:l="main",legacy:c=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[d,h]=await eb(e,{quantized:n,progress_callback:i,config:r,cache_dir:a,local_files_only:o,revision:l,legacy:c}),u=null!==(s=null===(t=h.tokenizer_class)||void 0===t?void 0:t.replace(/Fast$/,""))&&void 0!==s?s:"PreTrainedTokenizer",_=this.TOKENIZER_CLASS_MAPPING[u];return _||(console.warn('Unknown tokenizer class "'.concat(u,'", attempting to construct from base class.')),_=tm),new _(d,h)}}async function se(e,t){return await H(e,"config.json",!0,t)}t9.TOKENIZER_CLASS_MAPPING={T5Tokenizer:tF,DistilBertTokenizer:tS,CamembertTokenizer:tz,DebertaTokenizer:tx,DebertaV2Tokenizer:tk,BertTokenizer:tg,HerbertTokenizer:tb,ConvBertTokenizer:tM,RoFormerTokenizer:tA,XLMTokenizer:tE,ElectraTokenizer:tC,MobileBertTokenizer:ty,SqueezeBertTokenizer:tv,AlbertTokenizer:tw,GPT2Tokenizer:tT,BartTokenizer:tP,MBartTokenizer:tL,MBart50Tokenizer:tO,RobertaTokenizer:tI,WhisperTokenizer:tJ,CodeGenTokenizer:tZ,CLIPTokenizer:t0,SiglipTokenizer:t1,MarianTokenizer:t2,BloomTokenizer:tB,NllbTokenizer:tK,M2M100Tokenizer:tH,LlamaTokenizer:tj,CodeLlamaTokenizer:tN,XLMRobertaTokenizer:tq,MPNetTokenizer:tD,FalconTokenizer:tR,GPTNeoXTokenizer:tU,EsmTokenizer:tG,Wav2Vec2CTCTokenizer:t3,BlenderbotTokenizer:t4,BlenderbotSmallTokenizer:t5,SpeechT5Tokenizer:t6,NougatTokenizer:t8,VitsTokenizer:t7,Qwen2Tokenizer:tW,GemmaTokenizer:tV,PreTrainedTokenizer:tm};class st{static async from_pretrained(e){let{progress_callback:t=null,config:s=null,cache_dir:n=null,local_files_only:i=!1,revision:r="main"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new this(null!=s?s:await se(e,{progress_callback:t,config:s,cache_dir:n,local_files_only:i,revision:r}))}constructor(e){this.model_type=null,this.is_encoder_decoder=!1,Object.assign(this,e)}}class ss{static async from_pretrained(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return st.from_pretrained(...t)}}class sn extends l{push(e){this.processors.push(e)}extend(e){this.processors.push(...e)}_call(e,t){for(let s of t)this.processors.forEach(t=>t(e,s))}[Symbol.iterator](){return this.processors.values()}constructor(){super(),this.processors=[]}}class si extends l{_call(e,t){throw Error("`_call` should be implemented in a subclass")}}class sr extends si{_call(e,t){let s=this.force_token_map[e.length];return null!=s&&(t.data.fill(-1/0),t.data[s]=0),t}constructor(e){super(),this.force_token_map=Object.fromEntries(null!=e?e:[])}}class sa extends si{_call(e,t){return 1===e.length&&(t.data.fill(-1/0),t.data[this.bos_token_id]=0),t}constructor(e){super(),this.bos_token_id=e}}class so extends si{_call(e,t){}constructor(e,t){super(),this.max_length=e,this.forced_eos_token_id=t}}class sl extends si{_call(e,t){if(e.length===this.begin_index)for(let e of this.begin_suppress_tokens)t.data[e]=-1/0;return t}constructor(e,t){super(),this.begin_suppress_tokens=e,this.begin_index=t}}class sc extends si{_call(e,t){let s=t.data;if(s[this.no_timestamps_token_id]=-1/0,e.length===this.begin_index-1)return s.fill(-1/0),s[this.timestamp_begin]=0,t;let n=e.slice(this.begin_index),i=n.length>=1&&n[n.length-1]>=this.timestamp_begin,r=n.length<2||n[n.length-2]>=this.timestamp_begin;if(i&&(r?s.subarray(this.timestamp_begin).fill(-1/0):s.subarray(0,this.eos_token_id).fill(-1/0)),e.length===this.begin_index&&null!==this.max_initial_timestamp_index){let e=this.timestamp_begin+this.max_initial_timestamp_index;s.subarray(e+1).fill(-1/0)}let a=$(s).map(e=>Math.log(e));return Math.log(a.subarray(this.timestamp_begin).map(Math.exp).reduce((e,t)=>e+t))>ee(a.subarray(0,this.timestamp_begin))[0]&&s.subarray(0,this.timestamp_begin).fill(-1/0),t}constructor(e){super(),this.eos_token_id=e.eos_token_id,this.no_timestamps_token_id=e.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=(e.forced_decoder_ids||[]).length+2,e.forced_decoder_ids.slice(-1)[0][1]===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=e.max_initial_timestamp_index}}class sd extends si{getNgrams(e){let t=e.length,s=[];for(let n=0;n<t+1-this.no_repeat_ngram_size;++n){let t=[];for(let s=0;s<this.no_repeat_ngram_size;++s)t.push(e[n+s]);s.push(t)}let n=new Map;for(let e of s){var i;let t=JSON.stringify(e.slice(0,e.length-1)),s=null!==(i=n.get(t))&&void 0!==i?i:[];s.push(e[e.length-1]),n.set(t,s)}return n}getGeneratedNgrams(e,t){var s;let n=t.slice(t.length+1-this.no_repeat_ngram_size,t.length);return null!==(s=e.get(JSON.stringify(n)))&&void 0!==s?s:[]}calcBannedNgramTokens(e){if(e.length+1<this.no_repeat_ngram_size)return[];{let t=this.getNgrams(e);return this.getGeneratedNgrams(t,e)}}_call(e,t){for(let s of this.calcBannedNgramTokens(e))t.data[s]=-1/0;return t}constructor(e){super(),this.no_repeat_ngram_size=e}}class sh extends si{_call(e,t){for(let s of e)t.data[s]<0?t.data[s]*=this.penalty:t.data[s]/=this.penalty;return t}constructor(e){super(),this.penalty=e}}class su extends si{_call(e,t){if(e.length<this.min_length)for(let e of this.eos_token_id)t.data[e]=-1/0;return t}constructor(e,t){super(),this.min_length=e,this.eos_token_id=Array.isArray(t)?t:[t]}}class s_ extends si{_call(e,t){if(e.length-this.prompt_length_to_skip<this.min_new_tokens)for(let e of this.eos_token_id)t.data[e]=-1/0;return t}constructor(e,t,s){super(),this.prompt_length_to_skip=e,this.min_new_tokens=t,this.eos_token_id=Array.isArray(s)?s:[s]}}class sp extends si{_call(e,t){for(let s of this.bad_words_ids){let n=!0;for(let t=1;t<=s.length-1&&s.length<e.length;++t)if(s.at(-t-1)!==e.at(-t)){n=!1;break}n&&(t.data[s.at(-1)]=-1/0)}return t}constructor(e,t){super(),this.bad_words_ids=e,this.eos_token_id=Array.isArray(t)?t:[t]}}let sf=class{constructor(e={}){var t,s,n,i,r,a,o,l,c,d,h,u,_,p,f,m,g,w,y,v,x,k,b,M,A,S,z,E,C,F,T,P,L,O,I,B,j,N,q,D,R,U,G,W;this.max_length=null!==(t=e.max_length)&&void 0!==t?t:20,this.max_new_tokens=null!==(s=e.max_new_tokens)&&void 0!==s?s:null,this.min_length=null!==(n=e.min_length)&&void 0!==n?n:0,this.min_new_tokens=null!==(i=e.min_new_tokens)&&void 0!==i?i:null,this.early_stopping=null!==(r=e.early_stopping)&&void 0!==r&&r,this.max_time=null!==(a=e.max_time)&&void 0!==a?a:null,this.do_sample=null!==(o=e.do_sample)&&void 0!==o&&o,this.num_beams=null!==(l=e.num_beams)&&void 0!==l?l:1,this.num_beam_groups=null!==(c=e.num_beam_groups)&&void 0!==c?c:1,this.penalty_alpha=null!==(d=e.penalty_alpha)&&void 0!==d?d:null,this.use_cache=null===(h=e.use_cache)||void 0===h||h,this.temperature=null!==(u=e.temperature)&&void 0!==u?u:1,this.top_k=null!==(_=e.top_k)&&void 0!==_?_:50,this.top_p=null!==(p=e.top_p)&&void 0!==p?p:1,this.typical_p=null!==(f=e.typical_p)&&void 0!==f?f:1,this.epsilon_cutoff=null!==(m=e.epsilon_cutoff)&&void 0!==m?m:0,this.eta_cutoff=null!==(g=e.eta_cutoff)&&void 0!==g?g:0,this.diversity_penalty=null!==(w=e.diversity_penalty)&&void 0!==w?w:0,this.repetition_penalty=null!==(y=e.repetition_penalty)&&void 0!==y?y:1,this.encoder_repetition_penalty=null!==(v=e.encoder_repetition_penalty)&&void 0!==v?v:1,this.length_penalty=null!==(x=e.length_penalty)&&void 0!==x?x:1,this.no_repeat_ngram_size=null!==(k=e.no_repeat_ngram_size)&&void 0!==k?k:0,this.bad_words_ids=null!==(b=e.bad_words_ids)&&void 0!==b?b:null,this.force_words_ids=null!==(M=e.force_words_ids)&&void 0!==M?M:null,this.renormalize_logits=null!==(A=e.renormalize_logits)&&void 0!==A&&A,this.constraints=null!==(S=e.constraints)&&void 0!==S?S:null,this.forced_bos_token_id=null!==(z=e.forced_bos_token_id)&&void 0!==z?z:null,this.forced_eos_token_id=null!==(E=e.forced_eos_token_id)&&void 0!==E?E:null,this.remove_invalid_values=null!==(C=e.remove_invalid_values)&&void 0!==C&&C,this.exponential_decay_length_penalty=null!==(F=e.exponential_decay_length_penalty)&&void 0!==F?F:null,this.suppress_tokens=null!==(T=e.suppress_tokens)&&void 0!==T?T:null,this.begin_suppress_tokens=null!==(P=e.begin_suppress_tokens)&&void 0!==P?P:null,this.forced_decoder_ids=null!==(L=e.forced_decoder_ids)&&void 0!==L?L:null,this.num_return_sequences=null!==(O=e.num_return_sequences)&&void 0!==O?O:1,this.output_attentions=null!==(I=e.output_attentions)&&void 0!==I&&I,this.output_hidden_states=null!==(B=e.output_hidden_states)&&void 0!==B&&B,this.output_scores=null!==(j=e.output_scores)&&void 0!==j&&j,this.return_dict_in_generate=null!==(N=e.return_dict_in_generate)&&void 0!==N&&N,this.pad_token_id=null!==(q=e.pad_token_id)&&void 0!==q?q:null,this.bos_token_id=null!==(D=e.bos_token_id)&&void 0!==D?D:null,this.eos_token_id=null!==(R=e.eos_token_id)&&void 0!==R?R:null,this.encoder_no_repeat_ngram_size=null!==(U=e.encoder_no_repeat_ngram_size)&&void 0!==U?U:0,this.decoder_start_token_id=null!==(G=e.decoder_start_token_id)&&void 0!==G?G:null,this.generation_kwargs=null!==(W=e.generation_kwargs)&&void 0!==W?W:{}}};class sm extends l{_call(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return this.sample(e,t)}sample(e,t){throw Error("sample should be implemented in subclasses.")}getLogits(e,t){let s=e.dims.at(-1),n=e.data;if(-1===t)n=n.slice(-s);else{let e=t*s;n=n.slice(e,e+s)}return this.generation_config.temperature>0&&(n=n.map(e=>e/this.generation_config.temperature)),n}randomSelect(e){let t=Math.random()*e.reduce((e,t)=>e+t,0);for(let s=0;s<e.length;++s)if((t-=e[s])<=0)return s;return 0}static getSampler(e){if(e.do_sample)return new sw(e);if(e.num_beams>1)return new sy(e);if(e.num_return_sequences>1)throw Error("num_return_sequences has to be 1 when doing greedy search, but is ".concat(e.num_return_sequences,"."));return new sg(e)}constructor(e){super(),this.generation_config=e}}class sg extends sm{sample(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return[[ee(this.getLogits(e,t))[1],0]]}}class sw extends sm{sample(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,s=e.dims.at(-1);this.generation_config.top_k>0&&(s=Math.min(this.generation_config.top_k,s));let n=J(this.getLogits(e,t),s),i=$(n.map(e=>e[1]));return Array.from({length:this.generation_config.num_beams},()=>{let e=this.randomSelect(i);return[n[e][0],Math.log(i[e])]})}}class sy extends sm{sample(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,s=e.dims.at(-1);this.generation_config.top_k>0&&(s=Math.min(this.generation_config.top_k,s));let n=J(this.getLogits(e,t),s),i=$(n.map(e=>e[1]));return Array.from({length:this.generation_config.num_beams},(e,t)=>[n[t][0],Math.log(i[t])])}}let{InferenceSession:sv,Tensor:sx,env:sk}=n,sb={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5},sM=new Map,sA=new Map,sS=new Map;async function sz(e,t,s){let n="onnx/".concat(t).concat(s.quantized?"_quantized":"",".onnx"),i=await K(e,n,!0,s);try{return await sv.create(i,{executionProviders:S})}catch(e){if(1===S.length&&"wasm"===S[0])throw e;return console.warn(e),console.warn("Something went wrong during model construction (most likely a missing operation). Using `wasm` as a fallback. "),await sv.create(i,{executionProviders:["wasm"]})}}async function sE(e,t){let s=function(e,t){let s=Object.create(null),n=[];for(let i of e.inputNames){let e=t[i];if(!(e instanceof el)){n.push(i);continue}s[i]=sk.wasm.proxy?e.clone():e}if(n.length>0)throw Error('An error occurred during model execution: "Missing the following inputs: '.concat(n.join(", "),"."));let i=Object.keys(t).length,r=e.inputNames.length;if(i>r){let s=Object.keys(t).filter(t=>!e.inputNames.includes(t));console.warn("WARNING: Too many inputs were provided (".concat(i," > ").concat(r,'). The following inputs will be ignored: "').concat(s.join(", "),'".'))}return s}(e,t);try{let t=await e.run(s);return t=function e(t){for(let s in t)t[s]instanceof sx?t[s]=new el(t[s]):"object"==typeof t[s]&&e(t[s]);return t}(t)}catch(e){throw console.error('An error occurred during model execution: "'.concat(e,'".')),console.error("Inputs given to model:",s),e}}function sC(e,t){var s,n;let i=null!==(s=e.config.pad_token_id)&&void 0!==s?s:null,r=null!==(n=e.config.eos_token_id)&&void 0!==n?n:null;c(r)&&(r=[r]);let a=-1!==t.indexOf(i),o=null===r||!r.includes(i);return a&&o?new el("int64",BigInt64Array.from(t.data.map(e=>e!=i)),t.dims):function(e){let t=e.reduce((e,t)=>e*t,1);return new el("int64",new BigInt64Array(t).fill(1n),e)}(t.dims)}function sF(e,t,s){if(!e.inputNames.includes("position_ids"))return;let n=new BigInt64Array(t.attention_mask.data.length);for(let e=0;e<t.attention_mask.dims[0];++e){let s=e*t.attention_mask.dims[1],i=BigInt(0);for(let e=0;e<t.attention_mask.dims[1];++e){let r=s+e;0n===t.attention_mask.data[r]?n[r]=BigInt(1):(n[r]=i,i+=t.attention_mask.data[r])}}t.position_ids=new el("int64",n,t.attention_mask.dims),s&&(t.position_ids=t.position_ids.slice(null,-1).unsqueeze_(-1))}function sT(e){return new el("bool",[e],[1])}async function sP(e,t){let{encoder_outputs:s,past_key_values:n}=t;s||(s=(await sB(e,t)).last_hidden_state);let i={input_ids:t.decoder_input_ids,encoder_hidden_states:s},r=!!n;e.decoder_merged_session.inputNames.includes("use_cache_branch")&&(i.use_cache_branch=sT(r)),e.decoder_merged_session.inputNames.includes("encoder_attention_mask")&&(i.encoder_attention_mask=t.attention_mask),sF(e.decoder_merged_session,i,r),e.addPastKeyValues(i,n);let a=await sE(e.decoder_merged_session,i);return new lm({logits:a.logits,past_key_values:n=e.getPastKeyValues(a,n),encoder_outputs:s,...e.getAttentions(a)})}function sL(e,t,s,n){var i,r,a,o;let l=[],c=0,d=null===(i=e.requires_attention_mask)||void 0===i||i,h=null!==(o=null!==(a=null!==(r=s.decoder_input_ids)&&void 0!==r?r:s.decoder_start_token_id)&&void 0!==a?a:s.bos_token_id)&&void 0!==o?o:s.eos_token_id;for(let s of(h instanceof el?h=h.tolist().flat():Array.isArray(h)||(h=[h]),t)){s.dims=[1,...s.dims];let t={inputs:s,encoder_outputs:null,prev_model_outputs:null,output_token_ids:h,done:!1,score:0,id:c++};d&&(t.attention_mask=sC(e,s)),l.push(t)}return l}async function sO(e,t){var s;let n=e.main_input_name,i=t.output_token_ids;t.prev_model_outputs&&(i=i.slice(-1));let r={[n]:t.inputs,decoder_input_ids:function(e){if(e instanceof el)return e;if(0===e.length)throw Error("items must be non-empty");if(!Array.isArray(e[0]))return new el("int64",BigInt64Array.from(e.map(e=>BigInt(e))),[1,e.length]);if(e.some(t=>t.length!==e[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new el("int64",BigInt64Array.from(e.flat().map(e=>BigInt(e))),[e.length,e[0].length])}(i),encoder_outputs:t.encoder_outputs,past_key_values:null===(s=t.prev_model_outputs)||void 0===s?void 0:s.past_key_values};t.attention_mask&&(r.attention_mask=t.attention_mask);let a=await e.forward(r);return t.prev_model_outputs=a,t.encoder_outputs=a.encoder_outputs,a}function sI(e,t){e.output_token_ids=[...e.output_token_ids,t]}async function sB(e,t){let s=Object.create(null);for(let n of e.session.inputNames)s[n]=t[n];return e.session.inputNames.includes("token_type_ids")&&!s.token_type_ids&&(s.token_type_ids=new el("int64",new BigInt64Array(s.input_ids.data.length),s.input_ids.dims)),await sE(e.session,s)}async function sj(e,t){let{input_ids:s,past_key_values:n,attention_mask:i}=t,r={input_ids:s,attention_mask:null!=i?i:sC(e,s)},a=!!n;e.session.inputNames.includes("use_cache_branch")&&(r.use_cache_branch=sT(a)),sF(e.session,r,a),e.addPastKeyValues(r,n);let o=await sE(e.session,r);return{logits:o.logits,past_key_values:n=e.getPastKeyValues(o,n)}}function sN(e,t,s,n,i){let r=[],a=0;for(let s of t){let t,o=s.tolist().map(Number);s.dims=[1,...s.dims],i?(t=i[a]).dims=[1,...t.dims]:t=sC(e,s);let l={input:s,model_input_ids:s,attention_mask:t,prev_model_outputs:null,output_token_ids:o,num_output_tokens:n,done:!1,score:0,id:a++};r.push(l)}return r}async function sq(e,t){var s;let n=new BigInt64Array(t.output_token_ids.length).fill(1n),i={input_ids:t.model_input_ids,attention_mask:new el("int64",n,[1,n.length]),past_key_values:null===(s=t.prev_model_outputs)||void 0===s?void 0:s.past_key_values},r=await e.forward(i);return t.prev_model_outputs=r,r}function sD(e,t){e.output_token_ids=[...e.output_token_ids,t],e.model_input_ids=new el("int64",[BigInt(t)],[1,1])}class sR extends l{async dispose(){let e=[];for(let t of Object.keys(this)){let s=this[t];s instanceof sv&&e.push(s.handler.dispose())}return await Promise.all(e)}static async from_pretrained(e){var t,s;let n,{quantized:i=!0,progress_callback:r=null,config:a=null,cache_dir:o=null,local_files_only:l=!1,revision:c="main",model_file_name:d=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h={quantized:i,progress_callback:r,config:a,cache_dir:o,local_files_only:l,revision:c,model_file_name:d},u=sS.get(this),_=sM.get(u);return _===sb.DecoderOnly?n=await Promise.all([ss.from_pretrained(e,h),sz(e,null!==(t=h.model_file_name)&&void 0!==t?t:"decoder_model_merged",h),H(e,"generation_config.json",!1,h)]):_===sb.Seq2Seq||_===sb.Vision2Seq?n=await Promise.all([ss.from_pretrained(e,h),sz(e,"encoder_model",h),sz(e,"decoder_model_merged",h),H(e,"generation_config.json",!1,h)]):_===sb.MaskGeneration?n=await Promise.all([ss.from_pretrained(e,h),sz(e,"vision_encoder",h),sz(e,"prompt_encoder_mask_decoder",h)]):_===sb.EncoderDecoder?n=await Promise.all([ss.from_pretrained(e,h),sz(e,"encoder_model",h),sz(e,"decoder_model_merged",h)]):(_!==sb.EncoderOnly&&console.warn("Model type for '".concat(null!=u?u:null==a?void 0:a.model_type,"' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.")),n=await Promise.all([ss.from_pretrained(e,h),sz(e,null!==(s=h.model_file_name)&&void 0!==s?s:"model",h)])),new this(...n)}async _call(e){return await this.forward(e)}async forward(e){return await this._forward(this,e)}_get_logits_processor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new sn;if(null!==e.repetition_penalty&&1!==e.repetition_penalty&&n.push(new sh(e.repetition_penalty)),null!==e.no_repeat_ngram_size&&e.no_repeat_ngram_size>0&&n.push(new sd(e.no_repeat_ngram_size)),null!==e.bad_words_ids&&n.push(new sp(e.bad_words_ids,e.eos_token_id)),null!==e.min_length&&null!==e.eos_token_id&&e.min_length>0&&n.push(new su(e.min_length,e.eos_token_id)),null!==e.min_new_tokens&&null!==e.eos_token_id&&e.min_new_tokens>0&&n.push(new s_(t,e.min_new_tokens,e.eos_token_id)),null!==e.forced_bos_token_id&&n.push(new sa(e.forced_bos_token_id)),null!==e.forced_eos_token_id&&n.push(new so(e.max_length,e.forced_eos_token_id)),null!==e.begin_suppress_tokens){let s=t>1||null===e.forced_bos_token_id?t:t+1;null!==e.forced_decoder_ids&&(s+=e.forced_decoder_ids[e.forced_decoder_ids.length-1][0]),n.push(new sl(e.begin_suppress_tokens,s))}return null!==e.forced_decoder_ids&&n.push(new sr(e.forced_decoder_ids)),null!==s&&n.extend(s),n}_get_generation_config(e){let t=new sf(this.config);return"generation_config"in this&&Object.assign(t,this.generation_config),null!==e&&Object.assign(t,e),t}async generate(e){var t,s,n,i,r,a,o,l;let c,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,{inputs_attention_mask:u=null}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!this.can_generate){let e=sS.get(this.constructor),i="The current model class (".concat(e,") is not compatible with `.generate()`, as it doesn't have a language model head."),r=this.config.model_type,a=null!==(n=null!==(s=null!==(t=oB.get(r))&&void 0!==t?t:oI.get(r))&&void 0!==s?s:oF.get(r))&&void 0!==n?n:oq.get(r);throw a&&(i+=" Please use the following class instead: '".concat(a[0],"'")),Error(i)}if(!(e instanceof el)&&(null==e?void 0:null===(l=e.prototype)||void 0===l?void 0:null===(o=l.__proto__)||void 0===o?void 0:null===(a=o.constructor)||void 0===a?void 0:a.name)!=="TypedArray"&&!Array.isArray(e))throw Error('`inputs` must be a Tensor, TypedArray, or Array, but is "'.concat(e.constructor.name,'".'));if(this.config.is_encoder_decoder)c=0;else if(0===(c=e instanceof el?e.dims.at(-1):e.length))throw Error("Must supply a non-empty array of input token ids.");d=this._get_generation_config(d),h=null!=h?h:new sn,h=this._get_logits_processor(d,c,h);let _=d.eos_token_id;null===_||Array.isArray(_)||(_=[_]);let p=1,f=1+(null!==(i=d.max_new_tokens)&&void 0!==i?i:1/0),m=Number.isInteger(d.max_length)&&(null!==(r=d.max_new_tokens)&&void 0!==r?r:null)===null,g=sm.getSampler(d),w=this.getStartBeams(e,d,p,u);for(;w.some(e=>!e.done)&&p<f;){let e=[];for(let t of w){if(t.done){e.push(t);continue}if(m&&t.output_token_ids.length>=d.max_length){t.done=!0,e.push(t);continue}let s=await this.runBeam(t);d.output_attentions&&this.addAttentionsToBeam(t,s),d.output_scores;let n=s.logits.slice(null,-1,null);for(let[s,i]of(h(t.output_token_ids,n),g(n))){let n={...t};this.updateBeam(n,s),n.score+=i,_&&_.includes(s)&&(n.done=!0),e.push(n)}}++p,w=(e=this.groupBeams(e).map(e=>e.sort((e,t)=>t.score-e.score).slice(0,d.num_beams))).flat(),d.callback_function&&d.callback_function(w)}let y=this.groupBeams(w),v=e=>y.map(t=>d.num_return_sequences>1?t.slice(0,d.num_return_sequences).map(t=>t[e]):[t[0][e]]).flat(),x=v("output_token_ids");return d.return_dict_in_generate?{sequences:x,decoder_attentions:v("decoder_attentions"),cross_attentions:v("cross_attentions")}:x}addAttentionsToBeam(e,t){if(this.config.is_encoder_decoder){if(!t.cross_attentions||0===t.cross_attentions.length)throw Error("`output_attentions` is true, but the model did not produce cross-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.cross_attentions||(e.cross_attentions=[]),e.cross_attentions.push(t.cross_attentions)}if(!t.decoder_attentions||0===t.decoder_attentions.length)throw Error("`output_attentions` is true, but the model did not produce decoder-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.decoder_attentions||(e.decoder_attentions=[]),e.decoder_attentions.push(t.decoder_attentions)}groupBeams(e){let t=Object.create(null);for(let s of e)void 0===t[s.id]?t[s.id]=[s]:t[s.id].push(s);return Object.values(t)}getPastKeyValues(e,t){let s=Object.create(null);for(let n in e)if(n.startsWith("present")){let i=n.replace("present","past_key_values");t&&n.includes("encoder")?s[i]=t[i]:s[i]=e[n]}return s}getAttentions(e){let t=Object.create(null);for(let s of["cross_attentions","decoder_attentions"]){let n=[];for(let t in e)t.startsWith(s)&&(n[t.split(".").pop()]=e[t]);t[s]=n}return t}addPastKeyValues(e,t){if(t)Object.assign(e,t);else{var s;if(this.config.is_encoder_decoder&&(null===(s=this.add_encoder_pkv)||void 0===s||s)){let t=[1,this.num_encoder_heads,0,this.encoder_dim_kv],s=[1,this.num_decoder_heads,0,this.decoder_dim_kv];for(let n=0;n<this.num_decoder_layers;++n)e["past_key_values.".concat(n,".encoder.key")]=new el("float32",[],t),e["past_key_values.".concat(n,".encoder.value")]=new el("float32",[],t),e["past_key_values.".concat(n,".decoder.key")]=new el("float32",[],s),e["past_key_values.".concat(n,".decoder.value")]=new el("float32",[],s)}else if("falcon"===this.config.model_type){let t=[1*this.num_heads,0,this.dim_kv];for(let s=0;s<this.num_layers;++s)e["past_key_values.".concat(s,".key")]=new el("float32",[],t),e["past_key_values.".concat(s,".value")]=new el("float32",[],t)}else if(this.config.multi_query){let t=[1*this.num_heads,0,2*this.dim_kv];for(let s=0;s<this.num_layers;++s)e["past_key_values.".concat(s,".key_value")]=new el("float32",[],t)}else if("bloom"===this.config.model_type){let t=[1*this.num_heads,this.dim_kv,0],s=[1*this.num_heads,0,this.dim_kv];for(let n=0;n<this.num_layers;++n)e["past_key_values.".concat(n,".key")]=new el("float32",[],t),e["past_key_values.".concat(n,".value")]=new el("float32",[],s)}else{let t=[1,this.num_heads,0,this.dim_kv];for(let s=0;s<this.num_layers;++s)e["past_key_values.".concat(s,".key")]=new el("float32",[],t),e["past_key_values.".concat(s,".value")]=new el("float32",[],t)}}}getStartBeams(e,t,s,n){return this._getStartBeams(this,e,t,s,n)}async runBeam(e){return await this._runBeam(this,e)}updateBeam(e,t){return this._updateBeam(e,t)}constructor(e,t){super(),this.main_input_name="input_ids",this.config=e,this.session=t;let s=sS.get(this.constructor),n=sM.get(s);this.can_generate=!1,this._runBeam=null,this._getStartBeams=null,this._updateBeam=null,this._forward=null,n===sb.DecoderOnly?(this.can_generate=!0,this._runBeam=sq,this._getStartBeams=sN,this._updateBeam=sD,this._forward=sj):n===sb.Seq2Seq||n===sb.Vision2Seq?(this.can_generate=!0,this._runBeam=sO,this._getStartBeams=sL,this._updateBeam=sI,this._forward=sP):(sb.EncoderDecoder,this._forward=sB)}}class sU{}class sG extends sR{}class sW extends sG{}class sV extends sG{async _call(e){return new lv(await super._call(e))}}class sX extends sG{async _call(e){return new lg(await super._call(e))}}class sK extends sG{async _call(e){return new ly(await super._call(e))}}class sH extends sG{async _call(e){return new lx(await super._call(e))}}class sQ extends sR{}class sY extends sQ{}class s$ extends sR{}class sJ extends s${}class sZ extends s${async _call(e){return new lv(await super._call(e))}}class s0 extends s${async _call(e){return new lg(await super._call(e))}}class s1 extends s${async _call(e){return new ly(await super._call(e))}}class s2 extends s${async _call(e){return new lx(await super._call(e))}}class s3 extends sR{}class s4 extends s3{}class s5 extends s3{async _call(e){return new lv(await super._call(e))}}class s6 extends s3{async _call(e){return new lg(await super._call(e))}}class s8 extends s3{async _call(e){return new ly(await super._call(e))}}class s7 extends s3{async _call(e){return new lx(await super._call(e))}}class s9 extends sR{}class ne extends s9{}class nt extends s9{async _call(e){return new lv(await super._call(e))}}class ns extends s9{async _call(e){return new lg(await super._call(e))}}class nn extends s9{async _call(e){return new ly(await super._call(e))}}class ni extends s9{async _call(e){return new lx(await super._call(e))}}class nr extends sR{}class na extends nr{}class no extends nr{async _call(e){return new lv(await super._call(e))}}class nl extends nr{async _call(e){return new lg(await super._call(e))}}class nc extends nr{async _call(e){return new ly(await super._call(e))}}class nd extends nr{async _call(e){return new lx(await super._call(e))}}class nh extends sR{}class nu extends nh{}class n_ extends nh{async _call(e){return new lv(await super._call(e))}}class np extends nh{async _call(e){return new lg(await super._call(e))}}class nf extends nh{async _call(e){return new ly(await super._call(e))}}class nm extends nh{async _call(e){return new lx(await super._call(e))}}class ng extends sR{}class nw extends ng{}class ny extends ng{async _call(e){return new lv(await super._call(e))}}class nv extends ng{async _call(e){return new lg(await super._call(e))}}class nx extends ng{async _call(e){return new ly(await super._call(e))}}class nk extends ng{async _call(e){return new lx(await super._call(e))}}class nb extends sR{}class nM extends nb{}class nA extends nb{async _call(e){return new lg(await super._call(e))}}class nS extends nb{async _call(e){return new ly(await super._call(e))}}class nz extends nb{async _call(e){return new lx(await super._call(e))}}class nE extends nb{async _call(e){return new lv(await super._call(e))}}class nC extends sR{}class nF extends nC{}class nT extends nC{async _call(e){return new lv(await super._call(e))}}class nP extends nC{async _call(e){return new lg(await super._call(e))}}class nL extends nC{async _call(e){return new ly(await super._call(e))}}class nO extends sR{}class nI extends nO{}class nB extends nO{async _call(e){return new lv(await super._call(e))}}class nj extends nO{async _call(e){return new lg(await super._call(e))}}class nN extends nO{async _call(e){return new lx(await super._call(e))}}class nq extends sR{}class nD extends nq{}class nR extends nq{async _call(e){return new lv(await super._call(e))}}class nU extends nq{async _call(e){return new lg(await super._call(e))}}class nG extends nq{async _call(e){return new ly(await super._call(e))}}class nW extends nq{async _call(e){return new lx(await super._call(e))}}class nV extends sR{}class nX extends nV{}class nK extends nV{async _call(e){return new lv(await super._call(e))}}class nH extends nV{async _call(e){return new lg(await super._call(e))}}class nQ extends nV{async _call(e){return new lx(await super._call(e))}}class nY extends sR{}class n$ extends nY{}class nJ extends nY{async _call(e){return new lg(await super._call(e))}}class nZ extends nY{async _call(e){return new lx(await super._call(e))}}class n0 extends nY{async _call(e){return new lv(await super._call(e))}}class n1 extends sR{}class n2 extends n1{}class n3 extends n1{constructor(e,t,s,n){super(e,t),this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class n4 extends sR{}class n5 extends n4{}class n6 extends n4{constructor(e,t,s,n){super(e,t),this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class n8 extends sR{}class n7 extends n8{}class n9 extends n8{constructor(e,t,s,n){super(e,t),this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class ie extends sR{}class it extends ie{}class is extends ie{constructor(e,t,s,n){super(e,t),this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class ii extends ie{async _call(e){return new lg(await super._call(e))}}class ir extends sR{}class ia extends ir{}class io extends ir{constructor(e,t,s,n){super(e,t),this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class il extends ir{async _call(e){return new lg(await super._call(e))}}class ic extends ir{constructor(e,t,s){super(e,t),this.generation_config=s,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class id extends sR{}class ih extends id{}class iu extends id{constructor(e,t,s,n){super(e,t),this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class i_ extends sR{}class ip extends i_{}class im extends i_{constructor(e,t,s,n){super(e,t),this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class ig extends sR{}class iw extends ig{}class iy extends ig{async _call(e){return new lv(await super._call(e))}}class iv extends ig{async _call(e){return new lg(await super._call(e))}}class ix extends ig{async _call(e){return new ly(await super._call(e))}}class ik extends ig{async _call(e){return new lx(await super._call(e))}}class ib extends sR{}class iM extends ib{}class iA extends ib{async _call(e){return new lv(await super._call(e))}}class iS extends ib{async _call(e){return new lg(await super._call(e))}}class iz extends ib{async _call(e){return new ly(await super._call(e))}}class iE extends ib{async _call(e){return new lx(await super._call(e))}}class iC extends sR{}class iF extends iC{}class iT extends iC{async _call(e){return new lv(await super._call(e))}}class iP extends iC{async _call(e){return new lg(await super._call(e))}}class iL extends iC{async _call(e){return new ly(await super._call(e))}}class iO extends iC{async _call(e){return new lx(await super._call(e))}}class iI extends sR{}class iB extends iI{}class ij extends iI{}class iN extends sR{}class iq extends iN{}class iD extends iN{async generate(e){var t,s;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!==(s=(t=n=this._get_generation_config(n)).return_timestamps)&&void 0!==s||(t.return_timestamps=!1),n.return_timestamps&&(i=[new sc(n)]),n.return_token_timestamps&&(n.output_attentions=!0,n.return_dict_in_generate=!0,"translate"===n.task&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),!n.alignment_heads))throw Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");let r=await super.generate(e,n,i);return n.return_token_timestamps&&n.alignment_heads&&(r.token_timestamps=this._extract_token_timestamps(r,n.alignment_heads,n.num_frames)),r}_extract_token_timestamps(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.02;if(!e.cross_attentions)throw Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");let i=this.config.median_filter_width;void 0===i&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),i=7);let r=e.cross_attentions.map(e=>{let n=Array.from({length:this.config.decoder_layers},(t,s)=>ep(e.map(e=>e[s]),2)),r=ef(t.map(e=>{let[t,i]=e;return s?n[t].slice(null,i,null,[0,s]):n[t].slice(null,i)})),[a,o]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(null===t){let t=e.data.reduce((e,t)=>e+t,0)/e.data.length,n=Math.sqrt(e.data.reduce((e,s)=>e+(s-t)**2,0)/(e.data.length-s)),i=new el(e.type,[t],[]);return[new el(e.type,[n],[]),i]}t=e_(t,e.dims.length);let i=em(e,t,n),r=e.dims.slice();r[t]=1;let a=new e.data.constructor(e.data.length/e.dims[t]);for(let s=0;s<e.data.length;++s){let n=0;for(let i=e.dims.length-1,a=s,o=1;i>=0;--i){let s=e.dims[i];i!==t&&(n+=a%s*o,o*=r[i]),a=Math.floor(a/s)}a[n]+=(e.data[s]-i.data[n])**2}for(let n=0;n<a.length;++n)a[n]=Math.sqrt(a[n]/(e.dims[t]-s));return n||r.splice(t,1),[new el(e.type,a,r),i]}(r=r.transpose(1,0,2,3),-2,0,!0),l=r.clone();for(let e=0;e<l.dims[0];++e){let t=l[e];for(let s=0;s<t.dims[0];++s){let n=t[s],r=a[e][s][0],l=o[e][s][0];for(let e=0;e<n.dims[0];++e){let t=n[e];for(let e=0;e<t.data.length;++e)t.data[e]=(t.data[e]-l.data[e])/r.data[e];t.data.set(function(e,t){if(t%2==0||t<=0)throw Error("Window size must be a positive odd number");let s=new e.constructor(e.length),n=new e.constructor(t),i=Math.floor(t/2);for(let t=0;t<e.length;++t){let r=0;for(let s=-i;s<=i;++s){let i=t+s;i<0?i=Math.abs(i):i>=e.length&&(i=2*(e.length-1)-i),n[r++]=e[i]}n.sort(),s[t]=n[i]}return s}(t.data,i))}}}return em(l,1)}),a=[e.sequences.length,e.sequences[0].length],o=new el("float32",new Float32Array(a[0]*a[1]),a);for(let e=0;e<a[0];++e){let[t,s]=function(e){let[t,s]=e.dims,n=[t+1,s+1],i=new el("float32",new Float32Array(n[0]*n[1]).fill(1/0),n),r=new el("float32",new Float32Array(n[0]*n[1]).fill(-1),n);i[0].data[0]=0;for(let n=1;n<s+1;++n)for(let s=1;s<t+1;++s){let t,a;let o=i[s-1][n-1].item(),l=i[s-1][n].item(),c=i[s][n-1].item();o<l&&o<c?(t=o,a=0):l<o&&l<c?(t=l,a=1):(t=c,a=2),i[s].data[n]=e[s-1][n-1].item()+t,r[s].data[n]=a}let a=t,o=s;r.data.fill(2,0,n[1]);for(let e=0;e<n[0];++e)r[e].data[0]=1;let l=[],c=[];for(;a>0||o>0;)switch(l.push(a-1),c.push(o-1),r[a][o].item()){case 0:--a,--o;break;case 1:--a;break;case 2:--o;break;default:throw Error("Internal error in dynamic time warping. Unexpected trace[".concat(a,", ").concat(o,"]. Please file a bug report."))}return l.reverse(),c.reverse(),[l,c]}(r[e].neg().squeeze_(0)),i=u([1],Array.from({length:t.length-1},(e,s)=>t[s+1]-t[s])).map(e=>!!e),a=[];for(let e=0;e<i.length;++e)i[e]&&a.push(s[e]*n);o[e].data.set(a,1)}return o}constructor(e,t,s,n){super(e,t),this.requires_attention_mask=!1,this.main_input_name="input_features",this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class iR extends sR{constructor(e,t,s,n){var i;super(e,t),this.main_input_name="pixel_values",this.decoder_merged_session=s,this.generation_config=n;let r=this.config.encoder,a=this.config.decoder,o=r.model_type;(null!==(i=oz.get(o))&&void 0!==i?i:oE.get(o))||console.warn("Model type for encoder '".concat(o,"' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose."));let l=oB.get(a.model_type);if(!l)throw Error('Unable to construct `VisionEncoderDecoder` due to unsupported decoder: "'.concat(this.config.decoder.model_type,'"'));let c=new l[1](a,s,n);this.add_encoder_pkv="num_decoder_layers"in c,this.add_encoder_pkv?(this.num_decoder_layers=c.num_decoder_layers,this.num_decoder_heads=c.num_decoder_heads,this.decoder_dim_kv=c.decoder_dim_kv,this.num_encoder_layers=c.num_encoder_layers,this.num_encoder_heads=c.num_encoder_heads,this.encoder_dim_kv=c.encoder_dim_kv):(this.num_layers=c.num_layers,this.num_heads=c.num_heads,this.dim_kv=c.dim_kv)}}class iU extends sR{}class iG extends iU{}class iW extends iU{static async from_pretrained(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null!==(t=s.model_file_name)&&void 0!==t||(s.model_file_name="text_model"),super.from_pretrained(e,s)}}class iV extends iU{static async from_pretrained(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null!==(t=s.model_file_name)&&void 0!==t||(s.model_file_name="vision_model"),super.from_pretrained(e,s)}}class iX extends sR{}class iK extends iX{}class iH extends iX{static async from_pretrained(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null!==(t=s.model_file_name)&&void 0!==t||(s.model_file_name="text_model"),super.from_pretrained(e,s)}}class iQ extends iU{static async from_pretrained(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null!==(t=s.model_file_name)&&void 0!==t||(s.model_file_name="vision_model"),super.from_pretrained(e,s)}}class iY extends sR{}class i$ extends iY{}class iJ extends sR{}class iZ extends iJ{}class i0 extends iJ{}class i1 extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class i2 extends i1{}class i3 extends i1{}class i4 extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_heads,this.num_layers=this.config.num_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class i5 extends i4{}class i6 extends i4{}class i8 extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class i7 extends i8{}class i9 extends i8{}class re extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class rt extends re{}class rs extends re{}class rn extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class ri extends rn{}class rr extends rn{}class ra extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class ro extends ra{}class rl extends ra{}class rc extends sR{constructor(e,t,s){var n;super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=null!==(n=this.config.num_key_value_heads)&&void 0!==n?n:this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class rd extends rc{}class rh extends rc{}class ru extends sR{constructor(e,t,s){var n;super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=null!==(n=this.config.num_key_value_heads)&&void 0!==n?n:this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class r_ extends ru{}class rp extends ru{}class rf extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class rm extends rf{}class rg extends rf{}class rw extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.hidden_size/this.num_heads}}class ry extends rw{}class rv extends rw{}class rx extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_heads,this.num_layers=this.config.n_layers,this.dim_kv=this.config.d_model/this.num_heads}}class rk extends rx{}class rb extends rx{}class rM extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class rA extends rM{}class rS extends rM{}class rz extends sR{}class rE extends rz{}class rC extends rz{async _call(e){return new lg(await super._call(e))}}class rF extends sR{}class rT extends rF{async _call(e){return new lb(await super._call(e))}}class rP extends sR{}class rL extends rP{}class rO extends rP{async _call(e){return new lg(await super._call(e))}}class rI extends sR{}class rB extends rI{}class rj extends rI{}class rN extends sR{}class rq extends rN{}class rD extends rN{}class rR extends sR{}class rU extends rR{}class rG extends rR{async _call(e){return new lg(await super._call(e))}}class rW extends sR{}class rV extends rW{}class rX extends rW{async _call(e){return new rH(await super._call(e))}}class rK extends rW{async _call(e){return new rQ(await super._call(e))}}class rH extends sU{constructor({logits:e,pred_boxes:t}){super(),this.logits=e,this.pred_boxes=t}}class rQ extends sU{constructor({logits:e,pred_boxes:t,pred_masks:s}){super(),this.logits=e,this.pred_boxes=t,this.pred_masks=s}}class rY extends sR{}class r$ extends rY{}class rJ extends rY{async _call(e){return new rZ(await super._call(e))}}class rZ extends rH{}class r0 extends sR{}class r1 extends r0{}class r2 extends r0{async _call(e){return new lg(await super._call(e))}}class r3 extends sR{}class r4 extends r3{}class r5 extends r3{async _call(e){return new lg(await super._call(e))}}class r6 extends sR{}class r8 extends r6{}class r7 extends r6{async _call(e){return new lg(await super._call(e))}}class r9 extends sR{}class ae extends r9{}class at extends r9{}class as extends sR{}class an extends as{}class ai extends as{}class ar extends sR{}class aa extends ar{}class ao extends sR{}class al extends ao{}class ac extends ao{}class ad extends sR{}class ah extends ad{}class au extends sR{}class a_ extends au{}class ap extends au{async _call(e){return new lg(await super._call(e))}}class af extends sR{}class am extends af{}class ag extends af{async _call(e){return new lg(await super._call(e))}}class aw extends sR{}class ay extends aw{}class av extends aw{async _call(e){return new lg(await super._call(e))}}class ax extends sR{}class ak extends ax{}class ab extends ax{async _call(e){return new aM(await super._call(e))}}class aM extends sU{constructor({logits:e,pred_boxes:t}){super(),this.logits=e,this.pred_boxes=t}}class aA extends sR{}class aS extends aA{async get_image_embeddings(e){let{pixel_values:t}=e;return await sB(this,{pixel_values:t})}async forward(e){if(e.image_embeddings&&e.image_positional_embeddings||(e={...e,...await this.get_image_embeddings(e)}),!e.input_labels){let t=e.input_points.dims.slice(0,-1),s=t.reduce((e,t)=>e*t,1);e.input_labels=new el("int64",new BigInt64Array(s).fill(1n),t)}return await sE(this.prompt_encoder_mask_decoder,{input_points:e.input_points,input_labels:e.input_labels,image_embeddings:e.image_embeddings,image_positional_embeddings:e.image_positional_embeddings})}async _call(e){return new az(await super._call(e))}constructor(e,t,s){super(e,t),this.prompt_encoder_mask_decoder=s}}class az extends sU{constructor({iou_scores:e,pred_masks:t}){super(),this.iou_scores=e,this.pred_masks=t}}class aE extends sR{}class aC extends aE{}class aF extends aE{constructor(e,t,s,n){super(e,t),this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class aT extends sR{}class aP extends aT{}class aL extends aT{constructor(e,t,s,n){super(e,t),this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class aO extends sR{}class aI extends aO{}class aB extends aO{async _call(e){return new lk(await super._call(e))}}class aj extends aO{async _call(e){return new lg(await super._call(e))}}class aN extends aO{async _call(e){return new ly(await super._call(e))}}class aq extends sR{}class aD extends aq{}class aR extends aq{async _call(e){return new lk(await super._call(e))}}class aU extends aq{async _call(e){return new lg(await super._call(e))}}class aG extends sR{}class aW extends aG{}class aV extends aG{async _call(e){return new lk(await super._call(e))}}class aX extends aG{async _call(e){return new lg(await super._call(e))}}class aK extends aG{async _call(e){return new ly(await super._call(e))}}class aH extends sR{}class aQ extends aH{}class aY extends aH{async _call(e){return new lk(await super._call(e))}}class a$ extends aH{async _call(e){return new lg(await super._call(e))}}class aJ extends aO{}class aZ extends aO{async _call(e){return new lk(await super._call(e))}}class a0 extends aO{async _call(e){return new lg(await super._call(e))}}class a1 extends sR{}class a2 extends a1{}class a3 extends a1{async _call(e){return new lk(await super._call(e))}}class a4 extends a1{async _call(e){return new lg(await super._call(e))}}class a5 extends a1{async _call(e){return new lw(await super._call(e))}}class a6 extends a1{async _call(e){return new ly(await super._call(e))}}class a8 extends sR{}class a7 extends a8{}class a9 extends a8{async generate_speech(e,t){let{threshold:s=.5,minlenratio:n=0,maxlenratio:i=20,vocoder:r=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{encoder_outputs:a,encoder_attention_mask:o}=await sB(this,{input_ids:e}),l=a.dims[1]/this.config.reduction_factor,c=Math.floor(l*i),d=Math.floor(l*n),h=this.config.num_mel_bins,u=[],_=null,p=null,f=0;for(;;){++f;let e={use_cache_branch:sT(!!p),output_sequence:p?p.output_sequence_out:new el("float32",new Float32Array(h),[1,1,h]),encoder_attention_mask:o,speaker_embeddings:t,encoder_hidden_states:a};this.addPastKeyValues(e,_),p=await sE(this.decoder_merged_session,e),_=this.getPastKeyValues(p,_);let{prob:n,spectrum:i}=p;if(u.push(i),f>=d&&(Array.from(n.data).filter(e=>e>=s).length>0||f>=c))break}let m=ep(u),{waveform:g}=await sE(r.session,{spectrogram:m});return{spectrogram:m,waveform:g}}constructor(e,t,s,n){super(e,t),this.decoder_merged_session=s,this.generation_config=n,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.hidden_size/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.hidden_size/this.num_encoder_heads}}class oe extends sR{constructor(...e){super(...e),this.main_input_name="spectrogram"}}class ot extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_encoder_layers=this.num_decoder_layers=this.config.decoder_layers,this.num_encoder_heads=this.num_decoder_heads=this.config.decoder_attention_heads,this.encoder_dim_kv=this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads}}class os extends ot{}class on extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class oi extends on{}class or extends on{}class oa extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class oo extends oa{}class ol extends oa{}class oc extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class od extends oc{}class oh extends oc{}class ou extends sR{}class o_ extends ou{}class op extends ou{static async from_pretrained(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null!==(t=s.model_file_name)&&void 0!==t||(s.model_file_name="text_model"),super.from_pretrained(e,s)}}class of extends ou{static async from_pretrained(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null!==(t=s.model_file_name)&&void 0!==t||(s.model_file_name="audio_model"),super.from_pretrained(e,s)}}class om extends sR{}class og extends om{async _call(e){return new lM(await super._call(e))}}class ow extends sR{}class oy extends ow{}class ov extends ow{}class ox extends sR{constructor(e,t,s){super(e,t),this.generation_config=s,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class ok extends ox{}class ob extends sR{}class oM extends ob{}class oA extends ob{async _call(e){return new lg(await super._call(e))}}class oS{static async from_pretrained(e){let{quantized:t=!0,progress_callback:s=null,config:n=null,cache_dir:i=null,local_files_only:r=!1,revision:a="main",model_file_name:o=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l={quantized:t,progress_callback:s,config:n,cache_dir:i,local_files_only:r,revision:a,model_file_name:o};if(n=await ss.from_pretrained(e,l),l.config||(l.config=n),!this.MODEL_CLASS_MAPPINGS)throw Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);for(let t of this.MODEL_CLASS_MAPPINGS){let s=t.get(n.model_type);if(s)return await s[1].from_pretrained(e,l)}if(this.BASE_IF_FAIL)return console.warn('Unknown model class "'.concat(n.model_type,'", attempting to construct from base class.')),await sR.from_pretrained(e,l);throw Error("Unsupported model type: ".concat(n.model_type))}}oS.MODEL_CLASS_MAPPINGS=null,oS.BASE_IF_FAIL=!1;let oz=new Map([["bert",["BertModel",sW]],["nomic_bert",["NomicBertModel",sY]],["roformer",["RoFormerModel",sJ]],["electra",["ElectraModel",ne]],["esm",["EsmModel",nF]],["convbert",["ConvBertModel",s4]],["camembert",["CamembertModel",na]],["deberta",["DebertaModel",nu]],["deberta-v2",["DebertaV2Model",nw]],["mpnet",["MPNetModel",nD]],["albert",["AlbertModel",n$]],["distilbert",["DistilBertModel",nM]],["roberta",["RobertaModel",iw]],["xlm",["XLMModel",iM]],["xlm-roberta",["XLMRobertaModel",iF]],["clap",["ClapModel",o_]],["clip",["CLIPModel",iG]],["clipseg",["CLIPSegModel",iZ]],["chinese_clip",["ChineseCLIPModel",i$]],["siglip",["SiglipModel",iK]],["mobilebert",["MobileBertModel",nI]],["squeezebert",["SqueezeBertModel",nX]],["wav2vec2",["Wav2Vec2Model",aI]],["wav2vec2-bert",["Wav2Vec2BertModel",aQ]],["unispeech",["UniSpeechModel",aD]],["unispeech-sat",["UniSpeechSatModel",aW]],["hubert",["HubertModel",aJ]],["wavlm",["WavLMModel",a2]],["audio-spectrogram-transformer",["ASTModel",iB]],["vits",["VitsModel",og]],["detr",["DetrModel",rV]],["table-transformer",["TableTransformerModel",r$]],["vit",["ViTModel",rE]],["mobilevit",["MobileViTModel",rL]],["owlvit",["OwlViTModel",rB]],["owlv2",["Owlv2Model",rq]],["beit",["BeitModel",rU]],["deit",["DeiTModel",r1]],["convnext",["ConvNextModel",a_]],["convnextv2",["ConvNextV2Model",am]],["dinov2",["Dinov2Model",ay]],["resnet",["ResNetModel",r4]],["swin",["SwinModel",r8]],["swin2sr",["Swin2SRModel",ae]],["donut-swin",["DonutSwinModel",ah]],["yolos",["YolosModel",ak]],["dpt",["DPTModel",an]],["glpn",["GLPNModel",al]],["hifigan",["SpeechT5HifiGan",oe]],["efficientnet",["EfficientNetModel",oM]]]),oE=new Map([["t5",["T5Model",n2]],["longt5",["LongT5Model",n5]],["mt5",["MT5Model",n7]],["bart",["BartModel",it]],["mbart",["MBartModel",ia]],["marian",["MarianModel",aC]],["whisper",["WhisperModel",iq]],["m2m_100",["M2M100Model",aP]],["blenderbot",["BlenderbotModel",ih]],["blenderbot-small",["BlenderbotSmallModel",ip]]]),oC=new Map([["bloom",["BloomModel",ry]],["gpt2",["GPT2Model",i2]],["gptj",["GPTJModel",rt]],["gpt_bigcode",["GPTBigCodeModel",ri]],["gpt_neo",["GPTNeoModel",i5]],["gpt_neox",["GPTNeoXModel",i7]],["codegen",["CodeGenModel",ro]],["llama",["LlamaModel",rd]],["qwen2",["Qwen2Model",r_]],["phi",["PhiModel",rm]],["mpt",["MptModel",rk]],["opt",["OPTModel",rA]],["mistral",["MistralModel",oi]],["starcoder2",["Starcoder2Model",oo]],["falcon",["FalconModel",od]]]),oF=new Map([["speecht5",["SpeechT5ForSpeechToText",a7]],["whisper",["WhisperForConditionalGeneration",iD]]]),oT=new Map([["speecht5",["SpeechT5ForTextToSpeech",a9]]]),oP=new Map([["vits",["VitsModel",og]]]),oL=new Map([["bert",["BertForSequenceClassification",sX]],["roformer",["RoFormerForSequenceClassification",s0]],["electra",["ElectraForSequenceClassification",ns]],["esm",["EsmForSequenceClassification",nP]],["convbert",["ConvBertForSequenceClassification",s6]],["camembert",["CamembertForSequenceClassification",nl]],["deberta",["DebertaForSequenceClassification",np]],["deberta-v2",["DebertaV2ForSequenceClassification",nv]],["mpnet",["MPNetForSequenceClassification",nU]],["albert",["AlbertForSequenceClassification",nJ]],["distilbert",["DistilBertForSequenceClassification",nA]],["roberta",["RobertaForSequenceClassification",iv]],["xlm",["XLMForSequenceClassification",iS]],["xlm-roberta",["XLMRobertaForSequenceClassification",iP]],["bart",["BartForSequenceClassification",ii]],["mbart",["MBartForSequenceClassification",il]],["mobilebert",["MobileBertForSequenceClassification",nj]],["squeezebert",["SqueezeBertForSequenceClassification",nH]]]),oO=new Map([["bert",["BertForTokenClassification",sK]],["roformer",["RoFormerForTokenClassification",s1]],["electra",["ElectraForTokenClassification",nn]],["esm",["EsmForTokenClassification",nL]],["convbert",["ConvBertForTokenClassification",s8]],["camembert",["CamembertForTokenClassification",nc]],["deberta",["DebertaForTokenClassification",nf]],["deberta-v2",["DebertaV2ForTokenClassification",nx]],["mpnet",["MPNetForTokenClassification",nG]],["distilbert",["DistilBertForTokenClassification",nS]],["roberta",["RobertaForTokenClassification",ix]],["xlm",["XLMForTokenClassification",iz]],["xlm-roberta",["XLMRobertaForTokenClassification",iL]]]),oI=new Map([["t5",["T5ForConditionalGeneration",n3]],["longt5",["LongT5ForConditionalGeneration",n6]],["mt5",["MT5ForConditionalGeneration",n9]],["bart",["BartForConditionalGeneration",is]],["mbart",["MBartForConditionalGeneration",io]],["marian",["MarianMTModel",aF]],["m2m_100",["M2M100ForConditionalGeneration",aL]],["blenderbot",["BlenderbotForConditionalGeneration",iu]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",im]]]),oB=new Map([["bloom",["BloomForCausalLM",rv]],["gpt2",["GPT2LMHeadModel",i3]],["gptj",["GPTJForCausalLM",rs]],["gpt_bigcode",["GPTBigCodeForCausalLM",rr]],["gpt_neo",["GPTNeoForCausalLM",i6]],["gpt_neox",["GPTNeoXForCausalLM",i9]],["codegen",["CodeGenForCausalLM",rl]],["llama",["LlamaForCausalLM",rh]],["qwen2",["Qwen2ForCausalLM",rp]],["phi",["PhiForCausalLM",rg]],["mpt",["MptForCausalLM",rb]],["opt",["OPTForCausalLM",rS]],["mbart",["MBartForCausalLM",ic]],["mistral",["MistralForCausalLM",or]],["starcoder2",["Starcoder2ForCausalLM",ol]],["falcon",["FalconForCausalLM",oh]],["trocr",["TrOCRForCausalLM",os]],["stablelm",["StableLmForCausalLM",ok]]]),oj=new Map([["bert",["BertForMaskedLM",sV]],["roformer",["RoFormerForMaskedLM",sZ]],["electra",["ElectraForMaskedLM",nt]],["esm",["EsmForMaskedLM",nT]],["convbert",["ConvBertForMaskedLM",s5]],["camembert",["CamembertForMaskedLM",no]],["deberta",["DebertaForMaskedLM",n_]],["deberta-v2",["DebertaV2ForMaskedLM",ny]],["mpnet",["MPNetForMaskedLM",nR]],["albert",["AlbertForMaskedLM",n0]],["distilbert",["DistilBertForMaskedLM",nE]],["roberta",["RobertaForMaskedLM",iy]],["xlm",["XLMWithLMHeadModel",iA]],["xlm-roberta",["XLMRobertaForMaskedLM",iT]],["mobilebert",["MobileBertForMaskedLM",nB]],["squeezebert",["SqueezeBertForMaskedLM",nK]]]),oN=new Map([["bert",["BertForQuestionAnswering",sH]],["roformer",["RoFormerForQuestionAnswering",s2]],["electra",["ElectraForQuestionAnswering",ni]],["convbert",["ConvBertForQuestionAnswering",s7]],["camembert",["CamembertForQuestionAnswering",nd]],["deberta",["DebertaForQuestionAnswering",nm]],["deberta-v2",["DebertaV2ForQuestionAnswering",nk]],["mpnet",["MPNetForQuestionAnswering",nW]],["albert",["AlbertForQuestionAnswering",nZ]],["distilbert",["DistilBertForQuestionAnswering",nz]],["roberta",["RobertaForQuestionAnswering",ik]],["xlm",["XLMForQuestionAnswering",iE]],["xlm-roberta",["XLMRobertaForQuestionAnswering",iO]],["mobilebert",["MobileBertForQuestionAnswering",nN]],["squeezebert",["SqueezeBertForQuestionAnswering",nQ]]]),oq=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",iR]]]),oD=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",iR]]]),oR=new Map([["vit",["ViTForImageClassification",rC]],["mobilevit",["MobileViTForImageClassification",rO]],["beit",["BeitForImageClassification",rG]],["deit",["DeiTForImageClassification",r2]],["convnext",["ConvNextForImageClassification",ap]],["convnextv2",["ConvNextV2ForImageClassification",ag]],["dinov2",["Dinov2ForImageClassification",av]],["resnet",["ResNetForImageClassification",r5]],["swin",["SwinForImageClassification",r7]],["segformer",["SegformerForImageClassification",oy]],["efficientnet",["EfficientNetForImageClassification",oA]]]),oU=new Map([["detr",["DetrForObjectDetection",rX]],["table-transformer",["TableTransformerForObjectDetection",rJ]],["yolos",["YolosForObjectDetection",ab]]]),oG=new Map([["owlvit",["OwlViTForObjectDetection",rj]],["owlv2",["Owlv2ForObjectDetection",rD]]]),oW=new Map([["detr",["DetrForSegmentation",rK]],["clipseg",["CLIPSegForImageSegmentation",i0]]]),oV=new Map([["segformer",["SegformerForSemanticSegmentation",ov]]]),oX=new Map([["sam",["SamModel",aS]]]),oK=new Map([["wav2vec2",["Wav2Vec2ForCTC",aB]],["wav2vec2-bert",["Wav2Vec2BertForCTC",aY]],["unispeech",["UniSpeechForCTC",aR]],["unispeech-sat",["UniSpeechSatForCTC",aV]],["wavlm",["WavLMForCTC",a3]],["hubert",["HubertForCTC",aZ]]]),oH=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",aj]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",a$]],["unispeech",["UniSpeechForSequenceClassification",aU]],["unispeech-sat",["UniSpeechSatForSequenceClassification",aX]],["wavlm",["WavLMForSequenceClassification",a4]],["hubert",["HubertForSequenceClassification",a0]],["audio-spectrogram-transformer",["ASTForAudioClassification",ij]]]),oQ=new Map([["wavlm",["WavLMForXVector",a5]]]),oY=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",aK]],["wavlm",["WavLMForAudioFrameClassification",a6]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",aN]]]),o$=new Map([["vitmatte",["VitMatteForImageMatting",rT]]]),oJ=new Map([["swin2sr",["Swin2SRForImageSuperResolution",at]]]),oZ=new Map([["dpt",["DPTForDepthEstimation",ai]],["depth_anything",["DepthAnythingForDepthEstimation",aa]],["glpn",["GLPNForDepthEstimation",ac]]]),o0=[[oz,sb.EncoderOnly],[oE,sb.EncoderDecoder],[oC,sb.DecoderOnly],[oL,sb.EncoderOnly],[oO,sb.EncoderOnly],[oI,sb.Seq2Seq],[oF,sb.Seq2Seq],[oB,sb.DecoderOnly],[oj,sb.EncoderOnly],[oN,sb.EncoderOnly],[oq,sb.Vision2Seq],[oR,sb.EncoderOnly],[oW,sb.EncoderOnly],[oV,sb.EncoderOnly],[o$,sb.EncoderOnly],[oJ,sb.EncoderOnly],[oZ,sb.EncoderOnly],[oU,sb.EncoderOnly],[oG,sb.EncoderOnly],[oX,sb.MaskGeneration],[oK,sb.EncoderOnly],[oH,sb.EncoderOnly],[oT,sb.Seq2Seq],[oP,sb.EncoderOnly],[oQ,sb.EncoderOnly],[oY,sb.EncoderOnly]];for(let[e,t]of o0)for(let[s,n]of e.values())sM.set(s,t),sS.set(n,s),sA.set(s,n);for(let[e,t,s]of[["CLIPTextModelWithProjection",iW,sb.EncoderOnly],["CLIPVisionModelWithProjection",iV,sb.EncoderOnly],["SiglipTextModel",iH,sb.EncoderOnly],["SiglipVisionModel",iQ,sb.EncoderOnly],["ClapTextModelWithProjection",op,sb.EncoderOnly],["ClapAudioModelWithProjection",of,sb.EncoderOnly]])sM.set(e,s),sS.set(t,e),sA.set(e,t);class o1 extends oS{}o1.MODEL_CLASS_MAPPINGS=o0.map(e=>e[0]),o1.BASE_IF_FAIL=!0;class o2 extends oS{}o2.MODEL_CLASS_MAPPINGS=[oL];class o3 extends oS{}o3.MODEL_CLASS_MAPPINGS=[oO];class o4 extends oS{}o4.MODEL_CLASS_MAPPINGS=[oI];class o5 extends oS{}o5.MODEL_CLASS_MAPPINGS=[oF];class o6 extends oS{}o6.MODEL_CLASS_MAPPINGS=[oT];class o8 extends oS{}o8.MODEL_CLASS_MAPPINGS=[oP];class o7 extends oS{}o7.MODEL_CLASS_MAPPINGS=[oB];class o9 extends oS{}o9.MODEL_CLASS_MAPPINGS=[oj];class le extends oS{}le.MODEL_CLASS_MAPPINGS=[oN];class lt extends oS{}lt.MODEL_CLASS_MAPPINGS=[oq];class ls extends oS{}ls.MODEL_CLASS_MAPPINGS=[oR];class ln extends oS{}ln.MODEL_CLASS_MAPPINGS=[oW];class li extends oS{}li.MODEL_CLASS_MAPPINGS=[oV];class lr extends oS{}lr.MODEL_CLASS_MAPPINGS=[oU];class la extends oS{}la.MODEL_CLASS_MAPPINGS=[oG];class lo extends oS{}lo.MODEL_CLASS_MAPPINGS=[oX];class ll extends oS{}ll.MODEL_CLASS_MAPPINGS=[oK];class lc extends oS{}lc.MODEL_CLASS_MAPPINGS=[oH];class ld extends oS{}ld.MODEL_CLASS_MAPPINGS=[oQ];class lh extends oS{}lh.MODEL_CLASS_MAPPINGS=[oY];class lu extends oS{}lu.MODEL_CLASS_MAPPINGS=[oD];class l_ extends oS{}l_.MODEL_CLASS_MAPPINGS=[o$];class lp extends oS{}lp.MODEL_CLASS_MAPPINGS=[oJ];class lf extends oS{}lf.MODEL_CLASS_MAPPINGS=[oZ];class lm extends sU{constructor({logits:e,past_key_values:t,encoder_outputs:s,decoder_attentions:n=null,cross_attentions:i=null}){super(),this.logits=e,this.past_key_values=t,this.encoder_outputs=s,this.decoder_attentions=n,this.cross_attentions=i}}class lg extends sU{constructor({logits:e}){super(),this.logits=e}}class lw extends sU{constructor({logits:e,embeddings:t}){super(),this.logits=e,this.embeddings=t}}class ly extends sU{constructor({logits:e}){super(),this.logits=e}}class lv extends sU{constructor({logits:e}){super(),this.logits=e}}class lx extends sU{constructor({start_logits:e,end_logits:t}){super(),this.start_logits=e,this.end_logits=t}}class lk extends sU{constructor({logits:e}){super(),this.logits=e}}class lb extends sU{constructor({alphas:e}){super(),this.alphas=e}}class lM extends sU{constructor({waveform:e,spectrogram:t}){super(),this.waveform=e,this.spectrogram=t}}var lA=s(2085);let lS="undefined"!=typeof self,lz=lS&&"DedicatedWorkerGlobalScope"===self.constructor.name;if(lS)i=(e,t)=>{if(!self.OffscreenCanvas)throw Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(e,t)},a=self.createImageBitmap,r=self.ImageData;else if(lA)a=async e=>{let t=(await e.metadata()).channels,{data:s,info:n}=await e.raw().toBuffer({resolveWithObject:!0}),i=new lF(new Uint8ClampedArray(s),n.width,n.height,n.channels);return void 0!==t&&t!==n.channels&&i.convert(t),i};else throw Error("Unable to load image processing library.");let lE={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},lC=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class lF{get size(){return[this.width,this.height]}static async read(e){if(e instanceof lF)return e;if("string"==typeof e||e instanceof URL)return await this.fromURL(e);throw Error("Unsupported input type: ".concat(typeof e))}static async fromURL(e){let t=await G(e);if(200!==t.status)throw Error('Unable to read image from "'.concat(e,'" (').concat(t.status," ").concat(t.statusText,")"));let s=await t.blob();return this.fromBlob(s)}static async fromBlob(e){if(lS){let t=await a(e),s=i(t.width,t.height).getContext("2d");return s.drawImage(t,0,0),new this(s.getImageData(0,0,t.width,t.height).data,t.width,t.height,4)}{let t=lA(await e.arrayBuffer());return await a(t)}}static fromTensor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CHW";if(3!==e.dims.length)throw Error("Tensor should have 3 dimensions, but has ".concat(e.dims.length," dimensions."));if("CHW"===t)e=e.transpose(1,2,0);else if("HWC"===t);else throw Error("Unsupported channel format: ".concat(t));if(!(e.data instanceof Uint8ClampedArray||e.data instanceof Uint8Array))throw Error("Unsupported tensor type: ".concat(e.type));switch(e.dims[2]){case 1:case 2:case 3:case 4:return new lF(e.data,e.dims[1],e.dims[0],e.dims[2]);default:throw Error("Unsupported number of channels: ".concat(e.dims[2]))}}grayscale(){if(1===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let t=0,s=0;t<this.data.length;t+=this.channels){let n=this.data[t],i=this.data[t+1],r=this.data[t+2];e[s++]=Math.round(.2989*n+.587*i+.114*r)}break;default:throw Error("Conversion failed due to unsupported number of channels: ".concat(this.channels))}return this._update(e,this.width,this.height,1)}rgb(){if(3===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let t=0,s=0;t<this.data.length;++t)e[s++]=this.data[t],e[s++]=this.data[t],e[s++]=this.data[t];break;case 4:for(let t=0,s=0;t<this.data.length;t+=4)e[s++]=this.data[t],e[s++]=this.data[t+1],e[s++]=this.data[t+2];break;default:throw Error("Conversion failed due to unsupported number of channels: ".concat(this.channels))}return this._update(e,this.width,this.height,3)}rgba(){if(4===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let t=0,s=0;t<this.data.length;++t)e[s++]=this.data[t],e[s++]=this.data[t],e[s++]=this.data[t],e[s++]=255;break;case 3:for(let t=0,s=0;t<this.data.length;t+=3)e[s++]=this.data[t],e[s++]=this.data[t+1],e[s++]=this.data[t+2],e[s++]=255;break;default:throw Error("Conversion failed due to unsupported number of channels: ".concat(this.channels))}return this._update(e,this.width,this.height,4)}async resize(e,t){var s;let{resample:n=2}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null!==(s=lE[n])&&void 0!==s?s:n;if(lS){let s=this.channels,n=this.toCanvas(),r=i(e,t).getContext("2d");return r.drawImage(n,0,0,e,t),new lF(r.getImageData(0,0,e,t).data,e,t,4).convert(s)}{let s=this.toSharp();switch(r){case"box":case"hamming":("box"===r||"hamming"===r)&&(console.warn("Resampling method ".concat(r," is not yet supported. Using bilinear instead.")),r="bilinear");case"nearest":case"bilinear":case"bicubic":s=s.affine([e/this.width,0,0,t/this.height],{interpolator:r});break;case"lanczos":s=s.resize({width:e,height:t,fit:"fill",kernel:"lanczos3"});break;default:throw Error("Resampling method ".concat(r," is not supported."))}return await a(s)}}async pad(e){let[t,s,n,r]=e;if(t=Math.max(t,0),s=Math.max(s,0),n=Math.max(n,0),r=Math.max(r,0),0===t&&0===s&&0===n&&0===r)return this;if(lS){let e=this.channels,a=this.toCanvas(),o=this.width+t+s,l=this.height+n+r,c=i(o,l).getContext("2d");return c.drawImage(a,0,0,this.width,this.height,t,n,o,l),new lF(c.getImageData(0,0,o,l).data,o,l,4).convert(e)}{let e=this.toSharp().extend({left:t,right:s,top:n,bottom:r});return await a(e)}}async crop(e){let[t,s,n,r]=e;if(t=Math.max(t,0),s=Math.max(s,0),n=Math.min(n,this.width-1),r=Math.min(r,this.height-1),0===t&&0===s&&n===this.width-1&&r===this.height-1)return this;let o=n-t+1,l=r-s+1;if(lS){let e=this.channels,n=this.toCanvas(),r=i(o,l).getContext("2d");return r.drawImage(n,t,s,o,l,0,0,o,l),new lF(r.getImageData(0,0,o,l).data,o,l,4).convert(e)}{let e=this.toSharp().extract({left:t,top:s,width:o,height:l});return await a(e)}}async center_crop(e,t){if(this.width===e&&this.height===t)return this;let s=(this.width-e)/2,n=(this.height-t)/2;if(lS){let r=this.channels,a=this.toCanvas(),o=i(e,t).getContext("2d"),l=0,c=0,d=0,h=0;return s>=0?l=s:d=-s,n>=0?c=n:h=-n,o.drawImage(a,l,c,e,t,d,h,e,t),new lF(o.getImageData(0,0,e,t).data,e,t,4).convert(r)}{let i=this.toSharp();if(s>=0&&n>=0)i=i.extract({left:Math.floor(s),top:Math.floor(n),width:e,height:t});else if(s<=0&&n<=0){let r=Math.floor(-n),a=Math.floor(-s);i=i.extend({top:r,left:a,right:e-this.width-a,bottom:t-this.height-r})}else{let r=[0,0],a=0;n<0?(r[0]=Math.floor(-n),r[1]=t-this.height-r[0]):a=Math.floor(n);let o=[0,0],l=0;s<0?(o[0]=Math.floor(-s),o[1]=e-this.width-o[0]):l=Math.floor(s),i=i.extend({top:r[0],bottom:r[1],left:o[0],right:o[1]}).extract({left:l,top:a,width:e,height:t})}return await a(i)}}async toBlob(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!lS)throw Error("toBlob() is only supported in browser environments.");let s=this.toCanvas();return await s.convertToBlob({type:e,quality:t})}toCanvas(){if(!lS)throw Error("toCanvas() is only supported in browser environments.");let e=this.clone().rgba(),t=i(e.width,e.height),s=new r(e.data,e.width,e.height);return t.getContext("2d").putImageData(s,0,0),t}_update(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this.data=e,this.width=t,this.height=s,null!==n&&(this.channels=n),this}clone(){return new lF(this.data.slice(),this.width,this.height,this.channels)}convert(e){if(this.channels===e)return this;switch(e){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw Error("Conversion failed due to unsupported number of channels: ".concat(this.channels))}return this}async save(e){if(lS){var t;if(lz)throw Error("Unable to save an image from a Web Worker.");let s=e.split(".").pop().toLowerCase(),n=null!==(t=lC.get(s))&&void 0!==t?t:"image/png",i=await this.toBlob(n),r=URL.createObjectURL(i),a=document.createElement("a");a.href=r,a.download=e,a.click(),a.remove()}else if(j.useFS){let t=this.toSharp();return await t.toFile(e)}else throw Error("Unable to save the image because filesystem is disabled in this environment.")}toSharp(){if(lS)throw Error("toSharp() is only supported in server-side environments.");return lA(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}constructor(e,t,s,n){this.data=e,this.width=t,this.height=s,this.channels=n}}async function lT(e,t){let s;if("undefined"==typeof AudioContext)throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");let n=await (await G(e)).arrayBuffer(),i=new AudioContext({sampleRate:t});void 0===t&&console.warn("No sampling rate provided, using default of ".concat(i.sampleRate,"Hz."));let r=await i.decodeAudioData(n);if(2===r.numberOfChannels){let e=Math.sqrt(2),t=r.getChannelData(0),n=r.getChannelData(1);s=new Float32Array(t.length);for(let i=0;i<r.length;++i)s[i]=e*(t[i]+n[i])/2}else s=r.getChannelData(0);return s}function lP(e){if(e<1)return new Float64Array;if(1===e)return new Float64Array([1]);let t=e-1,s=Math.PI/t,n=new Float64Array(e);for(let i=0;i<e;++i){let e=2*i-t;n[i]=.5+.5*Math.cos(s*e)}return n}let lL={htk:e=>2595*Math.log10(1+e/700),kaldi:e=>1127*Math.log(1+e/700),slaney:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:27/Math.log(6.4);return e>=t?s+Math.log(e/t)*n:3*e/200}};function lO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"htk",s=lL[t];if(!s)throw Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return"number"==typeof e?s(e):e.map(e=>s(e))}let lI={htk:e=>700*(10**(e/2595)-1),kaldi:e=>700*(Math.exp(e/1127)-1),slaney:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.log(6.4)/27;return e>=s?t*Math.exp(n*(e-s)):200*e/3}};function lB(e,t,s){let n=(t-e)/(s-1);return Float64Array.from({length:s},(t,s)=>e+n*s)}function lj(e,t,s,n,i){let r,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"htk",l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(null!==a&&"slaney"!==a)throw Error('norm must be one of null or "slaney"');let c=lB(lO(s,o),lO(n,o),t+2),d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"htk",s=lI[t];if(!s)throw Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return"number"==typeof e?s(e):e.map(e=>s(e))}(c,o);if(l){let t=i/(2*e);r=lO(Float64Array.from({length:e},(e,s)=>s*t),o),d=c}else r=lB(0,Math.floor(i/2),e);let h=function(e,t){let s=Float64Array.from({length:t.length-1},(e,s)=>t[s+1]-t[s]),n=Array.from({length:e.length},()=>Array(t.length));for(let s=0;s<e.length;++s){let i=n[s];for(let n=0;n<t.length;++n)i[n]=t[n]-e[s]}let i=t.length-2,r=Array.from({length:i},()=>Array(e.length));for(let t=0;t<e.length;++t){let e=n[t];for(let n=0;n<i;++n){let i=-e[n]/s[n],a=e[n+2]/s[n+1];r[n][t]=Math.max(0,Math.min(i,a))}}return r}(r,d);if(null!==a&&"slaney"===a)for(let s=0;s<t;++s){let t=h[s],n=2/(d[s+2]-d[s]);for(let s=0;s<e;++s)t[s]*=n}return h}function lN(e,t,s,n,i){if(s<=0)throw Error("reference must be greater than zero");if(n<=0)throw Error("min_value must be greater than zero");let r=Math.log10(s=Math.max(n,s));for(let s=0;s<e.length;++s)e[s]=t*Math.log10(Math.max(n,e[s])-r);if(null!==i){if(i<=0)throw Error("db_range must be greater than zero");let t=ee(e)[0]-i;for(let s=0;s<e.length;++s)e[s]=Math.max(e[s],t)}return e}function lq(e,t,s,n){let{fft_length:i=null,power:r=1,center:a=!0,pad_mode:o="reflect",onesided:l=!0,preemphasis:c=null,mel_filters:d=null,mel_floor:h=1e-10,log_mel:u=null,reference:p=1,min_value:f=1e-10,db_range:m=null,remove_dc_offset:g=null,max_num_frames:w=null,do_pad:y=!0,transpose:v=!1}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},x=t.length;if(null===i&&(i=s),s>i)throw Error("frame_length (".concat(s,") may not be larger than fft_length (").concat(i,")"));if(x!==s)throw Error("Length of the window (".concat(x,") must equal frame_length (").concat(s,")"));if(n<=0)throw Error("hop_length must be greater than zero");if(a){if("reflect"!==o)throw Error('pad_mode="'.concat(o,'" not implemented yet.'));let t=Math.floor((i-1)/2)+1;e=function(e,t,s){let n=new e.constructor(e.length+t+s),i=e.length-1;for(let s=0;s<e.length;++s)n[t+s]=e[s];for(let s=1;s<=t;++s)n[t-s]=e[_(s,i)];for(let r=1;r<=s;++r)n[i+t+r]=e[_(i-r,i)];return n}(e,t,t)}let k=Math.floor(1+Math.floor((e.length-s)/n)),b=l?Math.floor(i/2)+1:i,M=k,A=k;null!==w&&(w>k?y&&(A=w):A=M=w);let S=new ei(i),z=new Float64Array(i),E=new Float64Array(S.outputBufferSize),C=Array(M);for(let i=0;i<M;++i){let r=i*n;for(let t=0;t<s;++t)z[t]=e[r+t];if(g){let e=0;for(let t=0;t<s;++t)e+=z[t];let t=e/s;for(let e=0;e<s;++e)z[e]-=t}if(null!==c){for(let e=s-1;e>=1;--e)z[e]-=c*z[e-1];z[0]*=1-c}for(let e=0;e<t.length;++e)z[e]*=t[e];S.realTransform(E,z);let a=Array(b);for(let e=0;e<a.length;++e){let t=e<<1;a[e]=E[t]**2+E[t+1]**2}C[i]=a}if(null!==r&&2!==r){let e=2/r;for(let t=0;t<C.length;++t){let s=C[t];for(let t=0;t<s.length;++t)s[t]**=e}}let F=d.length,T=new Float32Array(F*A),P=v?[A,F]:[F,A];for(let e=0;e<F;++e){let t=d[e];for(let s=0;s<M;++s){let n=C[s],i=0;for(let e=0;e<b;++e)i+=t[e]*n[e];T[v?s*F+e:e*M+s]=Math.max(h,i)}}if(null!==r&&null!==u){let e=Math.min(T.length,M*F);switch(u){case"log":for(let t=0;t<e;++t)T[t]=Math.log(T[t]);break;case"log10":for(let t=0;t<e;++t)T[t]=Math.log10(T[t]);break;case"dB":if(1===r)!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-5,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;lN(e,20,t,s,n)}(T,p,f,m);else if(2===r)!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-10,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;lN(e,10,t,s,n)}(T,p,f,m);else throw Error("Cannot use log_mel option '".concat(u,"' with power ").concat(r));break;default:throw Error("log_mel must be one of null, 'log', 'log10' or 'dB'. Got '".concat(u,"'"))}}return{data:T,dims:P}}function lD(e,t){let s,{periodic:n=!0,frame_length:i=null,center:r=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n?e+1:e;switch(t){case"boxcar":s=new Float64Array(a).fill(1);break;case"hann":case"hann_window":s=lP(a);break;case"povey":s=lP(a).map(e=>Math.pow(e,.85));break;default:throw Error("Unknown window type ".concat(t,"."))}if(n&&(s=s.subarray(0,e)),null===i)return s;if(e>i)throw Error("Length of the window (".concat(e,") may not be larger than frame_length (").concat(i,")"));return s}function lR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e.logits,r=e.pred_boxes,[a,o,l]=i.dims;if(null!==s&&s.length!==a)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let c=[];for(let e=0;e<a;++e){let a=null!==s?s[e]:null,d={boxes:[],classes:[],scores:[]},h=i[e],u=r[e];for(let e=0;e<o;++e){let s,i=h[e],r=[];if(n){s=i.sigmoid().data;for(let e=0;e<s.length;++e)s[e]>t&&r.push(e)}else{let e=ee(i.data)[1];if(e===l-1)continue;r.push(e),s=$(i.data)}for(let t of r){let n=u[e].data;n=function(e){let[t,s,n,i]=e;return[t-n/2,s-i/2,t+n/2,s+i/2]}(n),null!==a&&(n=n.map((e,t)=>e*a[(t+1)%2])),d.boxes.push(n),d.classes.push(t),d.scores.push(s[t])}}c.push(d)}return c}function lU(e,t){if(!(e instanceof Float32Array||e instanceof Float64Array)){var s,n;throw Error("".concat(t," expects input to be a Float32Array or a Float64Array, but got ").concat(null!==(n=null==e?void 0:null===(s=e.constructor)||void 0===s?void 0:s.name)&&void 0!==n?n:typeof e," instead. ")+"If using the feature extractor directly, remember to use `read_audio(url, sampling_rate)` to obtain the raw audio data of the file/url.")}}function lG(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=Math.round(e/t)*t;return null!==n&&i>n&&(i=Math.floor(e/t)*t),i<s&&(i=Math.ceil(e/t)*t),i}function lW(e,t){let[s,n]=e;return[Math.floor(s/t)*t,Math.floor(n/t)*t]}class lV extends l{constructor(e){super(),this.config=e}}class lX extends lV{async thumbnail(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=e.height,i=e.width,r=t.height,a=t.width,o=Math.min(n,r),l=Math.min(i,a);return o===n&&l===i?e:(n>i?l=Math.floor(i*o/n):i>n&&(o=Math.floor(n*l/i)),await e.resize(l,o,{resample:s}))}async crop_margin(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,s=e.clone().grayscale(),n=Z(s.data)[0],i=ee(s.data)[0]-n;if(0===i)return e;let r=t/255,a=s.width,o=s.height,l=0,c=0;for(let e=0;e<s.height;++e){let t=e*s.width;for(let d=0;d<s.width;++d)(s.data[t+d]-n)/i<r&&(a=Math.min(a,d),o=Math.min(o,e),l=Math.max(l,d),c=Math.max(c,e))}return e=await e.crop([a,o,l,c])}pad_image(e,t,s){let n,i,{mode:r="constant",center:a=!1,constant_values:o=0}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},[l,c,d]=t;if("number"==typeof s?(n=s,i=s):(n=s.width,i=s.height),n!==l||i!==c){let s=new Float32Array(n*i*d);if(Array.isArray(o))for(let e=0;e<s.length;++e)s[e]=o[e%d];else 0!==o&&s.fill(o);let[h,u]=a?[Math.floor((n-l)/2),Math.floor((i-c)/2)]:[0,0];for(let t=0;t<c;++t){let i=(t+u)*n,r=t*l;for(let t=0;t<l;++t){let n=(i+t+h)*d,a=(r+t)*d;for(let t=0;t<d;++t)s[n+t]=e[a+t]}}if("symmetric"===r){if(a)throw Error("`center` padding is not supported when `mode` is set to `symmetric`.");let t=c-1,r=l-1;for(let a=0;a<i;++a){let i=a*n,o=_(a,t)*l;for(let t=0;t<n;++t){if(a<c&&t<l)continue;let n=(i+t)*d,h=(o+_(t,r))*d;for(let t=0;t<d;++t)s[n+t]=e[h+t]}}}e=s,t=[i,n,d]}return[e,t]}rescale(e){for(let t=0;t<e.length;++t)e[t]=this.rescale_factor*e[t]}get_resize_output_image_size(e,t){let s,n;let[i,r]=e.size;if(this.do_thumbnail){let{height:e,width:n}=t;s=Math.min(e,n)}else if(Number.isInteger(t)){var a;s=t,n=null!==(a=this.config.max_size)&&void 0!==a?a:s}else void 0!==t&&(s=t.shortest_edge,n=t.longest_edge);if(void 0!==s||void 0!==n){let e=void 0===s?1:Math.max(s/i,s/r),t=i*e,a=r*e,o=void 0===n?1:Math.min(n/t,n/a),l=Math.floor(Number((t*o).toFixed(2))),c=Math.floor(Number((a*o).toFixed(2)));return void 0!==this.size_divisibility&&([l,c]=lW([l,c],this.size_divisibility)),[l,c]}if(void 0!==t&&void 0!==t.width&&void 0!==t.height){let e=t.width,s=t.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let n=t.height/r,a=t.width/i;Math.abs(1-a)<Math.abs(1-n)?n=a:a=n,s=lG(n*r,this.config.ensure_multiple_of),e=lG(a*i,this.config.ensure_multiple_of)}return[e,s]}if(void 0!==this.size_divisibility)return lW([i,r],this.size_divisibility);throw Error("Could not resize image due to unsupported `this.size` option in config: ".concat(JSON.stringify(t)))}async resize(e){let[t,s]=this.get_resize_output_image_size(e,this.size);return await e.resize(t,s,{resample:this.resample})}async preprocess(e){let{do_normalize:t=null,do_pad:s=null,do_convert_rgb:n=null,do_convert_grayscale:i=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.do_crop_margin&&(e=await this.crop_margin(e));let[r,a]=e.size;if((null!=n?n:this.do_convert_rgb)?e=e.rgb():i&&(e=e.grayscale()),this.do_resize&&(e=await this.resize(e)),this.do_thumbnail&&(e=await this.thumbnail(e,this.size,this.resample)),this.do_center_crop){let t,s;Number.isInteger(this.crop_size)?(t=this.crop_size,s=this.crop_size):(t=this.crop_size.width,s=this.crop_size.height),e=await e.center_crop(t,s)}let o=[e.height,e.width],l=Float32Array.from(e.data),c=[e.height,e.width,e.channels];if(this.do_rescale&&this.rescale(l),null!=t?t:this.do_normalize){let t=this.image_mean;Array.isArray(this.image_mean)||(t=Array(e.channels).fill(t));let s=this.image_std;if(Array.isArray(this.image_std)||(s=Array(e.channels).fill(t)),t.length!==e.channels||s.length!==e.channels)throw Error("When set to arrays, the length of `image_mean` (".concat(t.length,") and `image_std` (").concat(s.length,") must match the number of channels in the image (").concat(e.channels,")."));for(let n=0;n<l.length;n+=e.channels)for(let i=0;i<e.channels;++i)l[n+i]=(l[n+i]-t[i])/s[i]}if(null!=s?s:this.do_pad&&this.pad_size){let t=this.pad_image(l,[e.width,e.height,e.channels],this.pad_size);[l,c]=t}return{original_size:[a,r],reshaped_input_size:o,pixel_values:ec(new el("float32",l,c),[2,0,1])}}async _call(e){for(var t=arguments.length,s=Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];Array.isArray(e)||(e=[e]);let i=await Promise.all(e.map(e=>this.preprocess(e)));return{pixel_values:ef(i.map(e=>e.pixel_values),0),original_sizes:i.map(e=>e.original_size),reshaped_input_sizes:i.map(e=>e.reshaped_input_size)}}constructor(e){var t,s,n,i,r,a,o;super(e),this.image_mean=null!==(t=this.config.image_mean)&&void 0!==t?t:this.config.mean,this.image_std=null!==(s=this.config.image_std)&&void 0!==s?s:this.config.std,this.resample=null!==(n=this.config.resample)&&void 0!==n?n:2,this.do_rescale=null===(i=this.config.do_rescale)||void 0===i||i,this.rescale_factor=null!==(r=this.config.rescale_factor)&&void 0!==r?r:1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.size_divisibility=null!==(a=this.config.size_divisibility)&&void 0!==a?a:this.config.size_divisor,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=null===(o=this.config.do_convert_rgb)||void 0===o||o,this.do_crop_margin=this.config.do_crop_margin,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&this.size&&void 0!==this.size.width&&void 0!==this.size.height&&(this.pad_size=this.size)}}class lK extends lX{post_process_semantic_segmentation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=e.logits,n=s.dims[0];if(null!==t&&t.length!==n)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let i=[];for(let e=0;e<n;++e){let n=null!==t?t[e]:null,r=s[e];null!==n&&(r=ed(r,n,"bilinear",!1));let[a,o]=null!=n?n:r.dims.slice(-2),l=new el("int32",new Int32Array(a*o),[a,o]),c=r[0].data;for(let e=1;e<r.dims[0];++e){let t=r[e].data;for(let s=0;s<t.length;++s)t[s]>c[s]&&(c[s]=t[s],l.data[s]=e)}let d=Array(r.dims[0]),h=l.data;for(let e=0;e<h.length;++e){let t=h[e];d[t]=t}let u=d.filter(e=>void 0!==e);i.push({segmentation:l,labels:u})}return i}}class lH extends lX{}class lQ extends lX{}class lY extends lX{}class l$ extends lX{}class lJ extends lX{}class lZ extends lX{}class l0 extends lX{}class l1 extends lX{async resize(e){var t;let s=null===(t=this.size)||void 0===t?void 0:t.shortest_edge;if(void 0===s)throw Error("Size dictionary must contain 'shortest_edge' key.");if(s<384){let t=Math.floor(s/this.crop_pct),[n,i]=this.get_resize_output_image_size(e,{shortest_edge:t});e=await e.resize(n,i,{resample:this.resample}),e=await e.center_crop(s,s)}else e=await e.resize(s,s,{resample:this.resample});return e}constructor(e){var t;super(e),this.crop_pct=null!==(t=this.config.crop_pct)&&void 0!==t?t:.875}}class l2 extends l1{}class l3 extends lX{}class l4 extends lX{}class l5 extends lX{constructor(e){var t;super(e),this.include_top=null===(t=this.config.include_top)||void 0===t||t,this.include_top&&(this.image_std=this.image_std.map(e=>e*e))}}class l6 extends lX{}class l8 extends lX{post_process_object_detection(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return lR(...t)}}class l7 extends l8{}class l9 extends lX{}class ce extends lX{}class ct extends lX{pad_image(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},[i,r,a]=t,o=this.image_mean;Array.isArray(this.image_mean)||(o=Array(a).fill(o));let l=this.image_std;Array.isArray(l)||(l=Array(a).fill(o));let c=o.map((e,t)=>-e/l[t]);return super.pad_image(e,t,s,{center:!0,constant_values:c,...n})}}class cs extends ct{}class cn extends lX{async _call(e){let t=await super._call(e),s=[t.pixel_values.dims[0],64,64],n=new el("int64",new BigInt64Array(s.reduce((e,t)=>e*t)).fill(1n),s);return{...t,pixel_mask:n}}post_process_object_detection(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return lR(...t)}remove_low_and_no_objects(e,t,s,n){let i=[],r=[],a=[];for(let o=0;o<e.dims[0];++o){let l=e[o],c=t[o],d=ee(l.data)[1];if(d===n)continue;let h=$(l.data)[d];h>s&&(i.push(c),r.push(h),a.push(d))}return[i,r,a]}check_segment_validity(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.8,r=[],a=0,o=0;for(let i=0;i<e.length;++i)e[i]===s&&(r.push(i),++a),t[s].data[i]>=n&&++o;let l=a>0&&o>0;return l&&(l=a/o>i),[l,r]}compute_segments(e,t,s,n,i){arguments.length>5&&void 0!==arguments[5]&&arguments[5];let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,[a,o]=null!=r?r:e[0].dims,l=new el("int32",new Int32Array(a*o),[a,o]),c=[];if(null!==r)for(let t=0;t<e.length;++t)e[t]=ed(e[t],r,"bilinear",!1);let d=new Int32Array(e[0].data.length),h=new Float32Array(e[0].data.length);for(let s=0;s<e.length;++s){let n=t[s];for(let t=0;t<e[s].data.length;++t)e[s].data[t]*=n,e[s].data[t]>h[t]&&(d[t]=s,h[t]=e[s].data[t])}let u=0;for(let r=0;r<s.length;++r){let a=s[r],[o,h]=this.check_segment_validity(d,e,r,n,i);if(o){for(let e of(++u,h))l.data[e]=u;c.push({id:u,label_id:a,score:t[r]})}}return[l,c]}post_process_panoptic_segmentation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;null===i&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),i=new Set);let a=e.logits,o=e.pred_masks.sigmoid(),[l,c,d]=a.dims;if(d-=1,null!==r&&r.length!==l)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let h=[];for(let e=0;e<l;++e){let l=null!==r?r[e]:null,c=a[e],u=o[e],[_,p,f]=this.remove_low_and_no_objects(c,u,t,d);if(0===f.length){let[e,t]=null!=l?l:u.dims.slice(-2),s=new el("int32",new Int32Array(e*t).fill(-1),[e,t]);h.push({segmentation:s,segments_info:[]});continue}let[m,g]=this.compute_segments(_,p,f,s,n,i,l);h.push({segmentation:m,segments_info:g})}return h}post_process_instance_segmentation(){throw Error("Not implemented yet")}}class ci extends lX{post_process_object_detection(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return lR(...t)}}class cr extends lX{reshape_input_points(e,t,s){let n=d(e=structuredClone(e));if(3===n.length)n=[1,...n],e=[e];else if(4!==n.length)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let n=0;n<e.length;++n){let i=t[n],r=s[n],a=[r[0]/i[0],r[1]/i[1]];for(let t=0;t<e[n].length;++t)for(let s=0;s<e[n][t].length;++s)for(let i=0;i<e[n][t][s].length;++i)e[n][t][s][i]*=a[i]}return new el("float32",Float32Array.from(e.flat(1/0)),n)}add_input_labels(e,t){let s=d(e);if(2===s.length)s=[1,...s],e=[e];else if(3!==s.length)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(s.some((e,s)=>e!==t.dims[s]))throw Error("The first ".concat(s.length," dimensions of 'input_points' and 'input_labels' must be the same."));return new el("int64",e.flat(1/0).map(BigInt),s)}async _call(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=await super._call(e);if(t&&(n.input_points=this.reshape_input_points(t,n.original_sizes,n.reshaped_input_sizes)),s){if(!n.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");n.input_labels=this.add_input_labels(s,n.input_points)}return n}post_process_masks(e,t,s){let{mask_threshold:n=0,binarize:i=!0,pad_size:r=null}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=[],o=[(r=null!=r?r:this.pad_size).height,r.width];for(let r=0;r<t.length;++r){let l=t[r],c=s[r],d=e[r],h=[];for(let e=0;e<d.dims[0];++e){let t=ed(d[e],o,"bilinear",!1);if(t=ed(t=t.slice(null,[0,c[0]],[0,c[1]]),l,"bilinear",!1),i){let e=new Uint8Array(t.data.length);for(let s=0;s<t.data.length;++s)t.data[s]>n&&(e[s]=1);t=new el("bool",e,t.dims)}h.push(t)}a.push(ef(h))}return a}}class ca extends lX{pad_image(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},[i,r,a]=t;return super.pad_image(e,t,{width:i+(s-i%s)%s,height:r+(s-r%s)%s},{mode:"symmetric",center:!1,constant_values:-1,...n})}}class co extends lX{async _call(e,t){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);let s=await Promise.all(e.map(e=>this.preprocess(e))),n=await Promise.all(t.map(e=>this.preprocess(e,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:ef(s.map((e,t)=>ep([e.pixel_values,n[t].pixel_values],0)),0),original_sizes:s.map(e=>e.original_size),reshaped_input_sizes:s.map(e=>e.reshaped_input_size)}}}class cl extends lV{_extract_fbank_features(e){let{data:t,dims:s}=lq(e,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),n=ee(t)[0];for(let e=0;e<t.length;++e)t[e]=(Math.max(t[e],n-8)+4)/4;return{data:t,dims:s}}async _call(e){let t;lU(e,"WhisperFeatureExtractor"),e.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),t=e.slice(0,this.config.n_samples)):(t=new Float32Array(this.config.n_samples)).set(e);let{data:s,dims:n}=this._extract_fbank_features(t);return{input_features:new el("float32",s,[1,...n])}}constructor(e){var t,s;super(e),null!==(s=(t=this.config).mel_filters)&&void 0!==s||(t.mel_filters=lj(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney")),this.window=lD(this.config.n_fft,"hann")}}class cc extends lV{_zero_mean_unit_var_norm(e){let t=e.reduce((e,t)=>e+t,0)/e.length,s=e.reduce((e,s)=>e+(s-t)**2,0)/e.length;return e.map(e=>(e-t)/Math.sqrt(s+1e-7))}async _call(e){lU(e,"Wav2Vec2FeatureExtractor"),e instanceof Float64Array&&(e=new Float32Array(e));let t=e;this.config.do_normalize&&(t=this._zero_mean_unit_var_norm(t));let s=[1,t.length];return{input_values:new el("float32",t,s),attention_mask:new el("int64",new BigInt64Array(t.length).fill(1n),s)}}}class cd extends lV{_extract_fbank_features(e,t){return lq(e=e.map(e=>32768*e),this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:t,transpose:!0})}async _call(e){let t,{padding:s=!0,pad_to_multiple_of:n=2,do_normalize_per_mel_bins:i=!0,return_attention_mask:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};lU(e,"SeamlessM4TFeatureExtractor");let a=this._extract_fbank_features(e,this.config.max_length);if(i){let[e,t]=a.dims;for(let s=0;s<t;++s){let n=0;for(let i=0;i<e;++i)n+=a.data[i*t+s];let i=n/e,r=0;for(let n=0;n<e;++n)r+=(a.data[n*t+s]-i)**2;let o=Math.sqrt((r/=e-1)+1e-7);for(let n=0;n<e;++n){let e=n*t+s;a.data[e]=(a.data[e]-i)/o}}}if(s){let[e,s]=a.dims,i=e%n;if(i>0){let n=new Float32Array(s*(e+i));n.set(a.data),n.fill(this.config.padding_value,a.data.length);let o=e+i;a={data:n,dims:[o,s]},r&&(t=new el("int64",new BigInt64Array(o),[1,o])).data.fill(1n,0,e)}}let[o,l]=a.dims,c=this.config.stride;if(0!=o%c)throw Error("The number of frames (".concat(o,") must be a multiple of the stride (").concat(c,")."));let d=new el("float32",a.data,a.dims).view(1,Math.floor(o/c),l*c),h={input_features:d};if(r){let e=d.dims[1],s=new el("int64",new BigInt64Array(e),[1,e]);if(t)for(let e=1,n=0;e<o;e+=c,++n)s.data[n]=t.data[e];else s.data.fill(1n);h.attention_mask=s}return h}constructor(e){super(e);let t=this.config.sampling_rate,s=lj(256,this.config.num_mel_bins,20,Math.floor(t/2),t,null,"kaldi",!0);for(let e=0;e<s.length;++e)s[e].push(0);this.mel_filters=s,this.window=lD(400,"povey",{periodic:!1})}}class ch extends lV{_extract_fbank_features(e,t){return lq(e,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:t,transpose:!0})}async _call(e){lU(e,"ASTFeatureExtractor");let t=this._extract_fbank_features(e,this.config.max_length);if(this.config.do_normalize){let e=2*this.std;for(let s=0;s<t.data.length;++s)t.data[s]=(t.data[s]-this.mean)/e}return{input_values:new el("float32",t.data,[1,...t.dims])}}constructor(e){super(e);let t=this.config.sampling_rate,s=lj(256,this.config.num_mel_bins,20,Math.floor(t/2),t,null,"kaldi",!0);for(let e=0;e<s.length;++e)s[e].push(0);this.mel_filters=s,this.window=lD(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}}class cu extends lV{_get_input_mel(e,t,s,n){let i;let r=!1,a=e.length-t;if(a>0){if("rand_trunc"===s){r=!0;let s=Math.floor(Math.random()*(a+1));e=e.subarray(s,s+t),(i=this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples)).dims=[1,...i.dims]}else throw Error('Truncation strategy "'.concat(s,'" not implemented'))}else{if(a<0){let s=new Float64Array(t);if(s.set(e),"repeat"===n)for(let n=e.length;n<t;n+=e.length)s.set(e.subarray(0,Math.min(e.length,t-n)),n);else if("repeatpad"===n)for(let t=e.length;t<-a;t+=e.length)s.set(e,t);e=s}if("fusion"===s)throw Error('Truncation strategy "'.concat(s,'" not implemented'));(i=this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples)).dims=[1,...i.dims]}return{...i,longer:r}}_extract_fbank_features(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return lq(e,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:t,log_mel:"dB",max_num_frames:s,do_pad:!1,transpose:!0})}async _call(e){let{max_length:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};lU(e,"ClapFeatureExtractor");let s=this._get_input_mel(e,null!=t?t:this.config.nb_max_samples,this.config.truncation,this.config.padding);return{input_features:new el("float32",s.data,[1,...s.dims])}}constructor(e){super(e),this.mel_filters=lj(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=lj(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=lD(this.config.fft_window_size,"hann")}}class c_ extends lV{}class cp extends l{async _call(e){for(var t=arguments.length,s=Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];return await this.feature_extractor(e,...s)}constructor(e){super(),this.feature_extractor=e}}class cf extends cp{async _call(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return await this.feature_extractor(...t)}post_process_masks(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.feature_extractor.post_process_masks(...t)}reshape_input_points(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.feature_extractor.reshape_input_points(...t)}}class cm extends cp{async _call(e){return await this.feature_extractor(e)}}class cg extends cp{async _call(e){return await this.feature_extractor(e)}}class cw extends cp{async _call(e){return await this.feature_extractor(e)}}class cy extends cp{}class cv{static async from_pretrained(e){var t,s;let{progress_callback:n=null,config:i=null,cache_dir:r=null,local_files_only:a=!1,revision:o="main"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=null!=i?i:await H(e,"preprocessor_config.json",!0,{progress_callback:n,config:i,cache_dir:r,local_files_only:a,revision:o}),c=null!==(t=l.feature_extractor_type)&&void 0!==t?t:l.image_processor_type,d=this.FEATURE_EXTRACTOR_CLASS_MAPPING[c];if(!d){if(void 0!==l.size)console.warn('Feature extractor type "'.concat(c,'" not found, assuming ImageFeatureExtractor due to size parameter in config.')),d=lX;else throw Error("Unknown Feature Extractor type: ".concat(c))}return new(null!==(s=this.PROCESSOR_CLASS_MAPPING[l.processor_class])&&void 0!==s?s:cp)(new d(l))}}async function cx(e){return Array.isArray(e)||(e=[e]),await Promise.all(e.map(e=>lF.read(e)))}async function ck(e,t){return Array.isArray(e)||(e=[e]),await Promise.all(e.map(e=>"string"==typeof e||e instanceof URL?lT(e,t):e instanceof Float64Array?new Float32Array(e):e))}function cb(e,t){t&&(e=e.map(e=>0|e));let[s,n,i,r]=e;return{xmin:s,ymin:n,xmax:i,ymax:r}}cv.FEATURE_EXTRACTOR_CLASS_MAPPING={ImageFeatureExtractor:lX,WhisperFeatureExtractor:cl,ViTFeatureExtractor:l3,MobileViTFeatureExtractor:l6,OwlViTFeatureExtractor:l8,Owlv2ImageProcessor:l7,CLIPFeatureExtractor:lJ,ChineseCLIPFeatureExtractor:lZ,SiglipImageProcessor:l0,ConvNextFeatureExtractor:l1,ConvNextImageProcessor:l2,SegformerFeatureExtractor:lK,BitImageProcessor:lQ,DPTImageProcessor:lH,DPTFeatureExtractor:lY,GLPNFeatureExtractor:l$,BeitFeatureExtractor:ce,DeiTFeatureExtractor:l9,DetrFeatureExtractor:cn,YolosFeatureExtractor:ci,DonutFeatureExtractor:ct,NougatImageProcessor:cs,EfficientNetImageProcessor:l5,ViTImageProcessor:l4,VitMatteImageProcessor:co,SamImageProcessor:cr,Swin2SRImageProcessor:ca,Wav2Vec2FeatureExtractor:cc,SeamlessM4TFeatureExtractor:cd,SpeechT5FeatureExtractor:c_,ASTFeatureExtractor:ch,ClapFeatureExtractor:cu},cv.PROCESSOR_CLASS_MAPPING={WhisperProcessor:cm,Wav2Vec2ProcessorWithLM:cg,SamProcessor:cf,SpeechT5Processor:cw,OwlViTProcessor:cy};class cM extends l{async dispose(){await this.model.dispose()}constructor({task:e,model:t,tokenizer:s=null,processor:n=null}){super(),this.task=e,this.model=t,this.tokenizer=s,this.processor=n}}class cA extends cM{async _call(e){let{topk:t=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.tokenizer(e,{padding:!0,truncation:!0}),n=await this.model(s),i="multi_label_classification"===this.model.config.problem_type?e=>e.sigmoid().data:e=>$(e.data),r=this.model.config.id2label,a=[];for(let e of n.logits){let s=J(i(e),t).map(e=>({label:r[e[0]],score:e[1]}));1===t?a.push(...s):a.push(s)}return Array.isArray(e)||1===t?a:a[0]}constructor(e){super(e)}}class cS extends cM{async _call(e){let{ignore_labels:t=["O"]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=Array.isArray(e),n=this.tokenizer(s?e:[e],{padding:!0,truncation:!0}),i=(await this.model(n)).logits,r=this.model.config.id2label,a=[];for(let e=0;e<i.dims[0];++e){let s=n.input_ids[e],o=i[e],l=[];for(let e=0;e<o.dims[0];++e){let n=o[e],i=ee(n.data)[1],a=r?r[i]:"LABEL_".concat(i);if(t.includes(a))continue;let c=this.tokenizer.decode([s[e].item()],{skip_special_tokens:!0});if(""===c)continue;let d=$(n.data);l.push({entity:a,score:d[i],index:e,word:c,start:null,end:null})}a.push(l)}return s?a:a[0]}constructor(e){super(e)}}class cz extends cM{async _call(e,t){let{topk:s=1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.tokenizer(e,{text_pair:t,padding:!0,truncation:!0}),i=await this.model(n),r=[];for(let e=0;e<i.start_logits.dims[0];++e){let t=n.input_ids[e],a=t.indexOf(this.tokenizer.sep_token_id),o=(function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.reduce((e,t)=>e.flatMap(e=>t.map(t=>[e,t])))})(Array.from($(i.start_logits[e].data)).map((e,t)=>[e,t]).filter(e=>e[1]>a),Array.from($(i.end_logits[e].data)).map((e,t)=>[e,t]).filter(e=>e[1]>a)).filter(e=>e[0][1]<=e[1][1]).map(e=>[e[0][1],e[1][1],e[0][0]*e[1][0]]).sort((e,t)=>t[2]-e[2]);for(let e=0;e<Math.min(o.length,s);++e){let[s,n,i]=o[e],a=[...t].slice(s,n+1),l=this.tokenizer.decode(a,{skip_special_tokens:!0});r.push({answer:l,score:i})}}return 1===s?r[0]:r}constructor(e){super(e)}}class cE extends cM{async _call(e){let{topk:t=5}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.tokenizer(e,{padding:!0,truncation:!0}),n=await this.model(s),i=[];for(let e=0;e<s.input_ids.dims[0];++e){let r=s.input_ids[e],a=r.indexOf(this.tokenizer.mask_token_id);if(-1===a)throw Error("Mask token (".concat(this.tokenizer.mask_token,") not found in text."));let o=J($(n.logits[e][a].data),t);i.push(o.map(e=>{let t=[...r];return t[a]=e[0],{score:e[1],token:e[0],token_str:this.tokenizer.model.vocab[e[0]],sequence:this.tokenizer.decode(t,{skip_special_tokens:!0})}}))}return Array.isArray(e)?i:i[0]}constructor(e){super(e)}}class cC extends cM{async _call(e){let t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Array.isArray(e)||(e=[e]),this.model.config.prefix&&(e=e.map(e=>this.model.config.prefix+e));let n=this.model.config.task_specific_params;n&&n[this.task]&&n[this.task].prefix&&(e=e.map(e=>n[this.task].prefix+e));let i=this.tokenizer,r={padding:!0,truncation:!0};t=this instanceof cT&&"_build_translation_inputs"in i?i._build_translation_inputs(e,r,s).input_ids:i(e,r).input_ids;let a=await this.model.generate(t,s);return i.batch_decode(a,{skip_special_tokens:!0}).map(e=>({[this._key]:e}))}constructor(e){super(e),this._key="generated_text"}}class cF extends cC{constructor(e){super(e),this._key="summary_text"}}class cT extends cC{constructor(e){super(e),this._key="translation_text"}}class cP extends cM{async _call(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Array.isArray(e);n||(e=[e]);let i=null!==(t=s.add_special_tokens)&&void 0!==t&&t;this.tokenizer.padding_side="left";let{input_ids:r,attention_mask:a}=this.tokenizer(e,{add_special_tokens:i,padding:!0,truncation:!0}),o=await this.model.generate(r,s,null,{inputs_attention_mask:a}),l=this.tokenizer.batch_decode(o,{skip_special_tokens:!0}),c=Array.from({length:e.length},e=>[]);for(let t=0;t<l.length;++t)c[Math.floor(t/o.length*e.length)].push({generated_text:l[t]});return n||1!==c.length?c:c[0]}constructor(e){super(e)}}class cL extends cM{async _call(e,t){let{hypothesis_template:s="This example is {}.",multi_label:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Array.isArray(e);i||(e=[e]),Array.isArray(t)||(t=[t]);let r=t.map(e=>s.replace("{}",e)),a=n||1===t.length,o=[];for(let s of e){let e=[];for(let t of r){let n=this.tokenizer(s,{text_pair:t,padding:!0,truncation:!0}),i=await this.model(n);a?e.push([i.logits.data[this.contradiction_id],i.logits.data[this.entailment_id]]):e.push(i.logits.data[this.entailment_id])}let n=(a?e.map(e=>$(e)[1]):$(e)).map((e,t)=>[e,t]).sort((e,t)=>t[0]-e[0]);o.push({sequence:s,labels:n.map(e=>t[e[1]]),scores:n.map(e=>e[0])})}return i?o:o[0]}constructor(e){var t;super(e),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(e=>{let[t,s]=e;return[t.toLowerCase(),s]})),this.entailment_id=this.label2id.entailment,void 0===this.entailment_id&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=null!==(t=this.label2id.contradiction)&&void 0!==t?t:this.label2id.not_entailment,void 0===this.contradiction_id&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}}class cO extends cM{async _call(e){var t;let{pooling:s="none",normalize:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.tokenizer(e,{padding:!0,truncation:!0}),r=await this.model(i),a=null!==(t=r.last_hidden_state)&&void 0!==t?t:r.logits;if("none"===s);else if("mean"===s)a=function(e,t){let s=[e.dims[0],e.dims[2]],n=new e.data.constructor(s[0]*s[1]),[i,r,a]=e.dims,o=0;for(let s=0;s<i;++s){let i=s*a*r;for(let l=0;l<a;++l){let c=0,d=0,h=s*r,u=i+l;for(let s=0;s<r;++s){let n=Number(t.data[h+s]);d+=n,c+=e.data[u+s*a]*n}let _=c/d;n[o++]=_}}return new el(e.type,n,s)}(a,i.attention_mask);else if("cls"===s)a=a.slice(null,0);else throw Error("Pooling method '".concat(s,"' not supported."));return n&&(a=a.normalize(2,-1)),a}constructor(e){super(e)}}class cI extends cM{async _call(e){let{topk:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=!Array.isArray(e),n=this.processor.feature_extractor.config.sampling_rate,i=await ck(e,n),r=this.model.config.id2label,a=[];for(let e of i){let s=await this.processor(e),n=J($((await this.model(s)).logits[0].data),t).map(e=>({label:r[e[0]],score:e[1]}));1===t?a.push(...n):a.push(n)}return s&&1!==t?a[0]:a}constructor(e){super(e)}}class cB extends cM{async _call(e,t){let{hypothesis_template:s="This is a sound of {}."}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=!Array.isArray(e);n&&(e=[e]);let i=t.map(e=>s.replace("{}",e)),r=this.tokenizer(i,{padding:!0,truncation:!0}),a=this.processor.feature_extractor.config.sampling_rate,o=await ck(e,a),l=[];for(let e of o){let s=await this.processor(e),n=$((await this.model({...r,...s})).logits_per_audio.data);l.push([...n].map((e,s)=>({score:e,label:t[s]})))}return n?l[0]:l}constructor(e){super(e)}}class cj extends cM{async _call(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(this.model.config.model_type){case"whisper":return this._call_whisper(e,t);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(e,t);default:throw Error("AutomaticSpeechRecognitionPipeline does not support model type '".concat(this.model.config.model_type,"'."))}}async _call_wav2vec2(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),t.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');let s=!Array.isArray(e);s&&(e=[e]);let n=this.processor.feature_extractor.config.sampling_rate,i=await ck(e,n),r=[];for(let e of i){let t=await this.processor(e),s=(await this.model(t)).logits[0],n=[];for(let e of s)n.push(ee(e.data)[1]);let i=this.tokenizer.decode(n);r.push({text:i})}return s?r[0]:r}async _call_whisper(e){var t,s,n,i,r;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=null!==(t=a.return_timestamps)&&void 0!==t&&t,l=null!==(s=a.chunk_length_s)&&void 0!==s?s:0,c=null!==(n=a.chunk_callback)&&void 0!==n?n:null,d=null!==(i=a.force_full_sequences)&&void 0!==i&&i,u=null!==(r=a.stride_length_s)&&void 0!==r?r:null;"word"===o&&(a.return_token_timestamps=!0);let _=h(a,"language",null),p=h(a,"task",null);if(_||p||o){if(a.forced_decoder_ids)throw Error("Cannot specify `language`/`task`/`return_timestamps` and `forced_decoder_ids` at the same time.");let e=this.tokenizer.get_decoder_prompt_ids({language:_,task:p,no_timestamps:!o});e.length>0&&(a.forced_decoder_ids=e)}let f=!Array.isArray(e);f&&(e=[e]);let m=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,g=this.processor.feature_extractor.config.hop_length,w=this.processor.feature_extractor.config.sampling_rate,y=await ck(e,w),v=[];for(let e of y){let t=[];if(l>0){if(null===u)u=l/6;else if(l<=u)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");let s=w*l,n=w*u,i=s-2*n,r=0;for(;r<e.length;){let a=e.subarray(r,r+s),o=await this.processor(a),l=0===r,c=r+i>=e.length;t.push({stride:[a.length,l?0:n,c?0:n],input_features:o.input_features,is_last:c}),r+=i}}else t=[{stride:[e.length,0,0],input_features:(await this.processor(e)).input_features,is_last:!0}];for(let e of t){a.num_frames=Math.floor(e.stride[0]/g);let t=await this.model.generate(e.input_features,a);"word"===o?(e.tokens=t.sequences[0],e.token_timestamps=t.token_timestamps.tolist()[0].map(e=>er(e,2))):e.tokens=t[0],e.stride=e.stride.map(e=>e/w),null!==c&&c(e)}let[s,n]=this.tokenizer._decode_asr(t,{time_precision:m,return_timestamps:o,force_full_sequences:d});v.push({text:s,...n})}return f?v[0]:v}constructor(e){super(e)}}class cN extends cM{async _call(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=Array.isArray(e),n=await cx(e),{pixel_values:i}=await this.processor(n),r=[];for(let e of i){e.dims=[1,...e.dims];let s=await this.model.generate(e,t),n=this.tokenizer.batch_decode(s,{skip_special_tokens:!0}).map(e=>({generated_text:e.trim()}));r.push(n)}return s?r:r[0]}constructor(e){super(e)}}class cq extends cM{async _call(e){let{topk:t=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=Array.isArray(e),n=await cx(e),{pixel_values:i}=await this.processor(n),r=await this.model({pixel_values:i}),a=this.model.config.id2label,o=[];for(let e of r.logits){let s=J($(e.data),t).map(e=>({label:a[e[0]],score:e[1]}));1===t?o.push(...s):o.push(s)}return s||1===t?o:o[0]}constructor(e){super(e)}}class cD extends cM{async _call(e){let{threshold:t=.5,mask_threshold:s=.5,overlap_mask_area_threshold:n=.8,label_ids_to_fuse:i=null,target_sizes:r=null,subtask:a=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Array.isArray(e)&&1!==e.length)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");let o=await cx(e),l=o.map(e=>[e.height,e.width]),{pixel_values:c,pixel_mask:d}=await this.processor(o),h=await this.model({pixel_values:c,pixel_mask:d}),u=null;if(null!==a)u=this.subtasks_mapping[a];else for(let[e,t]of Object.entries(this.subtasks_mapping))if(t in this.processor.feature_extractor){u=this.processor.feature_extractor[t].bind(this.processor.feature_extractor),a=e;break}let _=this.model.config.id2label,p=[];if("panoptic"===a||"instance"===a){let e=u(h,t,s,n,i,null!=r?r:l)[0],a=e.segmentation;for(let t of e.segments_info){let e=new Uint8ClampedArray(a.data.length);for(let s=0;s<a.data.length;++s)a.data[s]===t.id&&(e[s]=255);let s=new lF(e,a.dims[1],a.dims[0],1);p.push({score:t.score,label:_[t.label_id],mask:s})}}else if("semantic"===a){let{segmentation:e,labels:t}=u(h,null!=r?r:l)[0];for(let s of t){let t=new Uint8ClampedArray(e.data.length);for(let n=0;n<e.data.length;++n)e.data[n]===s&&(t[n]=255);let n=new lF(t,e.dims[1],e.dims[0],1);p.push({score:null,label:_[s],mask:n})}}else throw Error("Subtask ".concat(a," not supported."));return p}constructor(e){super(e),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}}class cR extends cM{async _call(e,t){let{hypothesis_template:s="This is a photo of {}"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Array.isArray(e),i=await cx(e),r=t.map(e=>s.replace("{}",e)),a=this.tokenizer(r,{padding:"siglip"!==this.model.config.model_type||"max_length",truncation:!0}),{pixel_values:o}=await this.processor(i),l=await this.model({...a,pixel_values:o}),c="siglip"===this.model.config.model_type?e=>e.sigmoid().data:e=>$(e.data),d=[];for(let e of l.logits_per_image){let s=[...c(e)].map((e,s)=>({score:e,label:t[s]}));s.sort((e,t)=>t.score-e.score),d.push(s)}return n?d:d[0]}constructor(e){super(e)}}class cU extends cM{async _call(e){let{threshold:t=.9,percentage:s=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Array.isArray(e);if(n&&1!==e.length)throw Error("Object detection pipeline currently only supports a batch size of 1.");let i=await cx(e),r=s?null:i.map(e=>[e.height,e.width]),{pixel_values:a,pixel_mask:o}=await this.processor(i),l=await this.model({pixel_values:a,pixel_mask:o}),c=this.processor.feature_extractor.post_process_object_detection(l,t,r),d=this.model.config.id2label,h=c.map(e=>e.boxes.map((t,n)=>({score:e.scores[n],label:d[e.classes[n]],box:cb(t,!s)})));return n?h:h[0]}constructor(e){super(e)}}class cG extends cM{async _call(e,t){let{threshold:s=.1,topk:n=null,percentage:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Array.isArray(e),a=await cx(e),o=this.tokenizer(t,{padding:!0,truncation:!0}),l=await this.processor(a),c=[];for(let e=0;e<a.length;++e){let r=a[e],d=i?null:[[r.height,r.width]],h=l.pixel_values[e].unsqueeze_(0),u=await this.model({...o,pixel_values:h}),_=this.processor.feature_extractor.post_process_object_detection(u,s,d,!0)[0],p=_.boxes.map((e,s)=>({score:_.scores[s],label:t[_.classes[s]],box:cb(e,!i)})).sort((e,t)=>t.score-e.score);null!==n&&(p=p.slice(0,n)),c.push(p)}return r?c:c[0]}constructor(e){super(e)}}class cW extends cM{async _call(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=(await cx(e))[0],{pixel_values:i}=await this.processor(n),r=this.tokenizer("<s_docvqa><s_question>".concat(t,"</s_question><s_answer>"),{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,a=await this.model.generate(i,{...s,decoder_input_ids:r,max_length:this.model.config.decoder.max_position_embeddings}),o=this.tokenizer.batch_decode(a)[0].match(/<s_answer>(.*?)<\/s_answer>/),l=null;return o&&o.length>=2&&(l=o[1].trim()),[{answer:l}]}constructor(e){super(e)}}class cV extends cM{async _call(e){let{speaker_embeddings:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.processor?this._call_text_to_spectrogram(e,{speaker_embeddings:t}):this._call_text_to_waveform(e)}async _call_text_to_waveform(e){let t=this.tokenizer(e,{padding:!0,truncation:!0}),{waveform:s}=await this.model(t),n=this.model.config.sampling_rate;return{audio:s.data,sampling_rate:n}}async _call_text_to_spectrogram(e,t){let{speaker_embeddings:s}=t;if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await o1.from_pretrained(this.DEFAULT_VOCODER_ID,{quantized:!1})),("string"==typeof s||s instanceof URL)&&(s=new Float32Array(await (await fetch(s)).arrayBuffer())),s instanceof Float32Array)s=new el("float32",s,[1,s.length]);else if(!(s instanceof el))throw Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");let{input_ids:n}=this.tokenizer(e,{padding:!0,truncation:!0}),{waveform:i}=await this.model.generate_speech(n,s,{vocoder:this.vocoder}),r=this.processor.feature_extractor.config.sampling_rate;return{audio:i.data,sampling_rate:r}}constructor(e){var t;super(e),this.DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan",this.vocoder=null!==(t=e.vocoder)&&void 0!==t?t:null}}class cX extends cM{async _call(e){let t=await cx(e),s=await this.processor(t),n=await this.model(s),i=[];for(let e of n.reconstruction){let t=e.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");i.push(lF.fromTensor(t))}return i.length>1?i:i[0]}constructor(e){super(e)}}class cK extends cM{async _call(e){let t=await cx(e),s=await this.processor(t),{predicted_depth:n}=await this.model(s),i=[];for(let e=0;e<t.length;++e){let s=ed(n[e],t[e].size.reverse(),"bilinear",!1),r=s.mul_(255/ee(s.data)[0]).to("uint8");i.push({predicted_depth:n[e],depth:lF.fromTensor(r)})}return i.length>1?i:i[0]}constructor(e){super(e)}}let cH=Object.freeze({"text-classification":{tokenizer:t9,pipeline:cA,model:o2,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:t9,pipeline:cS,model:o3,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:t9,pipeline:cz,model:le,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:t9,pipeline:cE,model:o9,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:t9,pipeline:cF,model:o4,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:t9,pipeline:cT,model:o4,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:t9,pipeline:cC,model:o4,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:t9,pipeline:cP,model:o7,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:t9,pipeline:cL,model:o2,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:cI,model:lc,processor:cv,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:t9,pipeline:cB,model:o1,processor:cv,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:t9,pipeline:cj,model:[o5,ll],processor:cv,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:t9,pipeline:cV,model:[o8,o6],processor:[cv,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:t9,pipeline:cN,model:lt,processor:cv,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:cq,model:ls,processor:cv,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:cD,model:[ln,li],processor:cv,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"zero-shot-image-classification":{tokenizer:t9,pipeline:cR,model:o1,processor:cv,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:cU,model:lr,processor:cv,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:t9,pipeline:cG,model:la,processor:cv,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:t9,pipeline:cW,model:lu,processor:cv,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:cX,model:lp,processor:cv,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:cK,model:lf,processor:cv,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:t9,pipeline:cO,model:o1,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"}}),cQ=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function cY(e){var t,s;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{quantized:i=!0,progress_callback:r=null,config:a=null,cache_dir:o=null,local_files_only:l=!1,revision:c="main"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=cH[(e=null!==(t=cQ[e])&&void 0!==t?t:e).split("_",1)[0]];if(!d)throw Error("Unsupported pipeline: ".concat(e,". Must be one of [").concat(Object.keys(cH),"]"));n||(n=d.default.model,console.log('No model specified. Using default model: "'.concat(n,'".')));let h=new Map([["tokenizer",d.tokenizer],["model",d.model],["processor",d.processor]]),u=await c$(h,n,{quantized:i,progress_callback:r,config:a,cache_dir:o,local_files_only:l,revision:c});return u.task=e,s={status:"ready",task:e,model:n},r&&r(s),new d.pipeline(u)}async function c$(e,t,s){let n=Object.create(null),i=[];for(let[r,a]of e.entries()){let e;a&&(e=Array.isArray(a)?new Promise(async(e,n)=>{let i;for(let n of a){if(null===n){e(null);return}try{e(await n.from_pretrained(t,s));return}catch(e){i=e}}n(i)}):a.from_pretrained(t,s),n[r]=e,i.push(e))}for(let[e,t]of(await Promise.all(i),Object.entries(n)))n[e]=await t;return n}j.allowLocalModels=!1;class cJ{static async getInstance(e){return void 0===this.instance&&(this.instance=cY("image-classification",this.model,{progress_callback:e,quantized:!1,revision:"refs/pr/1"})),this.instance}}cJ.model="chriamue/bird-species-classifier",self.addEventListener("message",async e=>{let t=await cJ.getInstance(e=>{self.postMessage(e)}),s=e.data.image;try{let e=await t(s,{topk:3});self.postMessage({status:"complete",output:e})}catch(e){e instanceof Error?self.postMessage({status:"error",error:e.message}):self.postMessage({status:"error",error:"An unknown error occurred."})}})}},c={};function d(e){var t=c[e];if(void 0!==t)return t.exports;var s=c[e]={exports:{}},n=!0;try{l[e](s,s.exports,d),n=!1}finally{n&&delete c[e]}return s.exports}d.m=l,d.x=function(){var e=d.O(void 0,[179,89],function(){return d(7353)});return d.O(e)},e=[],d.O=function(t,s,n,i){if(s){i=i||0;for(var r=e.length;r>0&&e[r-1][2]>i;r--)e[r]=e[r-1];e[r]=[s,n,i];return}for(var a=1/0,r=0;r<e.length;r++){for(var s=e[r][0],n=e[r][1],i=e[r][2],o=!0,l=0;l<s.length;l++)a>=i&&Object.keys(d.O).every(function(e){return d.O[e](s[l])})?s.splice(l--,1):(o=!1,i<a&&(a=i));if(o){e.splice(r--,1);var c=n();void 0!==c&&(t=c)}}return t},s=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},d.t=function(e,n){if(1&n&&(e=this(e)),8&n||"object"==typeof e&&e&&(4&n&&e.__esModule||16&n&&"function"==typeof e.then))return e;var i=Object.create(null);d.r(i);var r={};t=t||[null,s({}),s([]),s(s)];for(var a=2&n&&e;"object"==typeof a&&!~t.indexOf(a);a=s(a))Object.getOwnPropertyNames(a).forEach(function(t){r[t]=function(){return e[t]}});return r.default=function(){return e},d.d(i,r),i},d.d=function(e,t){for(var s in t)d.o(t,s)&&!d.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},d.f={},d.e=function(e){return Promise.all(Object.keys(d.f).reduce(function(t,s){return d.f[s](e,t),t},[]))},d.u=function(e){return"static/chunks/"+(179===e?"8397fb17":e)+"."+({89:"bca8c1c0c43103f1",179:"dfd67a75db5789f9"})[e]+".js"},d.miniCssF=function(e){},d.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),d.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},d.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.tt=function(){return void 0===n&&(n={createScriptURL:function(e){return e}},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(n=trustedTypes.createPolicy("nextjs#bundler",n))),n},d.tu=function(e){return d.tt().createScriptURL(e)},d.p="/_next/",i={604:1},d.f.i=function(e,t){i[e]||importScripts(d.tu(d.p+d.u(e)))},a=(r=self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push.bind(r),r.push=function(e){var t=e[0],s=e[1],n=e[2];for(var r in s)d.o(s,r)&&(d.m[r]=s[r]);for(n&&n(d);t.length;)i[t.pop()]=1;a(e)},o=d.x,d.x=function(){return Promise.all([d.e(179),d.e(89)]).then(o)},_N_E=d.x()}();